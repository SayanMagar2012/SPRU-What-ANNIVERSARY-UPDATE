console.log("%c♫ Powered by incredibox.com","color:#FFF; background-color:#25447F; padding:2px 10px 2px 6px;"),console.log("%c♫ RMB 8.4.7 by @Rem https://www.youtube.com/@rin.Incredibox","color:#FFF; background-color:#25447F; padding:2px 10px 2px 6px;");var versions={};function initVersions(){versions.total=Object.keys(versions).length,versions["v"+appVersion]?((app=versions["v"+appVersion]).animearray.forEach((function(e,o){e.soundA=e.name+"_a",e.soundB=e.uniqsnd?e.name+"_a":e.name+"_b",e.anime=e.name+"-sprite.png",e.animeData=e.name+".json"})),app.bonusarray.forEach((function(e,o){e.src=e.src+"."+vidExt})),app.recmaxloop=Math.round(180/(app.looptime/1e3)),app.recminloop=Math.round(20/(app.looptime/1e3)),app.recmintime=Math.round(app.recminloop*(app.looptime/1e3)),app.recminloop=appBrowserDemo?0:app.recminloop):popupGeneralError({error:"init versions",action:"kill"})}let specialEventNow,specialEventName;function nada(){}var preventActionUsed=!(versions.v999={}),preventActionDelay=.25;function preventAction(e){preventActionUsed||(preventActionUsed=!0,e(),setTimeout((function(){preventActionUsed=!1}),preventActionDelay))}function tryfunc(e){notnull(e)&&"function"===(typeof e).toLowerCase()&&e()}function inIframe(){try{return window.self!==window.top}catch(e){return!0}}function callParentWindow(e,o){isIframe&&(notnull(window.top)&&notnull(window.top.appEvent)?window.top.appEvent(e,o):setTimeout((function(){callParentWindow(e,o)}),200))}var drawMinTopY,drawMaxTopY,drawMaxRandPosY,drawMaxBounceY,drawPoloW,drawPoloH,drawEyeW,drawEyeH,drawAnimW,drawAnimH,drawEyeY,drawPupW,drawPup1X,drawPup1Y,drawPup2X,drawPup2Y,drawMaxPupMove,cropPoloW,cropPoloH,cropAnimW,cropAnimH,cropEyeW,cropEyeH,cropEyeX,cropEyeY,cropEyelidX,cropEyelid1Y,cropEyelid2Y,cropEyelid3Y,cropEyelid4Y,cropPupY,cropPupW,canvasBound,canvasScale,poloRatio,poloBlocW,poloOverlapW,poloBlocX,regexList={allchar:/[*]/,classic:/[^A-Za-z0-9\u00C0-\u017F '-]/,search:/[^A-Za-z0-9\u00C0-\u017F\u0025 '-]/,max3letters:/[*]|(.)(?=\1\1\1)/gi,strict:/[^A-Za-z0-9 '-]/,custom:/[^A-Za-z0-9àâçèéêîôùûÀÂÇÈÉÊÎÔÙÛ '-]/,email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,allsafe:/[^A-Za-z0-9\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\s]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/};function removeDupInArray(e,o){var t,n=[];for(t of e)existInArray(n,t,o)||n.push(t);return n}function uniqueBetweenArray(e,o,t){var n,i=[];for(n of e)existInArray(o,n,t)||i.push(n);for(n of o)existInArray(e,n,t)||i.push(n);return i}function existInArray(e,o,t){for(var n=!notnull(t)||t,i=!1,a=0,s=e.length;a<s;a++)if(n){if(e[a]===o){i=!0;break}}else if(e[a].toLowerCase()===o.toLowerCase()){i=!0;break}return i}function removeInArray(e,o){for(var t=0,n=o.length;t<n;t++)if(o[t]===e){o.splice(t,1);break}return o}function existInArrayFromProp(e,o,t){for(var n=0,i=t.length;n<i;n++)if(t[n][o]===e)return!0;return!1}function numberArray(e){for(var o=0,t=e.length;o<t;o++)e[o]=0|e[o];return e}function xhr(e,o,t,n,i){$.ajax({type:e,url:o,crossdomain:!0,data:t,success:function(e){n(e,t)},error:i||function(){},dataType:"json"})}function renameFile(e){return 1==animSize?e:nameToHD(e)}function nameToHD(e){var o=e.substr(e.lastIndexOf("."));return e.split(o).join("-hd"+o)}function loadSnd(e,o,t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){o.decodeAudioData(i.response,(function(e){t(e)}),(function(e){n()}))},i.onerror=function(){n()},i.send()}function gotoAppUrl(e){e=isnull(e)?appBrowser?"":"index.html":e,window.location.href=e}function reloadPage(){(appBrowser?window.top:window).location.reload()}function openURL(e,o){var t=isIframe?window.top:window;o=isnull(o)?"_blank":o,o=appBrowserDemo&&isIOS?"_self":o;window.electron?electron.ipc.openURL(e):window.cordova?cordova.InAppBrowser.open(e,"_system","hidden=yes,location=no"):t.open(e,o)}function redirectTo(e){var o=domainOnline+"url/"+e;o=appCN?o+"-cn":o;openURL(o=window.cordova&&{facebook:"https://www.facebook.com/incredibox",twitter:"https://twitter.com/incredibox_",instagram:"https://www.instagram.com/incredibox.official/",youtube:"https://www.youtube.com/incredibox"}[e]||o)}function windowPopup(e,o,t,n){var i=n?screen.height/2-t/2:0;n=n?screen.width/2-o/2:0;window.open(e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width="+o+",height="+t+",top="+i+",left="+n)}function getParameterByName(e){var o={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(e,t,n){o[t]=n}));var t=null;return e in o?o[e]:t}function getPageNameGA(){return-1!=window.location.href.indexOf("app.html")?"app.html?v="+getParameterByName("v"):"index.html"}function secToText(e){var o=parseInt(e/1e3%60),t=parseInt(e/6e4%60);return parseInt(e/36e5%24),(t<10?"0"+t:t)+":"+(o<10?"0"+o:o)}function getTime(){return(new Date).getTime()}function getTimeAgo(e,o){e=-1==e.indexOf("/")?e.split("-").join("/"):e,o=-1==o.indexOf("/")?o.split("-").join("/"):o;var t=new Date(e);return!1===(o=timeConversion(new Date(o).getTime()-t.getTime()))?getStringDate(e):o}function timeConversion(e){var o=(e/1e3).toFixed(1),t=(e/6e4).toFixed(1),n=(e/36e5).toFixed(1),i=(e=(e/864e5).toFixed(1),"");if(o<60)i=(o=Math.round(o)).toString()+" "+(o<2&&notnull(STR("txt.time.tSec.one"))?STR("txt.time.tSec.one"):STR("txt.time.tSec.other"));else if(t<60)i=(o=Math.round(t)).toString()+" "+(o<2&&notnull(STR("txt.time.tMin.one"))?STR("txt.time.tMin.one"):STR("txt.time.tMin.other"));else if(n<23)i=(t=Math.round(n)).toString()+" "+(t<2&&notnull(STR("txt.time.tHou.one"))?STR("txt.time.tHou.one"):STR("txt.time.tHou.other"));else{if(!(e<10))return!1;i=(o=Math.round(e)).toString()+" "+(o<2&&notnull(STR("txt.time.tDay.one"))?STR("txt.time.tDay.one"):STR("txt.time.tDay.other"))}return STR("txt.ago").split("%{date_time}").join(i)}function getDateNow(){var e=(a=new Date).getDate(),o=a.getMonth()+1,t=a.getFullYear(),n=a.getHours(),i=a.getMinutes(),a=a.getSeconds();e=String(e<10?"0"+e:e),o=String(o<10?"0"+o:o),n=String(n<10?"0"+n:n),i=String(i<10?"0"+i:i),a=String(a<10?"0"+a:a);return String(t+"-"+o+"-"+e+" "+n+":"+i+":"+a)}function jsonDecode(e){return isnull(e)?null:(e=e.split("\t").join("").split("\n").join(""),JSON.parse(e))}function jsonEncode(e){return isnull(e)?null:JSON.stringify(e)}function random(e){return Math.round(Math.random()*e)}function randomRangeInt(e,o){return e=Math.ceil(e),o=Math.floor(o),Math.floor(Math.random()*(o-e+1))+e}function decimal(e,o){return o=isnull(o)?2:o,o=Math.pow(10,o),Math.round(e*o)/o}function numberSpaced(e){var o;return e?(e=e.toString(),o=e.indexOf("."),e.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,(function(e,t){return o<0||t<o?e+" ":e}))):0}function trim(e){return isnull(e)?"":(e=(e=(e=e.split("\t").join("")).split("\n").join("")).split("\r").join("")).replace(/^\s+|\s+$|\s+(?=\s)/g,"")}function cleanInputText(e){return(e=trim(e=ucwords(e))).replace(regexList.max3letters,"")}function slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"")}function ucwords(e){return(e=e.toLowerCase()).charAt(0).toUpperCase()+e.slice(1)}function uniqid(e){function o(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e=e||"",o()+e+o()+e+o()+e+o()+e+o()}function uniqid30(){function e(){return Math.floor(65536*(1+Math.random())).toString(16)}return e()+e()+e()+e()+e()+e()}function getUniqLink(e){return e=notnull(e)?e.app:app.version,uniqid()+"-v"+e}function isnull(e){return null==e||"undefined"===e}function notnull(e){return null!=e&&"undefined"!==e}function copyToClipboard(e){var o=document.createElement("textarea");o.value=e,o.setAttribute("readonly",""),o.style={position:"absolute",visibility:"hidden",pointerEvents:"none"},document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o)}function resetAnimationCSS(e){e.style.animation="none",e.offsetHeight,e.style.animation=null}function transitionEndEventName(){var e,o=document.createElement("div"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==o.style[e])return t[e];return null}function animationEndEventName(){var e,o=document.createElement("div"),t={animation:"animationend",OAnimation:"oanimationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==o.style[e])return t[e];return null}function addTransition(e,o,t,n,i){i=!!notnull(i)&&i,e.off(transitionEnd).addClass(o).on(transitionEnd,{div:e,prop:t,func:n,log:i},transitionComplete)}function removeTransition(e,o,t,n,i){i=!!notnull(i)&&i,e.off(transitionEnd).removeClass(o).on(transitionEnd,{div:e,prop:t,func:n,log:i},transitionComplete)}function transitionComplete(e){notnull(e.data)&&notnull(e.data.func)&&e.originalEvent.propertyName.replace("-webkit-","")==e.data.prop&&e.data.div.attr("id")==e.target.id&&(notnull(e.data.log),e.data.div.off(transitionEnd),e.data.func())}function stopProp(e){notnull(e)&&e.stopPropagation()}String.prototype.replaceAt=function(e,o){return this.substr(0,e)+o+this.substr(e+o.length)};var pageExt,appBrowser,transitionEnd,animationEnd,iosVersion,iosVersionNumber,sizes={polo:{sprWidth:164,sprHeight:400,overlapW:30,minTopY:10,maxTopY:380,maxRandomY:30,maxBounceY:20,sprAnimW:164,sprAnimH:380,eyesTopY:97,sprEyesW:164,sprEyesH:40,sprEyesX:492,sprEyesY:0,sprEyelidX:328,sprEyelid1Y:0,sprEyelid2Y:40,sprEyelid3Y:80,sprEyelid4Y:120,sprPupY:450,sprPupW:16,pup1X:54,pup1Y:110,pup2X:95,pup2Y:110,maxPupMove:7},canvas:{baseW:1028,baseH:380,marge:50,maxOverflow:20},video:{baseW:1e3,baseH:400}},bottomNeedSlide=!1;function getViewport(){var e=document.body.clientWidth,o=document.body.clientHeight;return e<o&&(e=document.body.clientHeight,o=document.body.clientWidth),{w:e,h:o}}function resizeApp(){var e,o,t,n,i,a,s,r,l,c,u,p,d,m,f,v,h,b,g;pageApp&&(miniPlayer&&(sizes.canvas.marge=15),cropPoloW=sizes.polo.sprWidth*animSize,cropPoloH=sizes.polo.sprHeight*animSize,cropEyeW=sizes.polo.sprEyesW*animSize,cropEyeH=sizes.polo.sprEyesH*animSize,cropEyeX=sizes.polo.sprEyesX*animSize,cropEyeY=sizes.polo.sprEyesY*animSize,cropEyelidX=sizes.polo.sprEyelidX*animSize,cropEyelid1Y=sizes.polo.sprEyelid1Y*animSize,cropEyelid2Y=sizes.polo.sprEyelid2Y*animSize,cropEyelid3Y=sizes.polo.sprEyelid3Y*animSize,cropEyelid4Y=sizes.polo.sprEyelid4Y*animSize,cropPupY=sizes.polo.sprPupY*animSize,cropPupW=sizes.polo.sprPupW*animSize,e=document.querySelector("#game"),o=document.querySelector("#box-top"),t=document.querySelector("#box-stage"),n=t.querySelector("#cnv-stage"),i=t.querySelector("#box-polo"),a=document.querySelector("#box-loader-polo"),s=document.querySelector("#box-video"),r=document.querySelector("#box-picto"),l=s.querySelectorAll(".video"),c=sizes.canvas.baseW/sizes.canvas.baseH,d=sizes.video.baseW/sizes.video.baseH,g=hasHBI?25:0,window.onresize=function(){if(l&&(e.clientWidth/e.clientHeight<1.6?(bottomNeedSlide=!1,b=t.clientHeight,document.body.classList.contains("bottomSlide")&&document.body.classList.remove("bottomSlide")):(bottomNeedSlide=!miniPlayer,b=e.clientHeight-o.clientHeight-o.clientHeight/2),(m=(f=b)*d)<e.clientWidth&&(m=Math.ceil(e.clientWidth),f=Math.ceil(m/d)),v=Math.round((m-s.clientWidth)/2),h=Math.round((f-b)/2),l.forEach((e=>{e.style.width=m+"px",e.style.height=f+"px",e.style.transform="translate("+-v+"px, "+-h+"px)"}))),n){p=t.clientHeight+sizes.canvas.maxOverflow,(u=p*c)>t.clientWidth-2*sizes.canvas.marge&&(u=t.clientWidth-2*sizes.canvas.marge,p=u/c),appBrowser&&u>sizes.canvas.baseW&&(u=sizes.canvas.baseW,p=u/c),n.style.width=u+100+"px",n.style.height=p+80+"px",i.style.width=u+100+"px",i.style.height=p+"px",a.style.width=u+"px",r.style.width=.92*u-2*g+"px",n.width=n.clientWidth*cnvPXD,n.height=n.clientHeight*cnvPXD,canvasBound=n.getBoundingClientRect(),canvasScale=n.clientHeight/sizes.canvas.baseH;let e=window.innerHeight,o=.96;e<430?o=.95:(e<600||e<800)&&(o=.97);let s=canvasBound.width-80;poloOverlapW=s*sizes.polo.overlapW/sizes.canvas.baseW;let l=.05;poloBlocX=(poloBlocW=(s+poloOverlapW*(nbPoloMax-1))/nbPoloMax)*({1:1,2:1.5,3:1.1,4:1,5:.9,6:.86,7:.8,8:.78,9:.72,10:.72}[nbPoloMax]||.8),poloRatio=(s/sizes.canvas.baseW+l)*o;let d=1;e>430?d=1.2:(e>400||e>800)&&(d=1),drawMinTopY=sizes.polo.minTopY*canvasScale*cnvPXD*d+140,drawMaxTopY=sizes.polo.maxTopY*canvasScale*cnvPXD*d-30;let m=function(e,o,t,n=1){const i=window.innerWidth;return i>430?e:i>600?o:i>800?t:n}(.6,2,3);drawMaxRandPosY=sizes.polo.maxRandomY*canvasScale*cnvPXD/m-20,drawMaxBounceY=sizes.polo.maxBounceY*canvasScale*cnvPXD/2,drawPoloW=sizes.polo.sprWidth*poloRatio*cnvPXD,drawPoloH=sizes.polo.sprHeight*poloRatio*cnvPXD,drawEyeW=sizes.polo.sprEyesW*poloRatio*cnvPXD,drawEyeH=sizes.polo.sprEyesH*poloRatio*cnvPXD,drawEyeY=sizes.polo.eyesTopY*poloRatio*cnvPXD,drawPupW=sizes.polo.sprPupW*poloRatio*cnvPXD,drawPup1X=sizes.polo.pup1X*poloRatio*cnvPXD,drawPup1Y=sizes.polo.pup1Y*poloRatio*cnvPXD,drawPup2X=sizes.polo.pup2X*poloRatio*cnvPXD,drawPup2Y=sizes.polo.pup2Y*poloRatio*cnvPXD,drawMaxPupMove=sizes.polo.maxPupMove*poloRatio*cnvPXD,window.canvasContentLeftPadding=80}listPolo&&listPolo.length&&listPolo.forEach((function(e,o){e.resize(),pause&&e.draw()}))},window.onresize())}var debugMute=getParameterByName("mute")||!1,debugGame=getParameterByName("game")||!1,debugScene=getParameterByName("scene")||!1,debugBonus=getParameterByName("bonus")||!1,build={store:"playstore",platform:"mobile",os:"and",osMinimum:23,storeURL:"https://play.google.com/store/apps/details?id=com.sofarsogood.incredibox",version:"0.7.0",htmlExt:"html"},domainOnline="https://www.incredibox.com/",appCN=!1,machine={},user={},hasNetwork=!1,sndExt="ogg",vidExt="mp4",appBrowserDemo=!1,appBrowserSchool=!1,featureLocked=!1,isMouseDevice=checkMouseDevice(),isTouchDevice=checkTouchDevice(),isMobile=!1,trustAppMobile=window.cordova||!1,isIframe=inIframe(),pointerEventType={},isIOS=!1,isIOSMac=!1,isOSX=!1,isWin=!1,isAndroid=!1,isiPod=!1,isiPhone=!1,isiPad=!1,isiPadPro=!1,hasHBI=!1,animSize=1,cnvPXD=2;function checkSystem(){pageApp=window.location.href.includes("app.html")||window.location.href.includes("app.php")||"1"==getParameterByName("afs"),pageExt=build.htmlExt,appBrowser="browser"==build.platform,appBrowserDemo=checkInPWA(),appBrowserSchool=!!notnull(getParameterByName("afs")),featureLocked=(appBrowser||appBrowserDemo)&&!appBrowserSchool,hasNetwork=networkState(),machine=getDeviceInfo(!0),user=getUserInfo(),isAndroid=/android/i.test(machine.osName),isWin=/windows/i.test(machine.osName),isOSX=/mac os/i.test(machine.osName),isIOS=/ios/i.test(machine.osName),isIOSMac=!(!window.device||!window.device.isiOSAppOnMac)&&window.device.isiOSAppOnMac,(iosVersion=!(!window.device||!window.device.version)&&window.device.version)&&(e=iosVersion.split("."),iosVersionNumber=Number(String(e[0])+String(e[1])[0])),isiPod=isIOS&&/ipod/i.test(machine.osName),isiPhone=isIOS&&/iphone/i.test(machine.osName),isiPad=isIOS&&/ipad/i.test(machine.deviceModel),isiPadPro=isIOS&&/ipadpro/i.test(machine.deviceModel),isRetina=checkRetina(),isMobile=checkMobile(),hasHBI=isIOS&&checkHBI(),animSize=document.body.clientWidth>=1024&&document.body.clientHeight>=768?2:1,appBrowser&&(animSize=1,sndExt=checkAudioFormat("ogg")?"ogg":sndExt,vidExt=isAndroid||"mozilla firefox"==machine.browserName&&machine.browserVersion<=48?"webm":"mp4"),pointerEventType=setPointerEvent(),transitionEnd=transitionEndEventName(),animationEnd=animationEndEventName(),window.cordova,window.electron;var e=window.cordova?document:window;if(e.addEventListener("online",networkOn,!1),e.addEventListener("offline",networkOff,!1),document.body.classList.remove("black"),window.electron&&document.body.classList.add("electron"),pageApp||window.electron||document.getElementById("fade-all").classList.add("white"),pageApp&&(document.body.classList.add("v"+appVersion),document.body.classList.add("darkback")),!appBrowser||appBrowserDemo||appBrowserSchool||document.body.classList.add("appBrowser"),appBrowserDemo&&document.body.classList.add("appBrowserDemo"),appBrowserSchool&&document.body.classList.add("afs"),featureLocked&&document.body.classList.add("featureLocked"),hasHBI&&document.body.classList.add("hasHBI"),miniPlayer&&document.body.classList.add("miniPlayer"),window.cordova&&isAndroid&&document.addEventListener("backbutton",(function(e){e.preventDefault(),clickAndroidBackButton()}),!1),window.cordova&&pageApp&&!isIOSMac&&!window.electron&&(document.addEventListener("pause",appOnPause,!1),document.addEventListener("resume",appOnResume,!1)),window.cordova&&pageApp&&isAndroid&&(window.addEventListener("native.keyboardshow",VKBopen),window.addEventListener("native.keyboardhide",VKBclose)),pageApp&&!window.cordova&&window.electron,window.electron&&"steam"==build.store&&"YXJw"!=btoa(electron.vars.arg))throw new BoxDialog("#pop-dialog").open("Incredibox needs to run from<br>your Steam library.<br>Thanks for your support!","&#129488;",[],!0,!0),new Error("Please connect to your Steam account")}function checkHBI(){if(window.cordova){var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");if(e&&""!=e&&parseInt(e)>0)return!0}return!1}function getListUUID(){var e,o=[];for(e in o.push(machine.uuid),storage.getAllItem())-1!=e.indexOf("uuid-")&&(""!=e.replace("uuid-","")?o.push(e.replace("uuid-","")):storage.removeItem(e));return removeDupInArray(o,!1)}function secureIframe(){}function checkInBrowser(){return document.URL.indexOf("http://")>-1||document.URL.indexOf("https://")>-1}function checkInPWA(){return!(!window.navigator||!0!==window.navigator.standalone)||!!window.matchMedia("(display-mode: standalone)").matches}function checkMobile(){var e;return!(window.electron||isIOSMac||isiPad||(e=getViewport(),!(isiPod||isiPhone||e.h<=500&&e.w<=1e3)))}function checkRetina(){var e;return!!window.matchMedia&&((e=window.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)"))&&e.matches||window.devicePixelRatio>1)}function checkTouchDevice(){var e=!1;try{document.createEvent("TouchEvent"),e=!0}catch(e){}return(window.hasOwnProperty("ontouchstart")||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&(e=!0),!!window.matchMedia("(pointer: coarse)").matches||e}function checkMouseDevice(){return window.matchMedia("(hover: hover)").matches&&window.matchMedia("(pointer: fine)").matches}function getAppData(){return{build:build,machine:machine,user:user}}function checkAudioFormat(e){e=e||"mp3";var o=document.createElement("audio");return!(!o.canPlayType||!o.canPlayType("audio/"+e+";").replace(/no/,""))}function checkSupported(){var e=window.hasOwnProperty("HTMLCanvasElement"),o=window.AudioContext||window.webkitAudioContext||!1,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||!1,n="string"==typeof(new XMLHttpRequest).responseType,i=!isnull(transitionEnd)&&!isnull(animationEnd);return window.AudioContext=o,window.requestAnimationFrame=t,e?o?n?i?t?"ok":"RAF":"CSS3":"XHR":"Audio API":"Canvas"}function lockScreenEdges(){window.cordova&&"object"==typeof ScreenEdgesPlugin&&ScreenEdgesPlugin.setPreferredEdges(["top","bottom"],(function(){}),(function(e){}))}function unlockScreenEdges(){window.cordova&&"object"==typeof ScreenEdgesPlugin&&ScreenEdgesPlugin.setPreferredEdges([],(function(){}),(function(e){}))}function converterCanRun(){var e="function"==typeof window.Worker;return window.cordova,e}function setPointerEvent(e){var o=window.hasOwnProperty("PointerEvent")?"pointer":window.hasOwnProperty("TouchEvent")?"touch":"mouse";e=e||o,o={};return"pointer"==e?(o.down="pointerdown",o.up="pointerup",o.move="pointermove",o.cancel="pointercancel",o.leave="pointerleave"):"touch"==e?(o.down="touchstart",o.up="touchend",o.move="touchmove",o.cancel="touchcancel",o.leave="touchcancel"):"mouse"==e&&(o.down="mousedown",o.up="mouseup",o.move="mousemove",o.cancel="mouseleave",o.leave="mouseleave"),o}function initRightClick(){window.oncontextmenu=function(){return!1}}function networkOn(){hasNetwork=!0,localMixObject.saveMixOffline(),initAnalytics()}function networkOff(){hasNetwork=!1}function networkState(){var e=!1;return navigator.onLine?e=navigator.onLine:navigator.network&&navigator.network.connection&&navigator.network.connection.type&&(e=!(navigator.network.connection.type==Connection.NONE)),e}function keepAppAwake(){window.plugins&&window.plugins.insomnia&&!isIOSMac&&window.plugins.insomnia.keepAwake((function(){}),(function(){}))}function stopKeepingAppAwake(){window.plugins&&window.plugins.insomnia&&!isIOSMac&&window.plugins.insomnia.allowSleepAgain((function(){}),(function(){}))}function deleteUserInfo(){}function getUserInfo(){return{guid:storage.getItem("user-guid")||"",djname:storage.getItem("user-djname")||"",lang:storage.getItem("user-lang")||""}}function setUserInfo(e){notnull(e.guid)&&(e.guid=30==e.guid.length?e.guid:"",user.guid=e.guid,storage.setItem("user-guid",user.guid,!0)),notnull(e.djname)&&(user.djname=e.djname,storage.setItem("user-djname",user.djname,!0)),notnull(e.lang)&&(user.lang=e.lang,storage.setItem("user-lang",user.lang,!0)),user=getUserInfo()}function getDeviceInfo(e){var o,t,n=(m=navigator.userAgent||navigator.vendor||window.opera).toLowerCase(),i="(?)";/(fban|fbios|fbav|fbbv|fbid)/gi.test(n)?i="Facebook":/(twitter)/gi.test(n)&&(i="Twitter");var a="(?)";window.cordova&&device?a=device.platform:/(macintosh)/gi.test(n)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/(iphone|ipad|ipod)/gi.test(n)?a="iOS":/(mac os x)/gi.test(n)?a="Mac OS X":/(macppc|macintel|mac_powerpc|macintosh)/gi.test(n)?a="Mac OS":/(windows|win16)/gi.test(n)?a="Windows":/(android)/gi.test(n)&&(a="Android");var s="(?)",r=n;window.cordova&&device&&(r=device.model),/(windows phone|windows phone)/gi.test(r)?s="Windows phone":/(windows|win16)/gi.test(r)?s="PC":/(android)/gi.test(r)?s="Android":/(macintosh)/gi.test(r)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&1024==window.screen.width&&1366==window.screen.height?s="iPadPro":/(macintosh)/gi.test(r)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/(ipad)/gi.test(r)?s="iPad":/(iphone)/gi.test(r)?s="iPhone":/(ipod)/gi.test(r)?s="iPod":/(mac)/gi.test(r)&&(s="Mac"),window.cordova&&device&&null!=appleModel[device.model]&&/ipad pro/i.test(appleModel[device.model])&&(r="iPadPro");r="(?)";window.cordova&&device?r=device.model:null!=window.navigator&&null!=navigator.platform&&(r=navigator.platform);var l="(?)";window.cordova&&device?l=device.version:"Windows"==a?/(windows 10.0|windows nt 10.0)/gi.test(n)?l="10":/(windows 8.1|windows nt 6.3)/gi.test(n)?l="8.1":/(windows 8|windows nt 6.2)/gi.test(n)?l="8":/(windows 7|windows nt 6.1)/gi.test(n)?l="7":/(windows nt 6.0)/gi.test(n)?l="Vista":/(windows nt 5.2)/gi.test(n)?l="Server 2003":/(windows nt 5.1|windows xp)/gi.test(n)?l="XP":/(windows nt 5.0|windows 2000)/gi.test(n)?l="2000":/(win 9x 4.90|windows me)/gi.test(n)?l="ME":/(windows 98|win98)/gi.test(n)?l="98":/(windows 95|win95|windows_95)/gi.test(n)?l="95":/(windows nt 4.0|winnt4.0|winnt|windows nt)/gi.test(n)?l="NT 4.0":/(windows ce)/gi.test(n)?l="CE":/(win16)/gi.test(n)&&(l="3.11"):"Android"==a?(u="Android",p=m.toLowerCase().indexOf(u.toLowerCase()),c=parseFloat(m.slice(p+u.length,p+u.length+6)),l=isNaN(c)?l:c):"iOS"==a?(u="OS",p=m.toLowerCase().indexOf(u.toLowerCase()),c=m.slice(p+u.length,p+u.length+6),c=parseFloat(c.replace("_",".")),l=isNaN(c)?l:c):-1!=a.indexOf("Mac OS")&&(u=-1!=a.indexOf("Mac OS X")?"Mac OS X":"Mac OS",p=m.toLowerCase().indexOf(u.toLowerCase()),c=m.slice(p+u.length,p+u.length+6),c=parseFloat(c.replace("_",".")),l=isNaN(c)?l:c);n=0;"iOS"==a&&(window.cordova&&device?null!=appleModel[device.model]&&"iPhone"==s&&(n=appleModel[device.model].replace("iPhone","").split(" ")[0],n=/SE/i.test(n)?7:/X/i.test(n)?10:parseInt(n)):"iPhone"==s&&(p=window.screen.width,u=window.screen.height,320==p&&480==u?n=4:320==p&&568==u?n=5:375==p&&667==u||414==p&&736==u?n=6:(375==p&&812==u||414==p&&896==u)&&(n=10),3==window.devicePixelRatio)&&(812==p&&375==u||896==u&&414==p)&&(n=10));var c="";window.cordova&&device?c=build.os:/mac os/i.test(a)?c="osx":/windows/i.test(a)?c="win":/android/i.test(a)?c="and":/ios/i.test(a)&&(c="ios");var u=navigator.appName,p=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10);-1!=(o=m.indexOf("OPR/"))?(u="Opera",p=m.substring(o+4)):-1!=(o=m.indexOf("Opera"))?(u="Opera",p=m.substring(o+6),-1!=(o=m.indexOf("Version"))&&(p=m.substring(o+8))):-1!=(o=m.indexOf("Edge"))?(u="Microsoft Edge",p=m.substring(o+5)):-1!=(o=m.indexOf("MSIE"))?(u="Microsoft Internet Explorer",p=m.substring(o+5)):-1!=(o=m.indexOf("Trident"))?(u="Microsoft Internet Explorer",-1!=(o=m.indexOf("rv:"))&&(p=m.substring(o+3))):-1!=(o=m.indexOf("CriOS"))&&/iphone|ipod|ipad/i.test(m)?(u="Google Chrome for IOS",p=m.substring(o+6)):-1!=(o=m.indexOf("Chrome"))?(u="Google Chrome",p=m.substring(o+7)):-1!=(o=m.indexOf("Safari"))?(u="Safari",p=m.substring(o+7),-1!=(o=m.indexOf("Version"))&&(p=m.substring(o+8))):-1!=(o=m.indexOf("Firefox"))?(u="Mozilla Firefox",p=m.substring(o+8)):(t=m.lastIndexOf(" ")+1)<(o=m.lastIndexOf("/"))&&(u=m.substring(t,o),p=m.substring(o+1),u.toLowerCase()==u.toUpperCase())&&(u=navigator.appName),-1!=(t=(p=-1!=(t=p.indexOf(";"))?p.substring(0,t):p).indexOf(" "))&&(p=p.substring(0,t)),d=parseInt(""+p,10),isNaN(d)&&(p=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10));var m="";window.device&&window.device.uuid?m=device.uuid.toUpperCase():window.electron&&window.electron.vars.uuid?m=window.electron.vars.uuid:notnull(storage.getItem("tmp-uuid"))?m=storage.getItem("tmp-uuid"):(m="tmp-"+uniqid("-").toUpperCase(),storage.setItem("tmp-uuid",m));var f={osName:a,osTiny:c,osVersion:l.toString(),deviceModel:s,deviceName:r,deviceNumber:n,browserName:u,browserVersion:d,browserFullVersion:p,browserAppName:navigator.appName,browserUserAgent:navigator.userAgent,language:navigator.language||"",webviewEmbed:i,uuid:m},v=0;if(!0===e)for(v in f)"string"==typeof f[v]&&(f[v]=f[v].toLowerCase());if(window.device)for(v in device);for(v in f);return f}window.devicePixelRatio=window.devicePixelRatio||1,secureIframe();var appleModel={};function initRulesCSS(){var e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sal")),o=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sar"));e=Math.max(e,o,20),o=":root {";pageApp&&(o+="\n\t\t\t--app-v : "+appVersion+";\n\t\t\t--colBck : "+app.colBck+";\n\t\t\t--col0 : "+app.col0+";\n\t\t\t--col1 : "+app.col1+";\n\t\t\t--col2 : "+app.col2+";\n\t\t\t--col3 : "+app.col3+";\n\t\t\t--col4 : "+app.col4+";\n\t\t\t--url-img-home-screen : url(../asset-v"+appVersion+"/img/home-screen@2x.jpg);\n\t\t\t--url-img-home-titre : url(../asset-v"+appVersion+"/img/home-titre@2x.png);\n\t\t\t--url-img-home-version : url(../asset-v"+appVersion+"/img/home-version@2x.png);\n\t\t"),o=o+"\n\t\t\t--fullfill-padding : "+e+"px;\n\t\t\t--url-img-bt-stores : url("+domainOnline+"img/bt-stores-"+currentLanguage.split("-")[0]+".png);\n\t\t}";e=document.head||document.getElementsByTagName("head")[0];var t=document.createElement("style");e.appendChild(t),t.type="text/css",t.appendChild(document.createTextNode(o))}function BoxDialog(e){var o=this,t=$(e);function n(e){e.preventDefault(),stopProp(e),e.data.bt.addTouchAnimation();var o=!0;void 0!==e.data.func&&(e.data.func===i&&(o=!1),e.data.func()),o&&i()}function i(){o.neverClose||o.close()}return this.$div=t,this.$bck=t.find(".bac"),this.$scale=t.find(".scale"),this.$box=t.find(".box"),this.$pop=t.find(".pop"),this.$pop.$title=t.find(".title"),this.$pop.$text=t.find(".text"),this.$pop.$content=t.find(".content"),this.opened=!1,this.neverClose=!1,this.isOpen=function(){return o.opened},this.open=function(e,a,s,r,l,c,u){o.isOpen()&&(removeInFocusHistory("popup-dialog"),deleteFocus(),o.killall()),t.on(pointerEventType.down,stopProp),o.opened=!0,o.neverClose=!isnull(c)&&c,e=isnull(e)?"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod":e,a=isnull(a)?"Info":a,s=isnull(s)?["Close"]:s,r=isnull(r)?[i]:r,l=!isnull(l)&&l,notnull(u)&&t.attr("data-name",u),t.addClass("show"),o.clean(),o.$pop.$title.html(a),o.$pop.$text.html(e);for(var p=0,d=s.length;p<d;p++){var m=s[p],f=$('<div class="bt bt-light" id="bt-mini'+p+'"></div>');(f=new CustomButton(f)).html('<div class="bck"><div class="txt">'+m+'</div></div><div class="hitzone"></div>'),f.on(pointerEventType.down,{func:r[p],bt:f},n),o.$pop.$content.append(f)}l&&t.css({"z-index":"9999"}),o.fadeInBck(),o.$box.removeClass("open close").addClass("open"),createFocus("popup-dialog")},this.close=function(e){notnull(e)&&e.preventDefault(),o.fadeOutBck(),o.$box.removeClass("open close").addClass("close").one(animationEnd,(function(e){$(e.target).removeClass("close"),t.removeClass("show"),t.removeAttr("data-name"),t.off(),o.clean(),o.opened=!1,removeInFocusHistory("popup-dialog"),createFocusFromHistory()}))},this.killall=function(){removeInFocusHistory("popup-dialog"),t.off(),t.removeAttr("data-name"),t.removeClass("show"),o.clean(),o.$box.removeClass("open close"),resetAnimationCSS(o.$box[0]),o.$bck.removeClass("animateFadeIn animateFadeOut"),resetAnimationCSS(o.$bck[0]),o.opened=!1},this.fadeInBck=function(e){e?o.$bck.addClass("mini"):o.$bck.removeClass("mini"),o.$bck.addClass("animateFadeIn")},this.fadeOutBck=function(){o.$bck.addClass("animateFadeOut").one(animationEnd,(function(e){$(e.target).removeClass("animateFadeIn animateFadeOut")}))},this.clean=function(){o.$pop.$content.find(".bt").off(),o.$pop.$content.empty(),o.$pop.$title.empty(),o.$pop.$text.empty()},this}function Popup(e){var o,t=this,n=$(e),i=n.find(".bac"),a=n.find(".box"),s=n.find(".bt.icon"),r=n.find(".container"),l=n.find(".box-tab .tab").length>0,c=!0,u=!0;function p(){c=!0,i.removeClass("animateFadeIn animateFadeOut"),t.closeComplete()}function d(e){u=!0,a.removeClass("slideUp slideDown").get(0).offsetHeight,o.onBoxCloseEnd(),t.closeComplete(),tryfunc(e)}function m(){notnull(t.onCloseTab)&&t.onCloseTab(),n.find(".tab.active").removeClass("active"),n.find(".pop.active").removeClass("active");var e=$(this),o=n.find(".pop#"+e.attr("id").replace("tab-","pop-"));e.addClass("active"),o.addClass("active"),createFocus(o.attr("id"))}return this.$popup=n,this.$icon=s,this.$container=r,this.objCustom=o,this.open=function(e){notnull(o)&&e.name==o.name||(n.hasClass("show")||n.addClass("show"),i.hasClass("animateFadeIn")||t.showBck(),a.hasClass("slideUp")?t.hideBox((function(){t.open(e)})):(t.custom(e),t.showBox()))},this.close=function(e){t.hideBck(e),t.hideBox(null,e)},this.closeComplete=function(){c&&u&&(t.reinit(),tryfunc(o.onCloseComplete),o=null)},this.reinit=function(){o.static||r.empty(),n.removeClass("show mini info action action-back no-action"),n.removeAttr("data-name"),i.removeClass("animateFadeIn animateFadeOut"),a.removeClass("slideUp slideDown").get(0).offsetHeight},this.custom=function(e){o={static:e.static||!1,bodyclose:e.bodyclose||!1,bckclose:e.bckclose||!1,name:e.name||"no-name",icntype:e.icntype||"",class:e.class||"",content:e.content||"",onBoxOpenStart:e.onBoxOpenStart||nada,onBoxOpenEnd:e.onBoxOpenEnd||nada,onBoxCloseStart:e.onBoxCloseStart||nada,onBoxCloseEnd:e.onBoxCloseEnd||nada,onCloseComplete:e.onCloseComplete||nada},n.removeClass("big column mini info action action-back no-action"),n.addClass(o.class),n.attr("data-name",o.name),""!=o.icntype&&(n.addClass(o.icntype),s.find("svg use").attr("xlink:href","#ic-"+("action"==o.icntype?"close":"action-back"==o.icntype?"navl":"info"))),o.static||r.html(o.content)},this.refresh=function(){notnull(o)&&notnull(o.content)&&r.html(o.content)},this.showBck=function(){c=!1,i.addClass("animateFadeIn").one(animationEnd,(function(){}))},this.hideBck=function(e){!0===e?p():i.addClass("animateFadeOut").one(animationEnd,(function(){p()}))},this.showBox=function(){u=!1,o.onBoxOpenStart(),l&&(n.find(".box-tab .tab").first().trigger(pointerEventType.down.split(" ")[0]),deleteFocus()),a.addClass("slideUp").one(animationEnd,(function(){o.bodyclose&&$body.on(pointerEventType.down,t.clickBck),o.bckclose&&i.on(pointerEventType.down,t.close),o.onBoxOpenEnd()}))},this.hideBox=function(e,n){o.bodyclose&&$body.off(pointerEventType.down,t.clickBck),o.bckclose&&i.off(pointerEventType.down,t.close),o.onBoxCloseStart(),!0===n?d(e):a.addClass("slideDown").one(animationEnd,(function(){d(e)}))},this.clickBck=function(o){o.preventDefault(),$(o.target).closest(e+" .box").length>0||(!l||(o=notnull((o=~o.type.indexOf("touch")?o.originalEvent:o).targetTouches)?o.targetTouches[0]:o,Math.round(o.pageY)>100))&&t.close()},this.isOpen=function(){return n.hasClass("show")},this.getName=function(){return notnull(o)&&notnull(o.name)?o.name:""},l&&n.find(".box-tab .tab").each((function(e){$(this).on(pointerEventType.down,m)})),this}function checkIfPopupOpen(){notnull(boxPopup)&&boxPopup.isOpen()&&boxPopup.close(!0)}function boxInfoCustom(){var e=boxInfo.$popup.find("#pop-tuto .slideshow");return e.$box=e.find(".img-row"),e.$btL=e.find(".bt").first(),e.$btR=e.find(".bt").last(),e.$nav=e.find(".pt-box"),e.init=function(){for(var e,o=this,t=0,n=0,i=0,a=0,s=this.find(".bloc").length,r=100/s,l=0,c=0;c<s;c++)o.$nav.append('<div class="pt"></div>');this.addListener=function(){document.body.addEventListener(pointerEventType.up,o.onRelease),document.body.addEventListener(pointerEventType.leave,o.onRelease),document.body.addEventListener(pointerEventType.move,o.onMove)},this.removeListener=function(){document.body.removeEventListener(pointerEventType.up,o.onRelease),document.body.removeEventListener(pointerEventType.leave,o.onRelease),document.body.removeEventListener(pointerEventType.move,o.onMove)},this.onPress=function(n){n="targetTouches"in n?n.targetTouches[0]:n,t=n.pageX,o.$box.removeClass("slide"),e=boxInfo.$popup.find(".slideshow")[0].clientWidth,o.removeListener(),o.addListener()},this.onMove=function(i){i="targetTouches"in i?i.targetTouches[0]:i,i=-1*Math.round(t-i.pageX)*100/document.body.clientWidth,l=i*document.body.clientWidth/e,n=l/s*.6,o.$box.css({transform:"translate("+(a+n)+"%,0)"})},this.onRelease=function(){o.removeListener(),l<-15?i!=s-1?o.slide("left"):o.slide():l>15&&0!==i?o.slide("right"):o.slide(),l=n=t=0},this.slide=function(e){o.removeListener(),o.$box.addClass("slide"),"left"===e?i++:"right"===e&&i--,a=-i*r,o.$box.css({transform:"translate("+String(a)+"%,0)"}),o.lightup()},this.clickLeft=function(e){0!==i&&o.slide("right")},this.clickRight=function(e){i!=s-1&&o.slide("left")},this.lightup=function(){o.$nav.find(".pt").removeClass("active"),o.$nav.find(".pt").eq(i).addClass("active"),o.$btL.removeClass("disable"),o.$btR.removeClass("disable"),0===i&&o.$btL.addClass("disable"),i==s-1&&o.$btR.addClass("disable")},this.desactive=function(){i>0&&(t=n=i=a=l=0,o.slide()),o.$box[0].removeEventListener(pointerEventType.down,o.onPress),o.$btL[0].removeEventListener(pointerEventType.down,o.clickLeft),o.$btR[0].removeEventListener(pointerEventType.down,o.clickRight),o.removeListener()},this.active=function(){o.$box[0].addEventListener(pointerEventType.down,o.onPress),o.$btL[0].addEventListener(pointerEventType.down,o.clickLeft),o.$btR[0].addEventListener(pointerEventType.down,o.clickRight),o.lightup()}},e.init(),e}function initPopup(){(boxInfo=new Popup(".box-popup#pop-info")).$slide=boxInfoCustom(),boxParam=new Popup(".box-popup#pop-param"),$("#pop-language .box-lang .bt").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){clickBtLang(e)}))})),$("#pop-follow .bt.color-facebook").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("facebook")})),$("#pop-follow .bt.color-twitter").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("twitter")})),$("#pop-follow .bt.color-instagram").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("instagram")})),$("#pop-follow .bt.color-youtube").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("youtube")})),$("#pop-follow .bt.color-tumblr").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("tumblr")})),$("#pop-follow #img-shop").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("shop-all")})),$("#pop-credit #bt-feedback").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(sendFeedback)})),$("#pop-credit #bt-rating").on(pointerEventType.down,(function(e){e.preventDefault();var o=isIOS||isOSX?build.storeRateURL:build.storeURL;preventAction((function(){openURL(o)}))})),$("#pop-credit #bt-faq").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo("faq")})),$("#pop-credit #bt-privacy").on(pointerEventType.down,(function(e){e.preventDefault(),showPP()}))}function showPP(e){}function hidePP(){}function refusePP(){}function acceptPP(e){}function dialogGetApp(e,o){notnull(e)&&e.preventDefault(),appBrowserDemo?popupGetApp(o):appBrowser?popupGetAppBrowser(o):boxDialog.open("To access this feature you have to download the Incredibox app. Let's go? &#128273;","&#128274; Locked",[STR("bt.sure"),STR("bt.later")],[],!0)}function popupGetApp(e){var o=isIOS?"<div class='bt-store' id='bt-getapp'><div class='bck appstore'></div></div>":"<div class='bt with-icn' id='bt-getapp'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg><div class='txt'>Get app</div></div><div class='hitzone'></div></div>",t=isIOS?"appstore":"store";o=isAndroid?"<div class='bt-store' id='bt-getapp'><div class='bck playstore'></div></div>":o,t=isAndroid?"playstore":t,boxPopup.open({name:"get-full-app",icntype:!0===e?"action-back":"action",class:"big column",content:"\n\t\t\t<div class='left'>\n               <div class='img-box'></div>\n            </div>\n            <div class='right'>\n               <div class='title'>"+STR("txt.lockedContent")+"</div>\n               <div class='text'>\n               \t"+STR("txt.wantAllFeature")+" "+STR("txt.easyDownload")+"<br><br>\n               \t"+STR("txt.catchyFeatures").replace("%{emoji}","&#129321")+"\n               </div>\n               "+o+"\n            </div>",onBoxOpenEnd:function(){!0===e?boxPopup.$icon.on(pointerEventType.down,popupRecok):boxPopup.$icon.on(pointerEventType.down,boxPopup.close),boxPopup.$popup.find(".img-box").css({"background-image":"url(./img/demo-mockup.jpg)"}).addClass("fade"),boxPopup.$popup.find("#bt-getapp").on(pointerEventType.down,(function(e){e.preventDefault(),redirectTo(t)}))},onBoxCloseStart:function(){boxPopup.$icon.off(),boxPopup.$popup.find("#bt-getapp").off()}})}function popupGetAppBrowser(e){var o=!0===e?"action-back":"action",t="App exclusivity",n="This feature is only available in the Incredibox App.<br>Choose your store below and access the full experience!",i="More info",a=null!=getParameterByName("lang")&&"en"!=getParameterByName("lang")?getParameterByName("lang")+"/":"",s=domainOnline+a+"app";isIframe&&null!=window.top.i18n&&(t=window.top.i18n.app_exclusivity,n=window.top.i18n.feature_only_inapp+"<br>"+window.top.i18n.access_full_xp,i=window.top.i18n.bt_more_info),boxPopup.open({name:"get-full-app-browser",icntype:o,content:"\n\t\t\t<div class='title'>"+t+" &#128521;</div>\n\t\t\t<div class='text'>"+n+'</div>\n\t\t\t<div class=\'box-bt-store\'>\n\t\t\t\t<a href="https://apps.apple.com/app/incredibox/id1093131935" target="_blank" class="bt-store"><div class="bck appstore"></div></a>\n\t\t\t\t<a href="https://play.google.com/store/apps/details?id=com.sofarsogood.incredibox" target="_blank" class="bt-store"><div class="bck playstore"></div></a>\n\t\t\t\t<a href="https://www.amazon.fr/So-Far-Good-Incredibox/dp/B07BKZCDHT/" target="_blank" class="bt-store"><div class="bck amazonstore"></div></a>\n\t\t\t\t<a href="https://store.steampowered.com/app/1545450/Incredibox/" target="_blank" class="bt-store"><div class="bck steam"></div></a>\n\t\t\t\t<a href="https://apps.apple.com/app/id1437906083" target="_blank" class="bt-store"><div class="bck macappstore"></div></a>\n\t\t\t\t<a href="https://www.microsoft.com/fr-fr/p/incredibox/9pdjpp8scs9k?rtc=1&activetab=pivot:overviewtab" target="_blank" class="bt-store"><div class="bck windowsstore"></div></a>\n\t\t\t\t<a href="https://www.incredibox.com/schools" target="_blank" class="bt-store"><div class="bck schools"></div></a>\n\t\t\t</div>\n\t\t\t<div id="bt-more-info" class="bt bt-light with-icn"><div class="bck"><div class="icn"><svg class="icn-svg"><use xlink:href="#ic-navr"></use></svg></div><div class="txt">'+i+'</div></div><div class="hitzone"></div></div>',onBoxOpenEnd:function(){!0===e?boxPopup.$icon.on(pointerEventType.down,popupMixSaved):boxPopup.$icon.on(pointerEventType.down,boxPopup.close),boxPopup.$popup.find("#bt-more-info").on(pointerEventType.down,(function(e){e.preventDefault(),openURL(s,"_self")}))},onBoxCloseStart:function(){boxPopup.$icon.off(),boxPopup.$popup.find("#bt-more-info").off()}})}function popupGeneralError(e){var o=translateObj&&translateObj.trad?STR("pop.generalErrorText"):"Sorry, the app encountered a technical problem.",t=translateObj&&translateObj.trad?STR("bt.ok"):"Ok",n=e&&e.error?"<br>[ error: "+e.error+" ]":"",i=e&&e.action?e.action:"";e=e&&e.txt?e.txt+n:o+n;"kill"==i?boxDialog.open(e,"&#128533;",[],[],!0,!0):"reload"==i?boxDialog.open(e,"&#128533;",["Reload"],[reloadPage],!0):boxDialog.open(e,"&#128533;",[t],[],!0)}function popupStillHere(){null!=boxDialog&&"dialogStillHere"!=boxDialog.$div.attr("data-name")&&boxDialog.open(STR("pop.stillHere"),"&#128564;",[STR("bt.sure")],[clickPopupStillHere],!0,!1,"dialogStillHere")}function popupInfo(){deleteFocus(),boxInfo.open({static:!0,bckclose:!0,name:"popup-info",class:"big",onBoxOpenEnd:function(){boxInfo.$slide.active(),createFocus("pop-tuto")},onBoxCloseStart:function(){deleteFocus(),focusHistory=[]},onBoxCloseEnd:function(){boxInfo.$slide.desactive()},onCloseComplete:function(){createFocus(pageApp?"home":"index-select")}})}function popupParam(){deleteFocus(),boxParam.open({static:!0,bckclose:!0,name:"popup-param",class:"big",onBoxOpenEnd:function(){createFocus("pop-language")},onBoxCloseStart:function(){deleteFocus(),focusHistory=[]},onCloseComplete:function(){createFocus(pageApp?"home":"index-select")}})}function popupSwitch(){1!=singleVersionMod&&(deleteFocus(),boxSwitch.open({static:!0,bckclose:!0,name:"popup-switch",onBoxOpenEnd:function(){createFocus("popup-switch")},onBoxCloseStart:function(){deleteFocus(),focusHistory=[]},onCloseComplete:function(){createFocus("home")}}))}function popupDrag(){var e=STR(modeRecord?"pop.dragDropText":"txt.tuto1");boxPopup.open({name:"drag-and-drop",class:"mini",bodyclose:!0,content:"<div class='title'>"+STR("pop.dragDropTitle")+"</div><div class='text'>"+e+"</div>",onBoxOpenStart:function(){boxPopup.$popup.find(".pop").append("<div id='pointe-box' class='bottom'><div id='pointe'></div></div>")},onBoxCloseEnd:function(){boxPopup.$popup.find("#pointe-box").remove(),modeRecord||storage.setItem("popupDragViewed","viewed")}})}function popupShort(){boxPopup.open({name:"too-short",icntype:"info",class:"mini",bodyclose:!0,content:"\n\t\t\t<div class='title'>"+STR("pop.toShortTitle")+"</div>\n\t\t\t<div class='text'>"+STR("pop.toShortText").split("%{minimum_time}").join(app.recmintime)+"</div>"})}function popupBonusPlaying(){boxPopup.open({name:"bonus-playing",icntype:"info",class:"mini",bodyclose:!0,content:"\n\t\t\t<div class='title'>"+STR("pop.bonusPlayingTitle")+"</div>\n\t\t\t<div class='text'>"+STR("pop.bonusPlayingText")+"</div>"})}function popupFindPreviousBonus(){boxPopup.open({name:"find-previous-bonus",icntype:"info",class:"mini",bodyclose:!0,content:"\n\t\t\t<div class='title'>"+STR("pop.bonusFindPreviousTitle")+"</div>\n\t\t\t<div class='text'>"+STR("pop.bonusFindPreviousText")+"</div>"})}function popupBonusUnlocked(e){var o;(!modeReplay&&!modeRandom||e)&&(o="v"+appVersion+"-popup-bonus-unlock",isnull(storage.getItem(o))||e)&&boxPopup.open({name:"bonus-unlocked",class:"mini",bodyclose:!0,content:"\n\t\t\t\t\t<div class='title'>"+STR("pop.bonusUnlockTitle")+"</div>\n\t\t\t\t\t<div class='text'>"+STR("pop.bonusUnlockText")+"</div>\n\t\t\t\t",onBoxOpenStart:function(){boxPopup.$popup.find(".pop").append("<div id='pointe-box' class='top'><div id='pointe'></div></div>"),calcPointePosX(1)},onBoxCloseEnd:function(){storage.setItem(o,"ok"),boxPopup.$popup.find("#pointe-box").remove()}})}function popupBonusFindNext(e){var o;(!modeReplay&&!modeRandom||e)&&(o="v"+appVersion+"-popup-bonus-next",isnull(storage.getItem(o))||e)&&(isToolbarOpen&&closeTool(),boxPopup.open({name:"find-next-bonus",class:"mini",bodyclose:!0,content:"\n\t\t\t\t\t<div class='title'>"+STR("pop.bonusFindNextTitle")+"</div>\n\t\t\t\t\t<div class='text'>"+STR("pop.bonusFindNextText")+"</div>\n\t\t\t\t",onBoxOpenStart:function(){boxPopup.$popup.find(".pop").append("<div id='pointe-box'><div id='pointe'></div></div>")},onBoxCloseEnd:function(){storage.setItem(o,"ok"),boxPopup.$popup.find("#pointe-box").remove()}}))}function calcPointePosX(e){var o=document.querySelector("#pop-popup .pop").getBoundingClientRect();e=(e=(e=(e=document.querySelector("#bt-bonus-"+e).getBoundingClientRect()).left-o.left+e.width/2)<30?30:e)>o.width-30?o.width-30:e,document.getElementById("pointe").style.left=e+"px"}function popupRecok(){checkTimeRecok=getTime(),deleteFocus();var e="\n\t\t<div class='bt bt-haut retry'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-reset'></use></svg></div><div class='txt'>"+STR("bt.retry")+"</div><div class='hitzone'></div></div>\n\t\t<div class='bt bt-haut replay'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='txt'>"+STR("bt.replay")+"</div><div class='hitzone'></div></div>\n\t\t<div class='bt bt-haut save'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-edit'></use></svg></div><div class='txt'>"+STR("bt.save")+"</div><div class='hitzone'></div></div>";appBrowserDemo&&(e="\n\t\t\t<div class='bt bt-haut replay'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='txt'>"+STR("bt.replay")+"</div><div class='hitzone'></div></div>\n\t\t\t<div class='bt bt-haut share'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-share'></use></svg></div><div class='txt'>"+STR("bt.share")+"</div><div class='hitzone'></div></div>\n\t\t\t<div class='bt bt-haut download'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='txt'>Get MP3</div><div class='hitzone'></div></div>"),boxPopup.open({name:"record-complete",icntype:"action",content:"\n\t\t\t<div class='title'>"+STR("pop.recOkTitle")+"</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div class='box-bt-haut'>\n\t\t\t\t\t"+e+"\n\t\t\t\t</div>\t\n\t\t\t</div>",onBoxOpenEnd:function(){boxPopup.$icon.on(pointerEventType.down,boxPopup.close),boxPopup.$popup.find(".bt.replay").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickReplayMix)})),appBrowserDemo?(boxPopup.$popup.find(".bt.share").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){popupGetApp(!0)}))})),boxPopup.$popup.find(".bt.download").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){popupGetApp(!0)}))}))):(boxPopup.$popup.find(".bt.retry").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickRetryMix)})),boxPopup.$popup.find(".bt.save").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickSaveMix)}))),createFocus("popup-record-complete"),unlock()},onBoxCloseStart:function(){deleteFocus(),boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off()},onBoxCloseEnd:function(){boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off()},onCloseComplete:function(){removeInFocusHistory("popup-record-complete"),modeReplay||createFocus("toolbar")}})}var androidKB,translateObj,defaultLanguage,currentLanguage,checkTimeRecok=0;function canIclickRecok(){return getTime()-checkTimeRecok>600}function clickRetryMix(){canIclickRecok()&&(boxPopup.close(),callAd("next","retry-mix",(function(){TweenMax.delayedCall(.2,startRecordMode)})))}function clickReplayMix(){canIclickRecok()&&(boxPopup.close(),prepareReplayMode(),startReplayMode(),saveGA("mix","replay"))}function clickSaveMix(){popupForm()}function popupForm(){boxPopup.open({name:"save-form",icntype:"action-back",content:function(){var e="\n\t\t\t<div class='title'>"+STR("pop.formTitle")+"</div>\n\t\t\t<div class='content'>\n\t\t\t\t<form action='javascript:validFormMix()' method='post' target='_self' autocomplete='off'>\n\t\t\t\t\t<div class='formzone'>\n\t\t\t\t\t\t<div class='formline ic-name'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-user-mini'></use></svg></div><input type='text' id='input-name' placeholder='"+STR("txt.inputName")+"' value='"+user.djname+"' maxlength='26' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t\t<div class='formline ic-title'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-note-mini'></use></svg></div><input type='text' id='input-title' placeholder='"+STR("txt.inputTitle")+"' value='' maxlength='26' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t\t<div class='formline ic-dedi'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div><input type='text' id='input-dedi' placeholder='"+STR("txt.dedicatedTo").split("%{name}").join("...")+"' value='' maxlength='26' autocorrect='off' spellcheck='false'/></div>";return appBrowser||(e+="<div class='formline ic-private'>\n\t\t\t\t\t\t\t<div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div>\n\t\t\t\t\t\t\t<div class='bt-onofftext active'>\n\t\t\t\t\t\t\t\t<div class='slider'></div>\n\t\t\t\t\t\t\t\t<div class='txtbox'>\n\t\t\t\t\t\t\t\t\t<div class='label'>"+STR("bt.private")+"</div>\n\t\t\t\t\t\t\t\t\t<div class='label'>"+STR("bt.public")+"</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>"),e+="</div>\n\t\t\t\t\t<div class='btzone'>\n\t\t\t\t\t\t<div class='bt bt-round bt-big valid'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-check'></use></svg></div><div class='hitzone'></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type='submit' style='visibility:hidden;position:absolute'/><div class='clear'></div>\n\t\t\t\t</form>\n\t\t\t</div>",appBrowser&&!appBrowser&&(e+="<div style='margin-top: 25px; color:#777; font-size:14px; line-height:20px;'>"+STR("pop.dontUseName")+" &#128521;</div>"),e},onBoxOpenEnd:function(){var e,o;createFocus("popup-save-form"),boxPopup.$icon.on(pointerEventType.down,popupRecok),boxPopup.$popup.find(".bt.valid").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickBtValidFormMix)})),window.cordova&&!isIOSMac&&(boxPopup.$popup.find(".formline:not(.ic-private)").on(pointerEventType.down,(function(e){boxPopup.$popup.find(".formline").off(pointerEventType.down),Spinner.add($(this).find(".icn-box"))})),boxPopup.$popup.find(".formline input").on("focus",(function(){boxPopup.$popup.find(".formline input").off("focus"),Spinner.reset()}))),appBrowser||isSafeMode()||(e=boxPopup.$popup.find(".formline.ic-private .bt-onofftext"),o=boxPopup.$popup.find(".formline.ic-private svg use"),e.on(pointerEventType.down,(function(t){t.preventDefault(),e.hasClass("active")?(e.removeClass("active"),o.attr("xlink:href","#ic-lock-mini")):(e.addClass("active"),o.attr("xlink:href","#ic-view-mini"))})))},onBoxCloseStart:function(){removeInFocusHistory("popup-save-form"),deleteFocus(),boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off(),boxPopup.$popup.find(".bt-onofftext").off(),boxPopup.$popup.find(".formline").off(),boxPopup.$popup.find(".formline input").off(),boxPopup.$popup.find("input").off(),window.cordova&&blurAll()}})}var formProcessing=!1;function clickBtValidFormMix(){validFormMix()}function validFormMix(){var e,o,t,n,i,a,s,r,l,c,u;function p(){TweenMax.delayedCall(1,(function(){Spinner.reset(),popupMixSaved()}))}boxPopup.$popup.find(".formzone .formline input").hasClass("focused")||formProcessing||(formProcessing=!0,lock(),e=appBrowser||isSafeMode()||!boxPopup.$popup.find(".formzone .bt-onofftext").hasClass("active"),o=boxPopup.$popup.find(".formzone #input-name"),t=boxPopup.$popup.find(".formzone #input-title"),n=boxPopup.$popup.find(".formzone #input-dedi"),i=o.val().substr(0,26),a=t.val().substr(0,26),s=n.val().substr(0,26),i=cleanInputText(i),a=cleanInputText(a),s=cleanInputText(s),c=regexList.classic,r=i.replace(/ /g,""),l=a.replace(/ /g,""),u=s.replace(/ /g,""),c.test(r)?invalidField(o):c.test(l)?invalidField(t):c.test(u)?invalidField(n):""===r?invalidField(o):""===l?invalidField(t):(deleteFocus(),boxPopup.$popup.find(".formzone input").blur(),c={mymix:!0,online:!1,name:ucwords(i),title:ucwords(a),dedi:ucwords(s),app:app.version,datedb:getDateNow(),link:getUniqLink(),private:e?1:0,nbview:0,nblike:0,xml:trim(recordMix.getXML())},u=boxPopup.$popup.find(".bt.valid"),Spinner.add(u),recordMix.setData(c),localMixObject.saveMix(c),mixToShare=c,setUserInfo({djname:ucwords(i)}),delete XHRmemotime.mymix,hasNetwork?(callAd("next","save-mix"),appBrowser?saveMixDB(c,p,(function(){boxDialog.open(STR("pop.noCoServerText"),STR("pop.noCoServerTitle"),[STR("bt.ok")]),Spinner.reset(),formProcessing=!1,unlock()})):saveMixDB(c,p)):appBrowser?(Spinner.reset(),formProcessing=!1,unlock(),boxDialog.open(STR("pop.noNetworkText"),STR("pop.noNetworkTitle"),[STR("bt.ok")],[])):p()))}function invalidField(e){e.addClass("invalid").one(animationEnd,(function(e){$(e.target).removeClass("invalid")})),formProcessing=!1,unlock()}function VKBopen(e){window.cordova&&isAndroid&&boxPopup.isOpen()&&"save-form"==boxPopup.$popup.attr("data-name")&&(e=e.keyboardHeight||.7*document.body.clientHeight,(androidKB=new FocusKeyboardAndroid).init(e))}function VKBclose(){window.cordova&&isAndroid&&boxPopup.isOpen()&&"save-form"==boxPopup.$popup.attr("data-name")&&androidKB&&(androidKB.kill(),androidKB=null)}function FocusKeyboardAndroid(){var e,o,t;function n(e){i(e.target)}function i(e){var t=(e=e.getBoundingClientRect()).top;e=e.height,t=Math.round(o-(t+e/2));TweenMax.to(boxPopup.$popup,.3,{scrollTo:{y:"-="+t},ease:Quad.easeInOut,overwrite:!0})}this.init=function(a){e=a,o=(document.body.clientHeight-e)/2,(t=document.querySelectorAll("#pop-popup[data-name=save-form] input[type=text]")).forEach((function(e){e.addEventListener("focus",n),document.activeElement==e&&i(e)})),boxPopup.$popup.addClass("VKBopen"),boxPopup.$popup.find(".bac").css({height:"calc(100% + "+e+"px)"}),window.cordova},this.kill=function(){t.forEach((function(e){e.removeEventListener("focus",n)})),TweenMax.to(boxPopup.$popup,0,{scrollTo:{y:0},overwrite:!0}),boxPopup.$popup.removeClass("VKBopen"),boxPopup.$popup.find(".bac").css({height:"100%"}),window.cordova}}function blurAll(){notnull(document.activeElement)&&document.activeElement.blur()}function listenFocus(){var e=!1;isIOS&&(document.addEventListener("focusin",(function(){e=!0})),document.addEventListener("focusout",(function(){e=!1,setTimeout((function(){e||window.scrollTo(0,0)}),250)})))}function popupConvertMix(){var e="action",o=appBrowserSchool&&miniPlayer?mixToWatch:mixToShare;$mixlist.hasClass("show")||appBrowserSchool||(e="action-back"),boxPopup.open({name:"convert-mix",icntype:e,content:"\n\t\t\t<div class='title'>"+STR("pop.convertMixTitle")+"</div>\n\t\t\t<div class='text'>"+STR("pop.convertMixText")+"</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div id='convert-loader-box' class='progress-box'><div class='progress-bar'></div></div>\n\t\t\t\t<a class='bt with-icn color download' id='bt-save-file'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg><div class='txt'>"+STR("bt.saveFile")+"</div></div><div class='hitzone'></div></a>\n\t\t\t\t<div class='spinner-box spin'><svg class='icn-svg col-version'><use xlink:href='#ic-loader'></use></svg></div>\n\t\t\t</div>",onBoxOpenEnd:function(){createFocus("popup-convert-mix"),boxPopup.$icon.on(pointerEventType.down,(function(){"action"==e?boxPopup.close():popupMixSaved()})),notnull(o)&&converterCanRun()?startConvert(o,boxPopup.$popup):popupGeneralError({error:"converter mix"})},onBoxCloseStart:function(){removeInFocusHistory("popup-convert-mix"),removeInFocusHistory("popup-convert-mix-ready"),createFocus("playlist-line-open"),boxPopup.$icon.off(),stopConvert()}})}function popupMixSaved(){formProcessing=!1,boxPopup.open({name:"mix-saved",icntype:"action",content:function(){var e=appBrowser?STR("pop.shareMixSaved"):STR("pop.shareMixSavedPlaylist")+"<br>"+STR("pop.shareShareTop50"),o=(e=1==mixToShare.private?e.split("<br>")[0]:e,"");return appBrowserSchool||(o=(o+="<div class='bt bt-haut link'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='txt'>"+STR("bt.link")+"</div><div class='hitzone'></div></div>")+"<div class='bt bt-haut share color-blue'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-share'></use></svg></div><div class='txt'>"+STR("bt.share")+"</div><div class='hitzone'></div></div>"),converterCanRun()&&(o+="<div class='bt bt-haut download hoverLocked'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='txt'>"+STR("bt.exportFile")+"</div><div class='ic-locked'><svg class='icn-svg'><use xlink:href='#ic-lock'></use></svg></div><div class='hitzone'></div></div>"),o+="<div class='bt bt-haut mixlist color hoverLocked'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-mixlist'></use></svg></div><div class='txt'>"+STR("bt.myMix")+"</div><div class='ic-locked'><svg class='icn-svg'><use xlink:href='#ic-lock'></use></svg></div><div class='hitzone'></div></div>","\n\t\t\t\t<div class='title'>"+STR("pop.shareTitle")+"</div>\n\t\t\t\t<div class='text'>"+e+"</div>\n\t\t\t\t<div class='content'>\n\t\t\t\t\t<div class='box-bt-haut'>"+o+"</div>\n\t\t\t\t</div>"},onBoxOpenEnd:function(){createFocus("popup-mix-saved"),boxPopup.$icon.on(pointerEventType.down,boxPopup.close),boxPopup.$popup.find(".bt.link").length&&boxPopup.$popup.find(".bt.link").on(pointerEventType.down,(function(e){var o=$(this);preventAction((function(){clickBtCopyLink(o)}))})),boxPopup.$popup.find(".bt.mixlist").length&&(appBrowser&&!appBrowserSchool?boxPopup.$popup.find(".bt.mixlist").on(pointerEventType.down,(function(e){dialogGetApp(e,!0)})):appBrowser&&appBrowserSchool?boxPopup.$popup.find(".bt.mixlist").on(pointerEventType.down,(function(e){callParentWindow("clickBtMixlist")})):boxPopup.$popup.find(".bt.mixlist").on(pointerEventType.down,(function(e){preventAction(clickBtGoToMixlist)}))),boxPopup.$popup.find(".bt.download").length&&(appBrowser&&!appBrowserSchool?boxPopup.$popup.find(".bt.download").on(pointerEventType.down,(function(e){dialogGetApp(e,!0)})):appBrowser&&appBrowserSchool?boxPopup.$popup.find(".bt.download").on(pointerEventType.down,(function(){callParentWindow("exportMP3")})):boxPopup.$popup.find(".bt.download").on(pointerEventType.down,(function(){preventAction(popupConvertMix)}))),boxPopup.$popup.find(".bt.share").on(pointerEventType.down,(function(e){var o=$(this);preventAction((function(){clickBtShareGlobal(o)}))})),unlock()},onBoxCloseStart:function(){deleteFocus(),boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off()},onCloseComplete:function(){onGame&&createFocus("toolbar"),mixToShare={}}})}function popupGlobalShare(){var e=$mixlist.isOpen()?"action":"action-back";boxPopup.open({name:"global-share",icntype:e,class:miniPlayer?"mini":"",content:"\n\t\t\t<div class='title'>"+STR("bt.share")+"</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div class='box-bt-haut'>\n\t\t\t\t\t<div class='bt bt-haut mail'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-mail'></use></svg></div><div class='txt'>Mail</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut color-facebook'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-facebook'></use></svg></div><div class='txt'>Facebook</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut color-twitter color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-twitter'></use></svg></div><div class='txt'>Twitter</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut link color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='txt'>"+STR("bt.link")+"</div><div class='hitzone'></div></div>\n\t\t\t\t</div>\n\t\t\t</div>",onBoxOpenEnd:function(){createFocus("popup-global-share"),boxPopup.$popup.find(".bt.mail").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){shareMix("mail")}))})),boxPopup.$popup.find(".bt.color-facebook").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){shareMix("facebook")}))})),boxPopup.$popup.find(".bt.color-twitter").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){shareMix("twitter")}))})),boxPopup.$popup.find(".bt.link").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){shareMix("clipboard")}))})),"action"==e?boxPopup.$icon.on(pointerEventType.down,boxPopup.close):boxPopup.$icon.on(pointerEventType.down,popupMixSaved),unlock()},onBoxCloseStart:function(){removeInFocusHistory("popup-global-share"),deleteFocus(),boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off()},onBoxCloseEnd:function(){createFocusFromHistory(),Spinner.reset()}})}function popupEmail(){boxPopup.open({name:"email-form",icntype:"action-back",class:miniPlayer?"mini":"",content:"\n\t\t\t<div class='title'>"+STR("pop.formEmailTitle")+'</div>\n\t\t\t<div class=\'content\'>\n\t\t\t\t<form action=\'javascript:clickBtValidFormEmail()\' method=\'post\' target=\'_self\' autocomplete=\'off\'>\n\t\t\t\t\t<div class=\'formzone\'>\n\t\t\t\t \t\t<div class="formline ic-name"><div class="icn-box"><svg class="icn-svg"><use xlink:href="#ic-user-mini"></use></svg></div><input type="text" id="input-name" placeholder="'+STR("txt.inputEmailSender")+'" value="'+(notnull(user.djname)?user.djname:"")+"\" maxlength=\"26\" autocorrect=\"off\" spellcheck=\"false\"/></div>\n\t\t\t\t\t\t<div class='formline ic-email'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-at-mini'></use></svg></div><input type='email' id='input-email' placeholder='"+STR("txt.inputEmailRecipient")+"' value='' maxlength='254' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='btzone'>\n\t\t\t\t\t\t<div class='bt bt-round bt-big valid'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-check'></use></svg></div><div class='hitzone'></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type='submit' style='visibility:hidden;position:absolute'/><div class='clear'></div>\n\t\t\t\t</form>\n\t\t\t</div>",onBoxOpenEnd:function(){createFocus("popup-email-form"),boxPopup.$icon.on(pointerEventType.down,popupGlobalShare),boxPopup.$popup.find(".bt.valid").on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickBtValidFormEmail)}))},onBoxCloseStart:function(){removeInFocusHistory("popup-email-form"),deleteFocus(),boxPopup.$icon.off(),blurAll()},onBoxCloseEnd:function(){formProcessing=!1}})}function clickBtValidFormEmail(){var e,o,t,n,i,a,s,r,l,c;boxPopup.$popup.find(".formzone .formline input").hasClass("focused")||(e=domainOnline+"mix/"+mixToShare.link,o=mixToShare.title,t=mixToShare.name,formProcessing)||(formProcessing=!0,lock(),n=boxPopup.$popup.find(".formzone #input-name"),i=boxPopup.$popup.find(".formzone #input-email"),a=n.val().substr(0,26),s=i.val().substr(0,254),a=cleanInputText(a,n),s=trim(s),c=a.split(" ").join(""),r=s.toLowerCase(),""==c||regexList.classic.test(c)?invalidField(n):""!=r&&regexList.email.test(r)?(boxPopup.$popup.find(".formzone input").blur(),blurAll(),l=boxPopup.$popup.find(".bt.valid"),Spinner.add(l),hasNetwork?((c={}).expediteur=a,c.email=s,c.type="composition",c.djName=t,c.title=o,c.link=e,c.src=window.electron?"electron":window.cordova?"cordova":"browser",c.lang=currentLanguage.split("-")[0],xhr("POST",domainOnline+"ph3/send-mail.php",c,(function(e){"success"==e.state?(Spinner.reset(),l.addClass("success"),TweenMax.delayedCall(.6,(function(){unlock(),popupGlobalShare()}))):(boxDialog.open(STR("pop.shareErrorText"),STR("pop.shareErrorTitle"),[STR("bt.ok")],[function(){Spinner.reset()}]),formProcessing=!1,unlock())}),(function(e){formProcessing=!1,boxDialog.open(STR("pop.shareErrorText"),STR("pop.shareErrorTitle"),[STR("bt.ok")],[function(){Spinner.reset()}]),unlock()}))):(formProcessing=!1,boxDialog.open(STR("pop.noNetworkText"),STR("pop.noNetworkTitle"),[STR("bt.ok")],[function(){Spinner.reset()}]),unlock())):invalidField(i))}function saveMixDB(e,o,t){}function clickBtShareGlobal(e){checkIfMixSavedThenShare("global",e||$(this))}function clickBtCopyLink(e){checkIfMixSavedThenShare("clipboard",e||$(this))}function clickBtGoToMixlist(){backToHome((function(){openPlaylist("mixlist",!0,!0)}))}function checkIfMixSavedThenShare(e,o){lock(),deleteFocus(),Spinner.add(o),hasNetwork?!0!==mixToShare.mymix||mixToShare.online?shareMix(e):saveMixDB(mixToShare,(function(){$scrollbox.find(".line[data-key='mix-"+mixToShare.link+"']").removeClass("isoffline"),shareMix(e)}),(function(e){boxDialog.open(STR("pop.noCoServerText"),STR("pop.noCoServerTitle"),[STR("bt.ok")],[]),Spinner.reset(),unlock()})):(o=$mixlist.hasClass("show")?STR("pop.noCoShareText"):STR("pop.noCoShareText")+" "+STR("pop.noCoShareText2"),boxDialog.open(o,STR("pop.noNetworkTitle"),[STR("bt.ok")],[function(){Spinner.reset()}]),unlock())}function shareMix(e,o){if(null==o&&window.cordova&&window.plugins&&window.plugins.socialsharing)return TweenMax.delayedCall(.5,shareMix,[e,!0]),!1;"global"!=e&&Spinner.reset();o=mixToShare.name;var t=mixToShare.title,n=domainOnline+"mix/"+mixToShare.link,i=domainOnline+"img/share/share-v"+app.version+"-en@2x.png",a=domainOnline+"img/share/share-v"+app.version+"-en.png",s=STR("pop.shareSubject"),r=(o=STR("pop.sharePresentMix").split("%{name}").join(o).split("%{title}").join(t),t=STR("pop.shareTextLike"),STR("pop.shareTextBeCool")),l=o+"\n"+n+"\n\n"+t+"\n\n---------------------------\n\nDownload the app: https://www.incredibox.com/info/store",c=(t=r+" #incredibox",o+" "+r+" #incredibox"),u="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(n),p="https://twitter.com/intent/tweet?text="+encodeURIComponent(t)+"&url="+encodeURIComponent(n)+"&hashtags=musicApp,beatbox,pumpItUp&related=incredibox_%3AThe%20Incredibox%20official%20Twitter%20account!";switch(e){case"mail":window.cordova&&window.plugins&&window.plugins.socialsharing?window.plugins.socialsharing.shareViaEmail(l,s,null,null,null,[a],m,f):popupEmail();break;case"facebook":window.electron?openURL(u):windowPopup(u,560,350,!0);break;case"twitter":window.electron?openURL(p):windowPopup(p,560,350,!0);break;case"clipboard":window.electron?electron.ipc.clipboard(n).then((()=>d())).catch((e=>popupGeneralError({error:"clipboard"}))):window.cordova&&cordova.plugins&&cordova.plugins.clipboard?cordova.plugins.clipboard.copy(n,d,f):(copyToClipboard(n),d(n));break;case"global":window.plugins&&window.plugins.socialsharing?(window.plugins.socialsharing.shareWithOptions({message:c,subject:s,url:n,files:[i]},(e=>{}),(e=>{f(e)})),m()):(popupGlobalShare(),Spinner.reset());break;case"download":openURL(domainOnline+"file/"+mixToShare.link),m()}function d(e){var o;appBrowser?(e="<div class='formline'><div class='selectarea'>"+e.replace("https://www.","")+"</div></div>",o=isIOS?"":STR("pop.shareClipboard"),boxDialog.open(e+o,STR("bt.link"),[STR("bt.ok")],[],!1,!1,"dialog-clipboard")):boxDialog.open(STR("pop.shareClipboard"),STR("pop.infoTitle"),[STR("bt.ok")],[],!1,!1,"dialog-clipboard"),m(),unlock()}function m(e){Spinner.reset(),unlock()}function f(e){popupGeneralError({txt:STR("pop.shareErrorText"),error:e}),Spinner.reset(),unlock()}}function sendFeedback(){var e="feedback@incredibox.com",o="App feedback",t="<br><br>----------";window.cordova?o+=" - "+(appleModel[device.model]||device.model)+" "+device.platform+" "+device.version+(isIOSMac?" (iOS on Mac)":""):o+=" - "+machine.deviceModel+" "+machine.osName+" "+machine.osVersion,t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+="<br>Store : "+build.store)+"<br>From : "+ucwords(build.platform)+" - "+(void 0!==app?app.name+" - v"+app.version:"index"))+"<br>Version : "+build.version)+"<br>DJ Name : "+user.djname)+"<br>Ids : "+machine.uuid+" - "+user.guid+(trustAppMobile?" - "+device.serial:""))+"<br>Lang : "+user.lang+" ("+currentLanguage+")")+"<br>Device : "+machine.deviceModel+" - "+document.body.clientWidth+"x"+document.body.clientHeight+" - "+(window.devicePixelRatio||1))+"<br>System : "+machine.osName+" - "+machine.osVersion+(isIOSMac?" - iOS on Mac":""))+"<br>WV : "+machine.browserFullVersion)+"<br>Anime size "+animSize+" - cnv density "+cnvPXD+"<br>fileExt : "+sndExt+" "+vidExt)+"<br>Evt : "+pointerEventType.down)+"<br>SpRate : "+(window.audioCtx&&window.audioCtx.sampleRate?audioCtx.sampleRate:"")+" - "+(window.audioCtx&&window.audioCtx.baseLatency?audioCtx.baseLatency:""),window.cordova&&window.plugins&&window.plugins.socialsharing?(t=(t=(t+="<br>----------")+"<br>App.device : "+(appleModel[device.model]||device.model)+" - "+device.manufacturer)+"<br>App.system : "+device.platform+" - "+device.version,window.plugins.socialsharing.shareViaEmail("<br><br><br><i>"+t+"</i>",o,e,null,null,[],(()=>{}),(e=>{popupGeneralError({txt:STR("pop.shareErrorText"),error:e})}))):(t=t.replace(/<br>/g,"\r\n"),e="mailto:"+e+"?subject="+o+"&body="+encodeURIComponent(t),window.electron?electron.ipc.openURL(e):window.location.href=e)}var tabBuffer,tabAnime,nbSound,nbSoundBonus,nbSoundTotal,nbBonus,nbAnime,nbData,cntTotalAsset,nbTotalAsset,tabToLoad,cntLoad,languageListe={"en-US":"English"};function initLanguage(){var e;currentLanguage=defaultLanguage=appCN?"zh-CN":"en-US";var o="";for(e in languageListe)o+='<div class="bt bt-soft" id="bt-lang-'+e+'"><div class="bck"><div class="txt">'+languageListe[e]+'</div></div><div class="hitzone"></div></div>';$("#pop-language .box-lang").append(o)}function checkLanguageCode(e){var o=e.toLowerCase();return o.indexOf("en-")>-1?"en-US":o.indexOf("pt-")>-1?"pt-BR":o.indexOf("fr-")>-1?"fr":o.indexOf("es-")>-1?"es":o.indexOf("it-")>-1?"it":o.indexOf("de-")>-1?"de":o.indexOf("cn")>-1?"zh-CN":"zh-hant"==o||"zh-hk"==o||"zh-tw"==o?"zh-TW":"zh-hans"==o||"zh-cn"==o?"zh-CN":"en"==o?"en-US":"pt"==o?"pt-BR":"zh"==o?"zh-CN":"hi"==o?"hi-IN":"bn"==o?"bn-IN":"ta"==o?"ta-IN":"te"==o?"te-IN":"nb"==o||"nn"==o?"no":e}function debugLanguage(){}function changeDomTxt(){var e,o=translateObj.trad;$("#pop-info .tab#tab-tuto .txt").html(o.bt.tuto),$("#pop-info #bloc-tuto1 .txt span").html(o.txt.tuto1),$("#pop-info #bloc-tuto2 .txt span").html(o.txt.tuto2),$("#pop-info #bloc-tuto3 .txt span").html(o.txt.tuto3),$("#pop-info #bloc-tuto4 .txt span").html(o.txt.tuto4),$("#pop-info #bloc-tuto5 .txt span").html(o.txt.tuto5),$("#pop-info .tab#tab-credit .txt").html(o.bt.credit),$("#pop-info #pop-credit #copy").html(o.txt.copyright),$("#pop-info #pop-credit #team").html("<div class='box-team'>Allan Durand<br>Romain Delambily<br>Incredible Polo</div><div class='box-team'>"+o.txt.team+"</div>"),$("#pop-info #pop-credit .title").html(o.txt.stayTuned),$("#pop-info #pop-credit #bt-feedback .txt").html(o.bt.feedback),$("#pop-info #pop-credit #bt-rating .txt").html(o.bt.rate),$("#pop-info #pop-credit #bt-privacy .txt").html(o.bt.privacy),$("#pop-info .tab#tab-follow .txt").html(o.bt.follow),$("#pop-info #pop-follow .title#git").html(o.bt.git),$("#pop-info #pop-follow .title#shop").html(o.txt.visitShop),$("#pop-param .tab#tab-language .txt").html(o.txt.language),$("#pop-param .tab#tab-setting .txt").html(o.bt.param),$("#pop-param #pop-setting #param-dark .label").html(o.txt.modeDark),$("#pop-param #pop-setting #param-safe .label").html(o.txt.modeSafe),$("#pop-param #pop-setting #param-reset .label").html(o.txt.resetBonus),$("#pop-param #pop-setting #param-reset .bt .txt").html(o.bt.reset),$("#pop-param #pop-setting #param-recover .label").html(o.txt.recoverAllMix),$("#pop-param #pop-setting #param-recover .bt .txt").html(o.bt.recover),$("#pp-box #bt-ppaccept .txt").html(o.bt.accept),$("#pp-box #bt-pprefuse .txt").html(o.bt.refuse),pageApp?($("#mixlist .tab#tab-latest .txt").html(o.bt.latest),$("#mixlist .tab#tab-top50 .txt").html(o.bt.top50),$("#mixlist .tab#tab-search .txt").html(o.bt.search),$("#mixlist .tab#tab-mixlist .txt").html(o.bt.myMix),$("#mixlist #box-search #input-search").attr("placeholder",o.txt.inputSearch),$("#mixlist #box-search #input-search").val(""),lastSearch="",cleanListSearch(),$("#mixlist .tab-filter #bt-name .txt").html(o.bt.djname),$("#mixlist .tab-filter #bt-title .txt").html(o.bt.mixtitle),$("#mixlist .tab-filter #bt-dedi .txt").html(o.txt.dedicatedTo.split("%{name}").join("")),$("#mixlist .tab-filter #bt-day .txt").html(o.bt.day),$("#mixlist .tab-filter #bt-week .txt").html(o.bt.week),$("#mixlist .tab-filter #bt-month .txt").html(o.bt.month),$("#mixlist .tab-filter #bt-year .txt").html(o.bt.year),$("#mixlist .scroll:not(#list-mymix) .infoListmix").html(o.txt.top50Info),mixDB.totalNbMix>0?$("#mixlist #latestbox .boxinfo").html(o.txt.latestMixInfo.replace("%{mix_total}",numberSpaced(mixDB.totalNbMix)).replace("%{version_name}",app.name)):$("#mixlist #latestbox .boxinfo").html(o.txt.latestMixInfo.split("<br>")[0]),$("#mixlist #list-day .boxinfo").html(o.txt.top50Info),$("#mixlist #list-week .boxinfo").html(o.txt.top50Info),$("#mixlist #list-month .boxinfo").html(o.txt.top50Info),$("#mixlist #list-year .boxinfo").html(o.txt.top50Info),$("#mixlist .box-info .offline .txt").html(o.txt.offline),$("#watch-info #bt-save .txt").html(o.bt.save),$("#watch-info .offline .txt").html(o.txt.offline),notnull(localMixObject)&&(e=0==localMixObject.getMixlist().length?STR("txt.mixlistEmpty"):STR("txt.mixlistInfo"),$("#list-mymix .boxinfo",$poplist).html(e)),$("#watch-info .date, .box-info .date").each((function(){var e;$(this).attr("data-date")&&(e=$(this).attr("data-date"),$(this).html(getStringDate(e)))})),$("#pop-switch .title").html(o.txt.enjoyVersion),$("#game #box-bt1 #bt-stop .txt").html(o.bt.menuRestart),$("#game #box-bt1 #bt-random .txt").html(o.bt.menuRandom),$("#game #box-bt1 #bt-record .txt").html(o.bt.menuRecord)):($("#page-splash #sp-baseline").html(STR("txt.baseline")),$("#page-splash #sp-experience").html(STR("txt.sp-experience")),$("#page-splash #sp-choose").html(STR("txt.selectVersion"))),notnull(boxPopup)&&boxPopup.isOpen()&&boxPopup.refresh()}function loadLanguage(e){var o,t=notnull(o=e&&e.lang?e.lang:null)&&notnull(languageListe[o])?o:notnull(user.lang)&&""!=user.lang?user.lang:""!=machine.language?machine.language:defaultLanguage;function n(){return e&&e.fail?e.fail():loadLanguageFailed(),!1}appBrowser&&(t=getParameterByName("lang")?getParameterByName("lang"):machine.language),window.electron&&isnull(o)&&""==user.lang&&notnull(electron.vars.lang)&&(t=checkLanguageCode(electron.vars.lang)),t=checkLanguageCode(t),isnull(languageListe[t])&&(t=defaultLanguage),$("#pop-language .box-lang .bt-soft#bt-lang-"+t).addClass("active"),notnull(translateObj)&&$("body").removeClass("lang-"+currentLanguage),(o=new XMLHttpRequest).addEventListener("load",(function(){if(200!=this.status)return n(),!1;translateObj=jsonDecode(this.responseText),setUserInfo({lang:currentLanguage=t}),$("body").addClass("lang-"+currentLanguage),e&&e.cbck&&e.cbck(),saveGA("language","load_success",currentLanguage)}),!1),o.addEventListener("error",n,!1),o.open("GET","./lang/"+t+".json"),o.send()}function loadLanguageFailed(){setUserInfo({lang:defaultLanguage}),boxDialog.open("Impossible to load language settings. Please reload or force to quit the app then retry.","ERROR",["Reload"],[gotoAppUrl],!0)}function clickBtLang(e){var o=(e=$(e.currentTarget)).attr("id").replace("bt-lang-","");e.hasClass("active")||($("#pop-language .box-lang .bt").removeClass("active"),e.addClass("active"),loadLanguage({cbck:changeDomTxt,lang:o}))}function STR(e){for(var o=e.split("."),t=translateObj.trad,n=0,i=o.length;n<i;n++){var a=o[n];if(!(a in t))return;t=t[a]}return t}var listImages={};function preparerArray(){frameTotal=app.totalframe,frameHalf=frameTotal/2,tabBuffer={},tabAnime=[],nbSound=app.animearray.length,nbSoundBonus=app.bonusarray.length,nbSoundTotal=2*nbSound+nbSoundBonus+1,nbBonus=app.bonusarray.length,nbAnime=app.animearray.length,nbData=app.animearray.length,nbTotalAsset=nbSoundTotal+nbBonus+nbAnime+nbData+2,tabToLoad=[];var e=cntLoad=cntTotalAsset=0,o="";for(tabBuffer.sound=[],e=0;e<nbSound;e++)tabBuffer.sound.push({sndA:0,sndB:0}),tabAnime.push({imgSprite:null,ratio:null,width:null,height:null,headWidth:null,headHeight:null,upsideDown:null,shakeAnim:null,dontWearHat:null,totalFrames:null,width:null,height:null,imgData:null,color:app.animearray[e].color});for(tabBuffer.bonus=[],e=0;e<nbSoundBonus;e++)tabBuffer.bonus.push({snd:0,aspire:0,expire:0});for(tabBuffer.metro=[{snd:0}],tabToLoad=[{func:loadImage,params:{keyname:"spritePolo",path:"./img/"+renameFile(app.poloSprite?app.poloSprite:"polo-sprite.png")}},{func:loadImage,params:{keyname:"gameBck",path:"./"+app.folder+`img/${app.background?app.background:"game-bck@2x.jpg"}`}},{func:loadImage,params:{keyname:"gamePicto",path:"./"+app.folder+"img/game-picto@2x.png"}}],miniPlayer&&appVersion>4&&tabToLoad.pop(),e=0;e<nbSound;e++)app.animearray[e].uniqsnd?(tabToLoad.push({func:loadSound,params:["sound",app.animearray[e].soundA,e,"sndA",!0]}),nbTotalAsset--):(tabToLoad.push({func:loadSound,params:["sound",app.animearray[e].soundA,e,"sndA"]}),tabToLoad.push({func:loadSound,params:["sound",app.animearray[e].soundB,e,"sndB"]}));for(e=0;e<nbSoundBonus;e++)tabToLoad.push({func:loadSound,params:["bonus",app.bonusarray[e].sound,e,"snd"]}),app.bonusarray[e].aspire&&tabToLoad.push({func:loadSound,params:["bonus",app.bonusarray[e].aspire,e,"aspire"]}),app.bonusarray[e].expire&&tabToLoad.push({func:loadSound,params:["bonus",app.bonusarray[e].expire,e,"expire"]}),o=renameFile(app.bonusarray[e].src),tabToLoad.push({func:loadVideoBonus,params:[o,e]});for(e=0;e<nbAnime;e++)o=app.animearray[e].animeData,tabToLoad.push({func:loadAnimeData,params:[o,e]}),o=renameFile(app.animearray[e].anime),tabToLoad.push({func:loadAnime,params:[o,e]});checkTabToLoad()}function checkTabToLoad(){updatePreload(),cntLoad<tabToLoad.length&&(tabToLoad[cntLoad].func(tabToLoad[cntLoad].params),cntLoad++)}function updatePreload(){cntTotalAsset++;var e=(e=Math.round(cntTotalAsset/nbTotalAsset*100))<5?5:e;$homeLoadbar.css({width:String(e>100?100:e)+"%"}),cntTotalAsset==nbTotalAsset&&(createGame(),hideHomeLoadbar(),isIframe)&&callParentWindow("appLoadingComplete")}function loadSound(e){var o=e[0],t=e[1],n=e[2],i=e[3],a=e[5]||sndExt,s=!isnull(e[4])&&e[4],r="./"+app.folder+"sound/"+a+"/"+t+"."+sndExt,l=new XMLHttpRequest;l.open("GET",r,!0),l.responseType="arraybuffer",l.onload=function(){audioCtx.decodeAudioData(l.response,(function(e){tabBuffer[o][n][i]=e,s&&(tabBuffer[o][n].sndB=e),checkTabToLoad()}),(function(e){popupGeneralError({error:"Decoding "+r.replace("./",""),action:"reload"})}))},l.onerror=function(){popupGeneralError({error:"XHR "+r.replace("./",""),action:"reload"})},l.send()}function loadAnimeData(e){var o=e[0],t=e[1],n="./"+app.folder+"anime/"+o,i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="json",i.onload=function(){for(var e=i.response,o=e.arrayFrame,a=o.length,s=[],r=[],l=0;l<a;l++){var c=o[l].prop.split(","),u=[parseInt(c[0]),parseInt(c[1]),parseFloat(c[2]),parseFloat(c[3]),c[4]?c[4].trim():""];if(s.push(u),o[l].object){var p=o[l].object.split(","),d=[parseInt(p[0])||0,parseInt(p[1])||0,parseFloat(p[2])||0,parseFloat(p[3])||0];r.push(d)}else r.push([0,0,0,0])}tabAnime[t].imgData=s,tabAnime[t].headHeight=e.headHeight,tabAnime[t].upsideDown=e.upsideDown,tabAnime[t].shakeAnim=e.shakeAnim,tabAnime[t].dontWearHat=e.dontWearHat,tabAnime[t].width=e.width,tabAnime[t].height=e.height,r.some((e=>e.some((e=>0!==e))))&&(tabAnime[t].bodyData=r,tabAnime[t].objectWidth=e.objectWidth*animSize||164*animSize,tabAnime[t].objectHeight=e.objectHeight*animSize||380*animSize,tabAnime[t].objectBack=e.objectBack||!1,tabAnime[t].renderBody=e.renderBody,tabAnime[t].bodySprite=n,console.log(`Body animation loaded: ${r.length} frames, dimensions: ${tabAnime[t].objectWidth}x${tabAnime[t].objectHeight}, front: ${tabAnime[t].objectBack} Sprite: ${e.bodySprite}`)),checkTabToLoad()},i.onerror=function(){popupGeneralError({error:"XHR "+n.replace("./",""),action:"reload"})},i.send()}function loadAnime(e){var o=e[0],t=e[1],n="./"+app.folder+"anime/"+o,i=new Image;i.onload=function(){tabAnime[t].imgSprite=i,checkTabToLoad()},i.onerror=function(){popupGeneralError({error:"Load "+n.replace("./",""),action:"reload"})},i.src=n}function loadVideoBonus(e){var o=e[0],t="./"+app.folder+"video/"+o,n=e[1]+1;(e=new XMLHttpRequest).onload=function(){var e=this.response,t=document.createElement("video");t.src=window.URL.createObjectURL(e),t.type="video/"+vidExt,t.muted=!0,t.setAttribute("playsinline","playsinline"),t.setAttribute("webkit-playsinline","webkit-playsinline"),t.setAttribute("muted",""),t.onerror=function(e){popupGeneralError({error:"Video "+o})},t.oncanplaythrough=function(e){t.oncanplaythrough=null,$boxVideo.prepend("<div class='video' id='video"+n+"'></div>"),$boxVideo.find(".video#video"+n).append(t),checkTabToLoad()},t.load()},e.onerror=function(){popupGeneralError({error:"XHR "+t.replace("./",""),action:"reload"})},e.open("GET",t),e.responseType="blob",e.send()}function preloadImageForCSS(e){var o=e.images.length,t=0,n={};!function i(){var a=new Image,s=e.images[t][0],r=e.images[t][1];a.onload=function(){n[s]=this,t++,e.progress(Math.floor(100*t/o)),t==o?e.good(n):i()},a.onerror=function(){var o=r.split("/").pop();e.nope(o)},a.src=r}()}function loadImage(e){var o=new Image;o.onload=function(){listImages[e.keyname]=this,checkTabToLoad()},o.onerror=function(){popupGeneralError({error:"Load "+e.path.replace("./",""),action:"reload"})},o.src=e.path}function CloudSync(){return this.sync=function(e){notnull(e)},this.save=nada,this.remove=nada,this}function LocalStorage(){var e=this;return this.setItem=function(e,o,t){window.localStorage.setItem(e,o),t&&cloud.save(e,o)},this.getItem=function(e){return window.localStorage.getItem(e)},this.getAllItem=function(){return window.localStorage},this.removeItem=function(e,o){window.localStorage.removeItem(e),o&&cloud.remove(e)},this.clear=function(){window.localStorage.clear()},this.weight=function(){var e,o,t=window.localStorage,n=0,i="LS | --------------------------\n";for(o in t)n+=e=2*(t[o].length+o.length),i+="LS | "+o.substr(0,50)+" = "+(e/1024).toFixed(2)+" KB\n";return i+"LS | Total = "+(n/1024).toFixed(2)+" KB\nLS | --------------------------"},this.restoreMixFromDB=function(o){var t={};t.uuid=getListUUID(),t.guid=getUserInfo().guid,t.mixids=localMixObject.getAllMixId();var n=o||nada;hasNetwork&&(t.uuid.length||t.user.guid||t.mixids.length)&&$.ajax({type:"POST",url:domainOnline+"ph3/get-all-mix-db.php",data:t,dataType:"json",crossdomain:!0,success:function(o){"success"==o.state?(o.mixlist.forEach((function(e){e.synced=!0,e.online=!0,e.mymix=!0,localMixObject.saveMix(e),localMixObject.getMix("fav-"+e.link)&&localMixObject.saveMix(e,!0)})),localMixObject.getAllMix().forEach((function(o){o.mymix&&o.online&&!o.synced&&(e.removeItem("mix-"+o.link),e.removeItem("fav-"+o.link))})),getListUUID().forEach((function(t){t.toUpperCase()==machine.uuid.toUpperCase()||existInArray(o.uuidlist,t,!1)||e.removeItem("uuid-"+t,!0)})),o.uuidlist.forEach((function(o){e.setItem("uuid-"+o.toUpperCase(),"",!0)})),n({msg:"ok",nb:o.mixlist.length})):n({msg:"bug"})},error:function(e){n({msg:"error"})}})},this}function LocalMixObject(){var e=this;this.saveMix=function(e,o){var t;o=!!notnull(o)&&o;return!!notnull(e)&&(t=-1==e.link.indexOf("mix-")?"mix-"+e.link:e.link,t=o?t.replace("mix-","fav-"):t,o=jsonEncode(e),storage.setItem(t,o),!0)},this.deleteMix=function(e){return!!notnull(storage.getItem(e))&&(storage.removeItem(e,!0),!0)},this.deleteMixById=function(o){var t,n=e.getAllMix(!0),i=e.getAllMix(!0,!0);for(t in n)n[t].id==o&&(e.deleteMix("mix-"+n[t].link),e.deleteMix("fav-"+n[t].link));for(t in i)i[t].id==o&&(e.deleteMix("fav-"+i[t].link),e.deleteMix("mix-"+i[t].link))},this.getMix=function(e){return!!notnull(storage.getItem(e))&&jsonDecode(storage.getItem(e))},this.getAllMix=function(e,o){var t,n,i=!!notnull(e)&&e,a=(e=!!notnull(o)&&o,[]),s=storage.getAllItem(),r=e?"fav-":"mix-";for(t in s)-1!=t.indexOf(r)&&(isnull((n=jsonDecode(s[t])).datedb)&&(n.datedb=notnull(n.date)?n.date:getDateNow()),i&&-1==t.indexOf("v"+app.version)&&-1==t.indexOf("-IOSV"+app.version)||a.push(n));return a},this.saveMixOffline=function(){var o,t=e.getAllMix();for(o in t){var n=t[o];!n.online&&n.mymix&&saveMixDB(n)}},this.getAllMixId=function(){var o,t=e.getAllMix(!1),n=[];for(o in t){var i=t[o];i.id&&n.push(parseInt(i.id))}return n},this.getMixlist=function(){var o=e.getAllMix(!0,!1);return e.sortArrayMix(o)},this.getFavlist=function(){var o=e.getAllMix(!0,!0);return e.sortArrayMix(o)},this.sortArrayMix=function(e,o){return e.sort((function(e,o){return o.datedb>e.datedb?1:o.datedb<e.datedb?-1:0})),!0===o?e.reverse():e},this.getLastMix=function(){var o=e.getAllMix(!1),t=o.length;return t>0?o[t-1]:null},this.getLastDjName=function(){var o=e.getLastMix();return notnull(o)?o.name:""},this.deleteAllMix=function(){for(var e in storage.getAllItem())-1==e.indexOf("mix-")&&-1==e.indexOf("fav-")||storage.removeItem(e)},this.getStatMixOnline=function(o){var t=e.getAllMixId();t.length?xhr("GET",domainOnline+"ph3/get-stat-mix.php",{id:t},(function(n){if("success"==n.state){XHRmemotime.mymix=new Date;n=n.list;var i=[];if(n.forEach((function(o){i.push(parseInt(o.id));var t=e.getMix("mix-"+o.link);t.id=o.id,t.newnbview=o.nbview,t.newnblike=o.nblike,e.saveMix(t)})),i.length<t.length){var a;n=uniqueBetweenArray(i,t);for(a of n)e.deleteMixById(a)}void 0!==o&&o()}}),(function(e){})):void 0!==o&&o()},this.getStatFavOnline=function(o){var t=e.getFavlist(),n=[];t.forEach((function(e){e.mymix&&!e.online||!notnull(e.id)||n.push(parseInt(e.id))})),n.length?xhr("GET",domainOnline+"ph3/get-stat-mix.php",{id:n},(function(t){if("success"==t.state){XHRmemotime.myfav=new Date;t=t.list;var i=[];if(t.forEach((function(o){i.push(parseInt(o.id));var t=e.getMix("fav-"+o.link);t.id=o.id,t.nbview=o.nbview,t.nblike=o.nblike,e.saveMix(t,!0)})),i.length<n.length){var a;t=uniqueBetweenArray(i,n);for(a of t)e.deleteMixById(a)}void 0!==o&&o()}}),(function(e){})):void 0!==o&&o()}}const defaultBonusSVG='<svg viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg"><path fill="#ffffff" d="M 56.7 34.35Q 52.95 27.7 47.2 23.95 41.45 20.2 35.2 20.2 28.85 20.2 23.1 24 17.3 27.9 13.6 34.35 12.85 35.15 13.6 35.75 17.3 42.55 23.1 46.25 28.75 50 35.2 50 41.3 50 47.2 46.2 52.75 42.5 56.7 35.75 56.9 35.15 56.7 34.35M 35.2 28Q 38 28 40.2 30.2 42.2 32.2 42.2 35.1 42.2 38 40.2 40.1 38 42.25 35.2 42.25 32.2 42.25 30.1 40.1 28.1 38.2 28.1 35.1 28.1 32.25 30.2 30.2 32.35 28 35.2 28M 114.25 23.9Q 114.25 20.5 111.65 17.75 108.8 14.9 104.9 14.9 100.95 14.9 98.1 17.75 95.35 20.6 95.35 23.9L 95.35 29.25 92.75 29.25Q 91.85 29.25 91.1 30 90.45 30.6 90.45 31.55L 90.45 49Q 90.45 50 91.1 50.5 91.85 51.25 92.75 51.25L 117.15 51.25Q 118.1 51.25 118.75 50.5 119.45 49.95 119.45 49L 119.45 31.55Q 119.45 30.6 118.75 30 118.1 29.25 117.15 29.25L 114.25 29.25 114.25 23.9M 109.25 20.25Q 110.9 22.05 110.9 23.9L 110.9 29.25 98.85 29.25 98.85 23.9Q 98.85 21.95 100.5 20.25 102.25 18.3 104.9 18.3 107.4 18.3 109.25 20.25 Z"/></svg>',lockedBonusSVG='<svg viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg"><path fill="#ffffff" d="M 44.3 29.25L 44.3 23.9Q 44.3 20.5 41.7 17.75 38.85 14.9 34.95 14.9 31 14.9 28.15 17.75 25.4 20.6 25.4 23.9L 25.4 29.25 22.8 29.25Q 21.9 29.25 21.15 30 20.5 30.6 20.5 31.55L 20.5 49Q 20.5 50 21.15 50.5 21.9 51.25 22.8 51.25L 47.2 51.25Q 48.15 51.25 48.8 50.5 49.5 49.95 49.5 49L 49.5 31.55Q 49.5 30.6 48.8 30 48.15 29.25 47.2 29.25L 44.3 29.25M 40.95 23.9L 40.95 29.25 28.9 29.25 28.9 23.9Q 28.9 21.95 30.55 20.25 32.3 18.3 34.95 18.3 37.45 18.3 39.3 20.25 40.95 22.05 40.95 23.9M -52.7 37Q -52.5 36.4 -52.7 35.6 -56.45 28.95 -62.2 25.2 -67.95 21.45 -74.2 21.45 -80.55 21.45 -86.3 25.25 -92.1 29.15 -95.8 35.6 -96.55 36.4 -95.8 37 -92.1 43.8 -86.3 47.5 -80.65 51.25 -74.2 51.25 -68.1 51.25 -62.2 47.45 -56.65 43.75 -52.7 37M -69.2 31.45Q -67.2 33.45 -67.2 36.35 -67.2 39.25 -69.2 41.35 -71.4 43.5 -74.2 43.5 -77.2 43.5 -79.3 41.35 -81.3 39.45 -81.3 36.35 -81.3 33.5 -79.2 31.45 -77.05 29.25 -74.2 29.25 -71.4 29.25 -69.2 31.45 Z"/></svg>';function BonusObject(e,o,t){const n=this,i=e+1,a=$(`#bt-bonus-${i}`),s=a.find(".quarter"),r=$(".circle",a),l=$(`#box-video .video#video${i}`),c=$(`#box-video .video#video${i} video`)[0],u=new SoundObject("bonus"+i),p=new SoundObject("aspire"+i),d=new SoundObject("expire"+i),m=t.snd,f=t.aspire,v=t.expire||"",h=numberArray(o.code.split(",")),b=h.length,g=[];let x,w=0,y=!1,k=0;const T=a.find(".box-loader .zone"),C=T.find(".loader"),D=T.find(".bar"),S=new ClockObject("canvas-bt-bonus-"+i);S.init(43,43,1,35,16),this.$div=l,this.tabSVG=g,this.video=c,this.found=!1,this.unlock=!1,this.cntCode=0,this.nbLoop=o.loop,this.sound=u,this.inprogress=!1,this.init=function(){const e=storage.getItem("v"+appVersion+"-bonus-complete")||0;0==n.getId()||n.getId()<=e?n.unlockme():n.lockme();for(let e=0;e<b;e++)g.push({obj:$(`.svg.q${e+1}`,s),col:$(`.svg.q${e+1} svg`,s).css("fill")});n.modeTouch(),n.initBonusIcon()},this.reinit=function(){n.hideLoader(),a.removeClass("inprogress found bounce"),s.find(".svg").removeClass("directshow show hide"),n.found=!1,n.inprogress=!1,n.cntCode=0,n.modeTouch()},this.modeTouch=function(){a.off().on(pointerEventType.down,n.touchStart)},this.modeClick=function(){a.off().on(pointerEventType.down,n.launchVideo)},this.unlockme=function(){a.addClass("unlock"),n.unlock=!0},this.lockme=function(){a.removeClass("unlock"),n.unlock=!1},this.getId=function(){return i-1},this.getCode=function(){return h},this.showLoader=function(){y=!0,C.addClass("show"),D.css({"animation-duration":decimal(getRemainingTimeBeforeBonus()/1e3,2)+"s"}),D.addClass("progress")},this.hideLoader=function(){y&&(y=!1,C.removeClass("show"),D.removeClass("progress"))},this.playAspiration=function(e=0){p.prepare(f,0),p.play(e,!0)},this.stopAspiration=function(){p.stop(!0)},this.playExpire=function(e=0){v?(d.prepare(v),d.play(e,!0),console.log("Expire sound played for bonusId:",i)):console.warn("No expire audio for bonusId:",i)},this.stopExpire=function(){d.stop(!0)},this.hasCode=function(e){return h.includes(e)},this.checkCode=function(e,o){const t=h.indexOf(e);-1!==t&&(o?n.showQuarter(t):n.hideQuarter(t))},this.showQuarter=function(e){n.cntCode++;const o=g[e],t=o.obj,i=o.col;n.cntCode===b&&n.unlock&&n.hasBeenFound(),1===n.cntCode&&(n.inprogress=!0,a.addClass("inprogress")),r.addClass("show").one(animationEnd,(e=>{$(e.target).removeClass("show")})),r.css({"border-color":i}),t.removeClass("hide").addClass("directshow show")},this.hideQuarter=function(e){const o=g[e].obj;n.unlock?o.addClass("hide").one(animationEnd,(e=>{$(e.target).removeClass("directshow show hide")})):o.removeClass("directshow show hide"),n.cntCode===b&&(cancelClickBtBonus(),n.notFoundAnymore()),n.cntCode=Math.max(0,n.cntCode-1),0===n.cntCode&&(n.inprogress=!1,a.removeClass("inprogress"))},this.hideClock=function(){S.stop(!0)},this.render=function(){S.render()},this.hasBeenFound=function(){modeReplay||(a.addClass("found bounce"),popupBonusUnlocked()),n.modeClick(),n.found=!0},this.notFoundAnymore=function(){modeReplay||a.removeClass("found bounce"),n.found=!1,n.hideClock(),n.hideLoader(),n.modeTouch()},this.touchStart=function(e){e.preventDefault(),n.unlock&&!bonusPlaying?(x=~e.type.indexOf("touch")?a:$body,x.on(pointerEventType.up,n.touchEnd),k=getTime(),showPoloAndPictoInCombo(i)):popupFindPreviousBonus()};let P={},A=!1;document.addEventListener("keydown",(function(e){P[e.key]=!0,A=!!P.Control})),document.addEventListener("keyup",(function(e){P[e.key]=!1,A=!1})),this.touchEnd=function(e){if(e.preventDefault(),x.off(pointerEventType.up,n.touchEnd),stopShowingPoloInArray(k),A&&!n.inprogress){e.preventDefault();for(let e=0;e<5;e++){let o=n.getCode()[e]-1;setTimeout((()=>{forceAddPolo(e+1,o)}),30*e)}}},this.launchVideo=function(){bonusWaiting||bonusPlaying||!(!app.bonusloopA||boucleA||modeWatch||getRemainingTime()>=500)||(n.modeTouch(),n.showLoader(),recordMix.xmlAction("bonus",n),clickBtBonus(i),a.removeClass("bounce"),r.addClass("showCircle").one(animationEnd,(e=>{$(e.target).removeClass("showCircle")})),n.prepareVideo(1))},this.prepareVideo=function(e){c.error&&c.load(),w=app.looptime*(e-1)/1e3,c.currentTime=w},this.videoPlaying=function(){},this.videoEnded=function(){},this.play=function(){let e=`onV${appVersion}Bonus${i}Start`;window[e]?.(),console.log(e,"called for bonusId:",i),a.addClass("playing"),n.hideLoader(),S.start(loopDuration*n.nbLoop,!1),u.prepare(m),u.play(w),l.addClass("show"),c.play().then((()=>{})).catch((e=>{throw new Error(e)}))},this.stop=function(){let e=`onV${appVersion}Bonus${i}End`;addToHistory("totalBonusesWatched"),window[e]?.(),console.log(e,"called for bonusId:",i),a.removeClass("playing"),loopOn&&n.found&&n.modeClick(),u.stop(!0),S.stop(!0),n.stopAspiration(),l.removeClass("show"),c.pause(),curBonus.playExpire(0)},this.pause=function(){c.pause(),S.pause()},this.resume=function(){c.play(),S.resume()},this.initBonusIcon=function(){const e=a.find(".icon .icn-bck")[0];if(!e)return;const t=new Map,n=e=>new Promise(((o,n)=>{if(t.has(e))return void o(t.get(e));const i=new Image;i.onload=()=>{t.set(e,i),o(i)},i.onerror=()=>n(new Error(`Failed to load image: ${e}`)),i.src=e})),s=()=>{const t=a.hasClass("unlock"),s=o.icon&&""!==o.icon.trim();if(t)if(s){const t=`${app.folder}video/${o.icon}`;n(t).then((()=>{e.innerHTML="",e.style.backgroundImage=`url('${t}')`,e.style.backgroundSize="cover",e.style.backgroundPosition="center",e.style.backgroundRepeat="no-repeat",console.log(`Bonus icon loaded: ${o.icon} for bonus ${i}`)})).catch((()=>{console.error(`Error loading bonus icon: ${t}`),boxDialog.open(`Error loading bonus icon [${t}]`,"&#129344;"),e.style.backgroundImage="",e.innerHTML=defaultBonusSVG}))}else e.style.backgroundImage="",e.innerHTML=defaultBonusSVG;else e.style.backgroundImage="",e.innerHTML=lockedBonusSVG};if(o.icon&&""!==o.icon.trim()){const e=`${app.folder}video/${o.icon}`;n(e).catch((()=>{console.warn(`Failed to preload bonus icon: ${e}`)}))}s();new MutationObserver(s).observe(a[0],{attributes:!0,attributeFilter:["class"]})},this.init()}function ClockObject(e){var o,t,n,i,a,s,r,l,c,u,p,d=this,m=$("#"+e)[0].getContext("2d"),f=2*Math.PI,v=Math.PI/2,h=!1,b=!1,g=0;this.start=function(e,o){l=isDarkMode()?"#CCCCCC":"#5A5A5A",m.strokeStyle=l,b=!(h=!0),p=o,u=100/e,c=getTime()},this.stop=function(e){h=!1,e?d.clear():(b=!0,o=p?0:1)},this.pause=function(){g=getTime()},this.resume=function(){var e=getTime()-g;c+=e},this.render=function(){var e,a;(h||b)&&(h?(e=getTime()-c,t=e*u/100):b&&(t+=.2*(o-t)),(t=t<.001?.001:t)>.999&&(t=.999),e=p?-v:f*t-v,a=p?f*t-v:-v,d.clear(),m.beginPath(),m.arc(n,i,s,e,a,!1),m.stroke(),!b||.001!=t&&.999!=t||(b=!1,d.clear()))},this.clear=function(){m.clearRect(n-s-r/2,i-s-r/2,2*s+r,2*s+r)},this.init=function(e,o,t,c,u,p){n=null==e?0:e,i=null==o?0:o,a=null==t?1:t,s=null==c?18:c,r=null==u?6:u,l=null==p?"#FFFFFF":p,m.lineWidth=r,m.strokeStyle=l,m.globalAlpha=a}}function ReadingBar(e,o,t){var n,i=this,a=$(e),s=$("#reading-buffer",a),r=$cntRecord.find("#t-spent"),l=$cntRecord.find("#t-duration"),c="00:00",u=!1,p=0,d="record",m=secToText(app.looptime*(app.maxrecloop||app.recmaxloop)),f=0,v=0;this.minLoop=o,this.maxLoop=t,this.maxTime=0,this.cntLoop=0,this.bonusList=[],this.onLoopsFinished=nada,this.onLooping=nada,this.isFinished=function(){return this.cntLoop==this.maxLoop},this.isLastLoop=function(){return this.cntLoop+1==this.maxLoop},this.open=function(e,o){return d=e,i.createRecordBlock(o),i.cntLoop=0,i.maxTime="record"==d?m:secToText(i.maxLoop*app.looptime),s.css({transform:"scaleX(0)"}),c="00:00",r.text(c),l.text(" / "+i.maxTime),f=0,v=100/readingBar.maxLoop,a.addClass("open"),$cntRecord.addClass("fadeIn"),callParentWindow("replayTime",{state:"open",spent:c,duration:i.maxTime}),i},this.close=function(){return i.onLoopsFinished=nada,i.onLooping=nada,removeTransition(a,"open","transform",(function(){s.removeClass("progress"),$("#reading-marker").empty(),$("#reading-marker-bonus").empty(),i.bonusList=[]})),$cntRecord.removeClass("fadeIn cssdelay"),i},this.start=function(){return u=!0,i.cntLoop=0,p=0,i.render(),f=Math.floor(p+n)/i.maxLoop,s.css({transform:"scaleX("+f/100+")","animation-duration":decimal(i.maxLoop*app.looptime/1e3,2)+"s"}),s.addClass("progress"),callParentWindow("replayTime",{state:"start",spent:c,duration:i.maxTime}),i},this.stop=function(){return u=!1,callParentWindow("replayTime",{state:"stop",spent:c,duration:i.maxTime}),i},this.froze=function(){s.addClass("froze")},this.seek=function(e){i.cntLoop=e,s.removeClass("progress"),resetAnimationCSS(s[0]),s.css({transform:"scaleX("+v*i.cntLoop/100+")"}),i.render()},this.unfroze=function(){s.css({transform:"scaleX("+v*i.cntLoop/100+")","animation-duration":decimal((i.maxLoop-i.cntLoop)*app.looptime/1e3,2)+"s"}),s.removeClass("froze").addClass("progress")},this.openBig=function(){a.addClass("seeking")},this.openNormal=function(){a.removeClass("seeking")},this.loop=function(){return i.cntLoop++,p+=n,i.isFinished()?i.onLoopsFinished&&i.onLoopsFinished():i.onLooping&&i.onLooping(),i},this.render=function(){var e;u&&(n=pctMetronome,e=secToText(getTimeSpent()+loopDuration*i.cntLoop),c!=e)&&(c=e,r.text(c),callParentWindow("replayTime",{state:"render",spent:c,duration:i.maxTime}))},this.createRecordBlock=function(e){var o="record"==d?"#D20A0A":miniPlayer?"#2C86FE":"#36B460",t="record"==d?decimal(i.minLoop/i.maxLoop,2):0;if($("#reading-block",a).css({transform:"scale("+t+", 1)"}),$($cntRecord).css({color:o}),s.css({"background-color":o}),!0===e){var n="",r=100/i.maxLoop,l=0;for(l=0;l<i.maxLoop;l++)n+="<div class='marker' style='left:"+r*l+"%'></div>";for($("#reading-marker").html(n),n="",l=0;l<i.bonusList.length;l++)n+="<div class='marker' style='left:"+r*i.bonusList[l].loopIndex+"%; width:"+r+"%'></div>";$("#reading-marker-bonus").html(n)}},this.createRecordBlock()}function RenderRAF(e){var o,t=e||nada,n=!1;function i(e){t(),o=requestAnimationFrame(i)}this.start=function(){n||(n=!0,i())},this.stop=function(){n&&(n=!1,cancelAnimationFrame(o))}}var $focused,Spinner={$bt:null,$svg:null,xlink:"",add:function(e){notnull(e)&&(this.$bt=e,this.$svg=this.$bt.find("svg use"),this.$svg.length>0&&(this.xlink=this.$svg.attr("xlink:href"),this.$svg.attr("xlink:href","#ic-loader")),this.$bt.addClass("spin"))},reset:function(){notnull(this.$bt)&&this.$bt.removeClass("spin"),notnull(this.$svg)&&this.$svg.length>0&&this.$svg.attr("xlink:href",this.xlink),this.$bt=null,this.$svg=null,this.xlink=""}};function CustomButton(e){var o=e,t=o.find("svg"),n=t.find("use"),i=n.attr("xlink:href"),a=!1,s=!1;return o.addSpinner=function(){return a||(a=!0,n.attr("xlink:href","#ic-loader"),t.addClass("spin")),o},o.removeSpinner=function(){return a&&(a=!1,n.attr("xlink:href",i),t.removeClass("spin")),o},o.addTouchAnimation=function(){return s&&o.removeClass("ontouch").get(0).offsetHeight,s=!0,o.addClass("ontouch").one(animationEnd,(function(e){o.removeClass("ontouch"),s=!1})),o},o}function CanvasObj(e){var o,t=this;return this.id=e,this.div=document.getElementById(e),this.context=this.div.getContext("2d"),this.saveImage=function(){o=t.context.getImageData(0,0,t.div.width,t.div.height)},this.showImage=function(){t.clear(),t.context.putImageData(o,0,0)},this.clear=function(){t.context.clearRect(0,0,t.div.width,t.div.height)},this}var $homeBtNews,focusList=[],focusPos=-1,focusHistory=[];function initFocusEvent(){killFocusEvent(),document.addEventListener("keydown",keyDown,!1),$(document).on(pointerEventType.down,(e=>{3!=e.isTrigger&&removeFocus(e)}))}function killFocusEvent(){document.removeEventListener("keydown",keyDown,!1),$(document).off(pointerEventType.down,removeFocus)}function keyDown(e){var o=e.key.toLowerCase();e.shiftKey&&9==e.keyCode||(9==e.keyCode&&e.preventDefault(),27==e.keyCode&&e.preventDefault(),38==e.keyCode&&e.preventDefault(),40==e.keyCode&&e.preventDefault(),$("input").is(":focus")||(13==e.keyCode&&e.preventDefault(),37==e.keyCode&&e.preventDefault(),39==e.keyCode&&e.preventDefault()),hitKey(o))}function nextFocus(){var e,o;focusPos=++focusPos>focusList.length-1?focusList.length-1:focusPos,"playlist-all"==focusHistory[focusHistory.length-1]&&(o=$scrollbox.find(".boxline .line.focused")).length&&(e=o.index())>0&&(o=o.height(),$scrollbox[0].scroll({top:e*o,left:0,behavior:"smooth"})),addFocus()}function prevFocus(){var e,o;focusPos=--focusPos<0?0:focusPos,"playlist-all"==focusHistory[focusHistory.length-1]&&(o=$scrollbox.find(".boxline .line.focused")).length&&(e=o.index())>0&&(o=o.height(),$scrollbox[0].scroll({top:e*o-2*o,left:0,behavior:"smooth"})),addFocus()}function addFocus(){notnull($focused)&&($focused.removeClass("focused"),$focused=null),focusList.length>0&&($focused=focusList[focusPos].toFocus).addClass("focused")}function removeFocus(){notnull($focused)&&($focused.removeClass("focused"),$focused=null,focusPos=-1)}function enterFocus(){var e;notnull($focused)&&(notnull(focusList[focusPos].onEnter)?focusList[focusPos].onEnter():(e=focusList[focusPos].toClick||focusList[focusPos].toFocus,null!=$._data(e,"events")?e.trigger(pointerEventType.down):e[0].dispatchEvent(new Event(pointerEventType.down))))}function deleteFocus(){if("popup-menu-exit"==focusHistory[focusHistory.length-1])return!1;notnull($focused)&&($focused.removeClass("focused"),$focused=null),focusList=[],focusPos=-1}function hitKey(e){switch(e){case"tab":$("input").is(":focus")&&blurAll(),nextFocus();break;case"enter":if(isnull($focused)&&"pop-safe-code"==focusHistory[focusHistory.length-1])return focusList[10].toFocus.trigger(pointerEventType.down),!1;$("input").hasClass("focused")&&$("input").is(":focus")&&(blurAll(),nextFocus()),enterFocus();break;case"escape":if($("input").is(":focus"))return blurAll(),!1;if(notnull($focused)&&removeFocus(),pageApp&&pause)return!1;if(boxDialog.isOpen())return!1;if(pageApp&&$lockAll.hasClass("show"))return!1;if("pop-safe-code"==focusHistory[focusHistory.length-1])return boxPopup.close(),!1;if("popup-news"==focusHistory[focusHistory.length-1])return boxPopup.close(),!1;if("popup-switch"==focusHistory[focusHistory.length-1])return boxSwitch.close(),!1;if(boxInfo.isOpen())return boxInfo.close(),!1;if(boxParam.isOpen())return boxParam.close(),!1;if(pageApp&&boxPopup.isOpen())return boxPopup.$popup.hasClass("action")||boxPopup.$popup.hasClass("action-back")?boxPopup.$icon.trigger(pointerEventType.down):boxPopup.close(),!1;if(pageApp&&$mixlist.isOpen()){if("playlist-line-open"==focusHistory[focusHistory.length-1])return $lineOpened.trigger(pointerEventType.down).trigger(pointerEventType.up),!1;if("playlist-all"==focusHistory[focusHistory.length-1])return closePlaylist(),!1}if((window.cordova||window.electron)&&null==$focused)return removeFocus(),boxMenu.isOpen()?boxMenu.close():popupMenuExit(),!1;break;case" ":!(pageApp&&onGame&&loopOn)||$lockAll.hasClass("show")||void 0!==boxMenu&&boxMenu.isOpen()||$btClock.trigger(pointerEventType.down);break;case"arrowright":case"arrowdown":$("input").is(":focus")||nextFocus();break;case"arrowleft":case"arrowup":$("input").is(":focus")||prevFocus();break;case"1":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[0].toFocus.trigger(pointerEventType.down);break;case"2":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[1].toFocus.trigger(pointerEventType.down);break;case"3":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[2].toFocus.trigger(pointerEventType.down);break;case"4":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[3].toFocus.trigger(pointerEventType.down);break;case"5":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[4].toFocus.trigger(pointerEventType.down);break;case"6":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[5].toFocus.trigger(pointerEventType.down);break;case"7":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[6].toFocus.trigger(pointerEventType.down);break;case"8":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[7].toFocus.trigger(pointerEventType.down);break;case"9":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[8].toFocus.trigger(pointerEventType.down);break;case"0":"pop-safe-code"==focusHistory[focusHistory.length-1]&&focusList[9].toFocus.trigger(pointerEventType.down);break;case"backspace":"pop-safe-code"==focusHistory[focusHistory.length-1]&&boxPopup.$popup.find(".text").text("_ _ _ _")}}function createFocus(e,o){if(boxMenu&&boxMenu.isOpen()&&"popup-menu-exit"!=e)return removeInArray("popup-menu-exit",focusHistory),focusHistory.push(e),focusHistory.push("popup-menu-exit"),!1;if(boxDialog&&boxDialog.isOpen()&&"popup-dialog"!=e)return removeInArray("popup-dialog",focusHistory),focusHistory.push(e),focusHistory.push("popup-dialog"),!1;var t,n,i;focusList=[],focusPos=-1,"popup-menu-exit"==e&&(boxMenu.$popup.find(".bt:not(.icon)").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:boxMenu.$icon})),pageApp&&"home"==e&&($homeBtNews&&$homeBtNews.length>0&&focusList.push({toFocus:$homeBtNews.find(".bck"),toClick:$homeBtNews}),focusList.push({toFocus:$homeBtInfo}),focusList.push({toFocus:$homeBtParam}),$("#home-bt-fs").is(":visible")&&focusList.push({toFocus:$("#home-bt-fs")}),focusList.push({toFocus:$homeBtSwitch}),focusList.push({toFocus:$homeBtPlay}),focusList.push({toFocus:$homeBtList})),"popup-news"==e&&(focusList.push({toFocus:boxPopup.$popup.find(".bt:not(.icon)")}),focusList.push({toFocus:boxPopup.$icon})),"pop-tuto"!=e&&"pop-credit"!=e&&"pop-follow"!=e||$("#pop-info .box-tab .tab").each((function(e){focusList.push({toFocus:$(this)})})),"pop-tuto"==e&&$("#pop-info #pop-tuto .bt").each((function(e){focusList.push({toFocus:$(this)})})),"pop-credit"==e&&$("#pop-info #pop-credit .bt").each((function(e){focusList.push({toFocus:$(this)})})),"pop-follow"==e&&($("#pop-info #pop-follow .bt").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:$("#pop-info #pop-follow #img-shop")})),"pop-language"!=e&&"pop-setting"!=e||$("#pop-param .box-tab .tab").each((function(e){focusList.push({toFocus:$(this)})})),"pop-language"==e&&$("#pop-param #pop-language .bt").each((function(e){focusList.push({toFocus:$(this)})})),"pop-setting"==e&&$("#pop-param #pop-setting .bt-onoff, #pop-param #pop-setting .bt").each((function(e){focusList.push({toFocus:$(this)})})),"pop-safe-code"==e&&(boxPopup.$popup.find(".bt:not(.icon)").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:boxPopup.$icon})),"index-select"==e&&($homeBtNews&&$homeBtNews.length>0&&focusList.push({toFocus:$homeBtNews.find(".bck"),toClick:$homeBtNews}),$("#home-bt-fs").is(":visible")&&focusList.push({toFocus:$("#home-bt-fs")}),focusList.push({toFocus:$("#home-bt-info")}),focusList.push({toFocus:$("#home-bt-param")}),$("#sp-select .vicon:not(.open)").each((function(e){focusList.push({toFocus:$(this).find(".img"),onEnter:()=>{$(this).trigger(pointerEventType.up)}})}))),"popup-switch"==e&&$("#sp-select .vicon:not(.open)").each((function(e){focusList.push({toFocus:$(this).find(".img"),onEnter:()=>{$(this).trigger(pointerEventType.up)}})})),"toolbar"==e&&(focusList.push({toFocus:$btTool}),focusList.push({toFocus:$btClock})),"toolbar-open"==e&&$("#game #box-bt1 .bt").each((function(e){focusList.push({toFocus:$(this)})})),"game-paused"==e&&("visible"==$lockPause.css("visibility")?focusList.push({toFocus:$btClock,toClick:$lockPause}):focusList.push({toFocus:$btClock})),"mode-replay"==e&&(focusList.push({toFocus:$btTool}),focusList.push({toFocus:$btClock}),focusList.push({toFocus:$btSave}),focusList.push({toFocus:$btLike})),"popup-record-complete"==e&&(boxPopup.$popup.find(".box-bt-haut .bt").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:boxPopup.$icon})),"popup-save-form"==e&&(boxPopup.$popup.find(".formzone .formline:visible input").each((function(e){var o=$(this);focusList.push({toFocus:o,onEnter:function(){var e=o.val().length;o.focus(),o[0].setSelectionRange(e,e)}})})),focusList.push({toFocus:boxPopup.$popup.find(".bt-onofftext")}),focusList.push({toFocus:boxPopup.$popup.find(".bt.valid")}),focusList.push({toFocus:boxPopup.$icon})),"popup-mix-saved"==e&&(boxPopup.$popup.find(".box-bt-haut .bt").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:boxPopup.$icon})),"popup-global-share"==e&&(boxPopup.$popup.find(".box-bt-haut .bt").each((function(e){focusList.push({toFocus:$(this)})})),focusList.push({toFocus:boxPopup.$icon})),"popup-email-form"==e&&(boxPopup.$popup.find(".formzone .formline input").each((function(e){var o=$(this);focusList.push({toFocus:o,onEnter:function(){var e=o.val().length;o.focus(),o[0].setSelectionRange(e,e)}})})),focusList.push({toFocus:boxPopup.$popup.find(".bt.valid")}),focusList.push({toFocus:boxPopup.$icon})),"popup-convert-mix"==e&&focusList.push({toFocus:boxPopup.$icon}),"popup-convert-mix-ready"==e&&(t=boxPopup.$popup.find("#bt-save-file"),focusList.push({toFocus:t,onEnter:function(){t[0].click()}}),focusList.push({toFocus:boxPopup.$icon})),"popup-dialog"==e&&$("#pop-dialog .bt").each((function(e){focusList.push({toFocus:$(this)})})),"playlist-all"==e&&($("#mixlist .tabbox .tab").each((function(e){focusList.push({toFocus:$(this)})})),(n=$("#mixlist .pagebox.show")).find(".tab-filter:visible").find(".bt").each((function(e){focusList.push({toFocus:$(this)})})),"box-search"==n.attr("id")&&(focusList.push({toFocus:n.find(".formline input"),onEnter:function(){n.find(".formline input").focus()}}),focusList.push({toFocus:n.find(".bt.search")})),$scrollbox.find(".boxline .line").each((function(e){var o=$(this);focusList.push({toFocus:o,onEnter:function(){o.trigger(pointerEventType.down).trigger(pointerEventType.up)}})}))),"playlist-line-open"==e&&$lineOpened&&$lineOpened.find(".box-action .bt").each((function(e){focusList.push({toFocus:$(this)})}));var a=[];for(i in focusList)isVisible(focusList[i])&&a.push(focusList[i]);if(focusList=a,e!=focusHistory[focusHistory.length-1]&&focusHistory.push(e),focusHistory.length>5&&focusHistory.shift(),notnull(o))for(var s=0,r=focusList.length;s<r;s++)if(focusList[s].toFocus&&focusList[s].toFocus[0]===o[0]){focusPos=s;break}}function removeInFocusHistory(e){removeInArray(e,focusHistory)}function createFocusFromHistory(){focusHistory.length&&createFocus(focusHistory[focusHistory.length-1])}function isVisible(e){return!!notnull(e)&&!!(e=notnull(e.toClick)?e.toClick:e.toFocus).length&&"hidden"!=e.css("visibility")&&"none"!=e.css("display")}function initParam(){appBrowser&&isIOS&&$("#home-bt-fs").hide(),isDarkMode()&&($("body").addClass("darkmode"),$("#pop-setting #param-dark .bt-onoff").addClass("active")),isSafeMode()&&($("body").addClass("safemode"),$("#pop-setting #param-safe .bt-onoff").addClass("active")),$("#pop-setting #param-reset .bt").on(pointerEventType.down,clickbtParamReset).parent().find(".ic-info").on(pointerEventType.down,clickbtParamResetInfo),$("#pop-setting #param-dark .bt-onoff").on(pointerEventType.down,clickbtParamDark),$("#pop-setting #param-safe .bt-onoff").on(pointerEventType.down,clickbtParamSafe).parent().find(".ic-info").on(pointerEventType.down,clickbtParamSafeInfo)}function isDarkMode(){return null!=storage.getItem("param-dark")&&"true"==storage.getItem("param-dark")}function isSafeMode(){return null!=storage.getItem("param-safe")}function clickbtParamReset(e){e.preventDefault(),storage.removeItem("popupDragViewed"),storage.removeItem("popup-bonus-next"),storage.removeItem("popup-bonus-unlock");for(var o=1;o<=versions.total;o++)storage.removeItem("v"+o+"-popup-bonus-next"),storage.removeItem("v"+o+"-popup-bonus-unlock"),storage.removeItem("v"+o+"-bonus-complete");pageApp?addTransition($("#fade-all"),"fadeIn","opacity",(function(){window.location.href=void 0!==appNumberVersion?"?v="+appNumberVersion:""})):$(e.currentTarget).addClass("disable")}function clickbtParamResetInfo(e){e.preventDefault(),boxDialog.open(STR("pop.paramResetInfoText"),"",[STR("bt.gotit")],[])}function unlockAllBonus(){for(var e=1;e<=versions.total;e++)storage.setItem("v"+e+"-popup-bonus-next","ok"),storage.setItem("v"+e+"-popup-bonus-unlock","ok"),storage.setItem("v"+e+"-bonus-complete","2");addTransition($("#fade-all"),"fadeIn","opacity",(function(){window.location.href=void 0!==appNumberVersion?"?v="+appNumberVersion:""}))}function clickbtParamDark(e){e.preventDefault(),isDarkMode()?(storage.setItem("param-dark",!1),$body.removeClass("darkmode"),$("#pop-setting #param-dark .bt-onoff").removeClass("active")):(storage.setItem("param-dark",!0),$body.addClass("darkmode"),$("#pop-setting #param-dark .bt-onoff").addClass("active"))}var paramsafecode="";function clickbtParamSafe(e){e.preventDefault(),deleteFocus(),popupCode()}function turnOnSafeMode(e){storage.setItem("param-safe",e),$body.addClass("safemode"),$("#pop-setting #param-safe .bt-onoff").addClass("active")}function turnOffSafeMode(){storage.removeItem("param-safe"),$body.removeClass("safemode"),$("#pop-setting #param-safe .bt-onoff").removeClass("active")}function popupCode(){boxPopup.open({name:"safe-code",icntype:"action",content:function(){return"<div class='title'>"+(isSafeMode()?STR("txt.codeEnter"):STR("txt.codeChoose"))+"</div>\n\t\t\t\t<div class='text'>_ _ _ _</div>\n\t\t\t\t<div class='content'>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>1</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>2</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>3</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>4</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>5</div></div><div class='hitzone'></div></div><br>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>6</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>7</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>8</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>9</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>0</div></div><div class='hitzone'></div></div><br>\n\t\t\t\t\t<br>\n\t\t\t\t\t<div class='bt bt-light' id='bt-valid-code'><div class='bck'><div class='txt'>"+STR("bt.ok")+"</div></div><div class='hitzone'></div></div>\n\t\t\t\t</div>"},onBoxOpenEnd:function(){createFocus("pop-safe-code"),isSafeMode(),paramsafecode="",boxPopup.$icon.on(pointerEventType.down,boxPopup.close),boxPopup.$popup.find(".bt-number").on(pointerEventType.down,(function(e){e.preventDefault();var o=(e=boxPopup.$popup.find(".text")).text(),t=o.indexOf("_");t>-1&&e.text(o.replaceAt(t,$(this).text())),!isSafeMode()||"15092009"!=(paramsafecode+=$(this).text())&&e.text().replace(/ /g,"")!=storage.getItem("param-safe")||(turnOffSafeMode(),boxPopup.close()),$(this).hasClass("ontouch")&&$(this).removeClass("ontouch").get(0).offsetHeight,$(this).addClass("ontouch").one(animationEnd,(function(e){$(e.target).removeClass("ontouch")}))})),boxPopup.$popup.find("#bt-valid-code").on(pointerEventType.down,(function(e){var o=boxPopup.$popup.find(".text").text().replace(/ /g,"");-1==o.indexOf("_")?isSafeMode()?o==storage.getItem("param-safe")?(turnOffSafeMode(),boxPopup.close()):boxPopup.$popup.find(".text").addClass("shake").one(animationEnd,(function(e){paramsafecode="",$(e.target).text("_ _ _ _").removeClass("shake")})):(turnOnSafeMode(o.replace(/ /g,"")),boxPopup.close()):boxPopup.$popup.find(".text").addClass("shake").one(animationEnd,(function(e){$(e.target).removeClass("shake")}))}))},onBoxCloseStart:function(){removeInFocusHistory("pop-safe-code"),deleteFocus(),boxPopup.$icon.off(),boxPopup.$popup.find(".bt").off()},onCloseComplete:function(){createFocusFromHistory()}})}function clickbtParamSafeInfo(e){e.preventDefault(),boxDialog.open(STR("pop.paramSafeInfoText"),"",[STR("bt.gotit")],[])}function clickbtParamRecover(e){}function clickbtParamRecoverInfo(e){}var hasNews=!1;function initNews(){!isSafeMode()&&hasNetwork&&checkNews()}function activeBtNews(){hasNews&&($homeBtNews=$("#home-bt-news")).on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(popupNews)})).addClass("animate")}function checkNews(){var e=getAppData(),o={id:(o=JSON.parse(localStorage.getItem("news"))||{id:"",lang:""}).id,lang:o.lang};e.news=o,$.ajax({type:"POST",url:domainOnline+"ph3/check-news.php",data:e,dataType:"json",crossdomain:!0,success:function(e){null!=e.nada&&localStorage.removeItem("news"),null!=e.deja&&(hasNews=!0),null!=e.news&&(localStorage.setItem("news",JSON.stringify(e.news)),hasNews=!0)},error:function(e){}})}var newsImageLoaded=!1;function popupNews(){var e,o,t;null!=localStorage.getItem("news")&&(e=JSON.parse(localStorage.getItem("news")),t=(o=null!=e.bt)?'<div class="bt bt-light"><div class="bck"><div class="txt">'+e.bt+'</div></div><div class="hitzone"></div></div>':"",boxPopup.open({name:"popup-news",icntype:"action",bodyclose:!0,class:"big column",content:"\n            <div class='left'>\n               <div class='img-box'></div>\n               <div class='icn-box' class='spin'><svg class='icn-svg icn-gray'><use xlink:href='#ic-loader'></use></svg></div>\n            </div>\n            <div class='right'>\n               <div class='title'>"+e.title+"</div>\n               <div class='text'>"+e.text+"</div>\n               "+t+"\n            </div>",onBoxOpenEnd:function(){function t(){boxPopup.$popup.find(".icn-box").remove(),boxPopup.$popup.find(".img-box").css({"background-image":"url("+e.img+")"}).addClass("fade")}var n;createFocus("popup-news"),newsImageLoaded?t():((n=new Image).src=e.img,n.onload=function(){newsImageLoaded=!0,t()}),boxPopup.$icon.on(pointerEventType.down,boxPopup.close),o&&boxPopup.$container.find(".bt").on(pointerEventType.down,(function(o){o.preventDefault(),openURL(e.link)}))},onBoxCloseStart:function(){boxPopup.$icon.off(),o&&boxPopup.$container.find(".bt").off()},onCloseComplete:function(){removeInFocusHistory("popup-news"),createFocusFromHistory()}}))}var storage,cloud,$body,$incredibox,$bckGlobal,$lockAll,$lockPause,$fadeAll,$watchInfo,$mixlist,$poplist,$tabLatest,$tabTop50,$tabSearch,$tabMixlist,$home,$homeVersion,$homeTitre,$homeLoadbox,$homeLoadbar,$homeBtPlay,$homeBtList,$homeBtSwitch,$homeBtInfo,$homeBtParam,$homeBtFs,$homeBck,$boxStage,$boxVideo,$fadeVideo,$boxTop,$boxBtBonus,$boxBottom,$boxPicto,$boxLoaderPolo,$btTool,$boxBt,$btBack,$btHome,$btSave,$btLike,$btHelp,$btSwitch,$btStop,$btRecord,$btRandom,$btClock,$cntRecord,boxDialog,boxMenu,boxPopup,boxInfo,boxParam,boxSwitch,isFullScreenable=window.electron&&window.electron.vars.isFullScreenable,isMinimizable=window.electron&&window.electron.vars.isMinimizable;function popupMenuExit(){boxMenu.open({name:"menu-exit",icntype:"action",content:function(){var e=isFullScreen()?STR("bt.fullscreenOff"):STR("bt.fullscreenOn"),o="\n\t\t\t\t<div class='title'>Menu</div>\n\t\t\t\t<div class='content'>";return isFullScreenable&&(o+='<div class="bt bt-light" id="bt-exit-fullscreen"><div class="bck"><div class="txt">'+e+'</div></div><div class="hitzone"></div></div>'),isMinimizable&&(o+='<div class="bt bt-light" id="bt-minimize"><div class="bck"><div class="txt">'+STR("bt.minimizeWindow")+'</div></div><div class="hitzone"></div></div>'),o=(o+='<div class="bt bt-light" id="bt-open-settings"><div class="bck"><div class="txt">'+STR("bt.param")+'</div></div><div class="hitzone"></div></div>')+'<div class="bt bt-light" id="bt-open-help"><div class="bck"><div class="txt">'+STR("bt.tuto")+'</div></div><div class="hitzone"></div></div>',(window.cordova||window.electron)&&(o+='<div class="bt bt-light" id="bt-exit-app"><div class="bck"><div class="txt">'+STR("bt.quitApp")+'</div></div><div class="hitzone"></div></div>'),o+"</div>"},onBoxOpenStart:function(){createFocus("popup-menu-exit")},onBoxOpenEnd:function(){isFullScreenable&&boxMenu.$popup.find("#bt-exit-fullscreen").on(pointerEventType.down,switchFullscreen),isMinimizable&&boxMenu.$popup.find("#bt-minimize").on(pointerEventType.down,minimizeWindow),(window.cordova||window.electron)&&boxMenu.$popup.find("#bt-exit-app").on(pointerEventType.down,exitApp),boxMenu.$popup.find("#bt-open-help").on(pointerEventType.down,openHelp),boxMenu.$popup.find("#bt-open-settings").on(pointerEventType.down,openSettings),boxMenu.$icon.on(pointerEventType.down,boxMenu.close)},onBoxCloseStart:function(){boxMenu.$icon.off(),boxMenu.$popup.find(".bt").off()},onCloseComplete:function(){removeInFocusHistory("popup-menu-exit"),createFocusFromHistory()}})}function isFullScreen(){return!(!window.electron||!window.electron.ipc.isFullScreen)&&window.electron.ipc.isFullScreen()}function switchFullscreen(e){e&&e.preventDefault(),window.electron&&(isFullScreen()?(console.log("Leaving fullscreen..."),window.electron.ipc.leaveFullScreen()):(console.log("Entering fullscreen..."),window.electron.ipc.enterFullScreen())),void 0!==boxMenu&&boxMenu.close&&boxMenu.close()}function minimizeWindow(e){e&&e.preventDefault(),console.log("Minimize button clicked"),window.electron&&window.electron.ipc.minimize?(console.log("Calling electron minimize..."),window.electron.ipc.minimize()):console.error("Electron minimize function not available!"),void 0!==boxMenu&&boxMenu.close&&boxMenu.close()}function exitApp(e){notnull(e)&&e.preventDefault(),window.electron?electron.ipc.close():window.cordova&&boxDialog.open(STR("txt.quitAppConfirm"),"",[STR("bt.yes"),STR("bt.no")],[()=>{navigator.app.exitApp()}]),boxMenu.close()}function openSettings(){boxMenu.close(),boxInfo.isOpen()&&boxInfo.close(),popupParam()}function openHelp(){boxMenu.close(),boxParam.isOpen()&&boxParam.close(),popupInfo()}var pageApp=!1;function pageLoadComplete(){cloud=new CloudSync,storage=new LocalStorage,localMixObject=new LocalMixObject,checkSystem(),initAnalytics(),initLanguage(),resizeApp(),localMixObject.saveMixOffline(),$(document).ready((function(){isIframe&&appBrowser?callParentWindow("appIsReady"):documentReady()}))}function documentReady(){if($body=$("body"),boxMenu=new Popup(".box-popup#pop-menu-exit"),boxDialog=new BoxDialog("#pop-dialog"),boxPopup=new Popup(".box-popup#pop-popup"),"ok"!=checkSupported())return removeFadeAll(),popupGeneralError({error:checkSupported(),action:"kill"}),!1;loadLanguage({cbck:function(){pageCanRun()},fail:function(){removeFadeAll(),popupGeneralError({error:"no language found",action:"reload"})}});let e=`onV${appVersion}Start`;"function"!=typeof window[e]&&(e="onAppStart"),addToHistory("totalVersionsOppened"),window[e]?.(),console.log(`v${appVersion} started with function ${e}()`)}function pageCanRun(){pageApp&&initVersions(),initJqueryVar(),initRulesCSS(),initFocusEvent(),initParam(),initPopup(),initNews(),changeDomTxt(),(pageApp?pageAppReady:pageIndexReady)()}function switchVersion(e){var o=$(this).attr("id").split("icon").join(""),t="app."+pageExt+"?v="+o;t=(t+=null!=getParameterByName("lang")?"&l="+getParameterByName("lang"):"")+(null!=getParameterByName("afs")?"&afs="+getParameterByName("afs"):"");featureLocked&&parseInt(o)>4?dialogGetApp():o!=appVersion&&(lock(),focusHistory=[],deleteFocus(),pageApp&&$(".box-popup#pop-switch #icon"+appVersion).addClass("close"),$(this).addClass("open clicked").one(animationEnd,(function(){addTransition($fadeAll,"fadeIn","opacity",(function(){gotoAppUrl(t)}))})))}function initJqueryVar(){$body=$("body"),$fadeAll=$("#fade-all"),$lockAll=$("#lock-all").on(pointerEventType.down,stopProp),$bckGlobal=$("#bck-global"),$homeBtInfo=$("#home-bt-info"),$homeBtParam=$("#home-bt-param"),$homeBtFs=$("#home-bt-fs"),pageApp&&($incredibox=$("#app-incredibox"),$lockPause=$("#lock-pause").on(pointerEventType.down,(function(e){e.preventDefault(),e.pageY-$incredibox[0].getBoundingClientRect().y<.7*$incredibox[0].getBoundingClientRect().height&&preventAction(clickBtClock)})),($mixlist=$("#mixlist")).isOpen=function(){return $mixlist.hasClass("show")},$tabLatest=$("#tab-latest"),$tabTop50=$("#tab-top50"),$tabSearch=$("#tab-search"),$tabMixlist=$("#tab-mixlist"),$home=$("#home"),$homeBck=$("#home #img-bck"),$homeVersion=$("#home #img-version"),$homeTitre=$("#home #img-titre"),$homeLoadbox=$("#home #load-box"),$homeLoadbar=$("#home #load-box #load-bar"),$homeBtPlay=new CustomButton($("#home #home-bt-play")),$homeBtList=new CustomButton($("#home #home-bt-list")),$homeBtSwitch=$("#home #home-bt-switch"),$boxBt=$("#box-bt"),$btBack=$("#bt-back"),($btTool=$("#bt-tool")).$bck=$("#bt-tool .bck"),$btTool.$svg=$btTool.$bck.find("svg use"),$btTool.bounce=function(){this.addClass("animateBounce").one(animationEnd,(function(e){$(e.target).removeClass("animateBounce")}))},$btStop=$("#bt-stop"),$btRandom=$("#bt-random"),$btRecord=$("#bt-record"),$btHome=$("#bt-home"),$btHelp=$("#bt-help"),$btSwitch=$("#bt-switch"),$btClock=$("#bt-clock"),$cntRecord=$("#cnt-record"),$btSave=$("#bt-save"),$btLike=$("#bt-like"),$boxStage=$("#box-stage"),$boxVideo=$("#box-video"),$fadeVideo=$("#fade-video"),$boxTop=$("#box-top"),$boxBtBonus=$("#box-bt-bonus"),$boxBottom=$("#box-bottom"),$boxPicto=$("#box-picto"),$boxLoaderPolo=$("#box-loader-polo"),($watchInfo=$("#watch-info")).$title=$("#watch-info .title"),$watchInfo.$name=$("#watch-info .name"),$watchInfo.$dedi=$("#watch-info .dedi"),$watchInfo.$date=$("#watch-info .date"),boxSwitch=new Popup(".box-popup#pop-switch"),$(".box-popup#pop-switch #icon"+appVersion).addClass("open"),$(".box-popup#pop-switch .vicon").on(pointerEventType.up,switchVersion))}function removeFadeAll(){($fadeAll=isnull($fadeAll)?$("#fade-all"):$fadeAll).hasClass("fadeIn")&&$fadeAll.removeClass("fadeIn")}function clickAndroidBackButton(){pageApp?onGame&&loopOn&&!pause?stopAllStage():gotoAppUrl("index.html?back=1"):exitApp()}function pageIndexReady(){if(cloud.sync(storage.restoreMixFromDB),removeTransition($("#fade-all"),"fadeIn","opacity",(function(){window.cordova&&$("#fade-all").removeClass("white")})),getParameterByName("skipintro"))return introComplete(),!1;afterPP()}function afterPP(){checkRatingModul((function(){setTimeout(launchIntro,2e3)}))}function launchIntro(){$("#page-splash #sp-title").addClass("titleTweenUp"),$("#page-splash #sp-baseline").addClass("baselineTweenUp"),$("#page-splash #sp-experience").html(STR("txt.useHeadphones")).addClass("experienceTweenUp"),$("#page-splash #sp-headphone").addClass("headphoneTweenUp"),setTimeout((function(){$("#page-splash #sp-title").addClass("titleTweenUpHide"),$("#page-splash #sp-experience").addClass("experienceTweenUpHide"),$("#page-splash #sp-choose").html(STR("txt.selectVersion")).addClass("chooseTweenUp"),$("#page-splash #sp-headphone").addClass("headphoneTweenUpHide").one(animationEnd,introComplete)}),2500)}function introComplete(){$homeBtInfo.on(pointerEventType.down,popupInfo).addClass("animate"),$homeBtParam.on(pointerEventType.down,popupParam).addClass("animate"),$homeBtFs.on(pointerEventType.down,(function(){callParentWindow("openFullscreen")})).addClass("animate"),activeBtNews(),$("#page-splash").addClass("enabled"),$("#page-splash #sp-select .vicon").addClass("iconTweenUp").on(pointerEventType.up,switchVersion),createFocus("index-select"),activeModButtons()}document.addEventListener(window.cordova?"deviceready":"DOMContentLoaded",pageLoadComplete,!1);var app,clock,mainCanvas,contextCanvas,localMixObject,rateShown=!1;function checkRatingModul(e){var o,t,n={IyZcm:"false:0",TjfgQ:function(e,o){return e(o)},XrFYO:"QUFpk",XPBdo:"steam"},i=0,a="ratemsg";function s(o){1==o?storage.setItem(a,n.IyZcm):2==o?storage.removeItem(a):(storage.removeItem(a),n.TjfgQ(openURL,isIOS||window.electron&&isOSX?build.storeRateURL:build.storeURL)),e()}(window.cordova||window.electron)&&hasNetwork&&!isSafeMode()&&n.XPBdo!=build.store&&(isnull(storage.getItem(a))&&storage.setItem(a,"true:0"),n.TjfgQ(isnull,o=storage.getItem(a))||(o=String(o).split(":"),t=Boolean("true"==o[0]),i=Number(o[1]),t&&(++i>=5?(rateShown=!0,boxDialog.open(STR("pop.rateText"),STR("pop.rateTitle"),[STR("bt.nope"),STR("bt.later"),STR("bt.sure")],[function(){s(1)},function(){if("lDtel"===n.XrFYO)return n;s(2)},function(){s(3)}])):storage.setItem(a,"true:"+String(i)))),rateShown)||e()}function reinitRatingModul(){storage.setItem("ratemsg","true:0")}function showPopupPP(e){e()}var loopDuration,nbPoloMax,mixlink=getParameterByName("mix"),miniPlayer=null!=mixlink||"1"==getParameterByName("replay"),appNumberVersion=miniPlayer&&mixlink?mixlink.slice(-1):getParameterByName("v"),appVersion=pageApp&&(isnull(appNumberVersion)||isNaN(appNumberVersion)||1!=appNumberVersion.length)?4:appNumberVersion,appLoaded=(appVersion=pageApp&&miniPlayer&&mixlink&&-1==mixlink.indexOf("-")&&13==mixlink.length?2:appVersion,!1),appViewed=!1,modeWatch=!1,isBackToHome=!1,delayassist=500,onGame=!1,loopOn=!1,pause=!1;function pageAppReady(){if(initRightClick(),initSilentMode(),listenFocus(),initAd(),contextCanvas=$("#cnv-stage")[0].getContext("2d"),initAudioContext(),initAudioRoute(),bugBluetoothLatency())return!1;$home.addClass("animate"),$home[0].onanimationend=()=>{$home.removeClass("animate")},removeTransition($fadeAll,"fadeIn","opacity",(function(){(miniPlayer?displayHomeReplay:(initMixlist(),showHome))()}))}var listPolo,listPicto,readingBar,randomMix,recordMix,replayMix,mixToWatchLoaded=!1,displayHomeReplayWaiting=!1;function tryToLoadMix(){xhr("GET",domainOnline+"ph3/get-mix-db.php",{id:mixlink},(function(e){mixToWatchLoaded=!(mixToWatch=null),"success"==e.state?mixToWatch=e.mixlist[0]:popupGeneralError({error:"load mix",action:"kill"}),displayHomeReplayWaiting&&displayHomeReplay()}),(function(e){popupGeneralError({error:"mix not found",action:"kill"}),mixToWatchLoaded=!0}))}function prepareMixReplay(e){mixToWatchLoaded=!0,mixToWatch=e}function displayHomeReplay(){mixToWatchLoaded?(mixToWatch.dedi&&""!=mixToWatch.dedi&&($("#home #home-dedicated").html(STR("txt.dedicatedTo").replace("%{name}",mixToWatch.dedi)),$("#home #home-dedicated").addClass("animate")),$fadeAll.removeClass("fadeIn"),isnull(mixToWatch)||(parseXmlAndCheckAssets(),showHomeLoadbar())):(displayHomeReplayWaiting=!0,isIframe||tryToLoadMix())}function activeModButtons(){fetch("js/_buttons").then((e=>e.text())).then((e=>{e.split("\n").forEach((e=>{const o=document.getElementById(e.trim());o?(o.classList.add("animate"),console.info(`[_buttons] ${e} loaded`)):console.warn(`[_buttons] ${e} skipped`)}))})).catch((e=>{boxDialog.open(`Error loading mod buttons: ${e}`,"&#129402;")}))}function showHome(){unlock(),unlockScreenEdges(),$fadeAll.removeClass("fadeIn"),$homeTitre.addClass("animate"),$homeVersion.addClass("animate"),(appViewed=!(!miniPlayer||!appBrowserSchool)||appViewed)||(appViewed=!0,(appLoaded?showBtHome:showHomeLoadbar)(),$homeBtSwitch.on(pointerEventType.down,(function(e){preventAction(popupSwitch)})).addClass("animate"),$homeBtInfo.on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(popupInfo)})).addClass("animate"),$homeBtParam.on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(popupParam)})).addClass("animate"),$homeBtFs.on(pointerEventType.down,(function(e){e.preventDefault(),callParentWindow("openFullscreen")})).addClass("animate"),activeBtNews(),activeModButtons())}function showHomeLoadbar(){$homeLoadbox.addClass("animate"),preparerArray()}function hideHomeLoadbar(){$homeLoadbox.removeClass("animate"),miniPlayer?appBrowserSchool?callParentWindow("replayIsReady",{func:function(){loopOn?clickBtClock():forceUserGesture((function(){clickBtWatch(mixToWatch)}))}}):showBtPlayListen():showBtHome(!0)}function showBtPlayListen(){$homeBtPlay.on(pointerEventType.down,(function(){$homeBtPlay.addSpinner(),forceUserGesture((function(){clickBtWatch(mixToWatch),callParentWindow("replayStart",mixToWatch)}))})),$homeBtPlay.addClass("animate");var e=0;$body.on(pointerEventType.down,(function(o){e=window.top.scrollY})),$body.on(pointerEventType.up,(function(o){window.top.scrollY==e&&loopOn&&clickBtClock()})),$lockPause.off()}function showBtHome(e){e&&createFocus("home"),$homeBtPlay.addClass("animate"),$homeBtList.addClass("animate"),$homeBtPlay.on(pointerEventType.down,(function(){lock(),$homeBtPlay.addSpinner(),forceUserGesture(clickHomeBtPlay)})),$homeBtList.on(pointerEventType.down,(function(){appBrowser?dialogGetApp():(lock(),$homeBtList.addSpinner(),forceUserGesture(clickHomeBtPlaylist))})),debugGame&&clickHomeBtPlay()}function clickHomeBtPlaylist(){deleteFocus(),lock(),TweenMax.delayedCall(.5,(function(){unlock(),openPlaylist()}))}function clickHomeBtPlay(){appBrowserSchool&&!miniPlayer&&callParentWindow("clickBtPlay"),deleteFocus(),addTransition($fadeAll,"fadeIn","opacity",(function(){callAd("start","new-game",hideHome)}))}function hideHome(){lock(),lockScreenEdges(),detectSilentMode(),onGame=!(isBackToHome=!1),$home.hide(),$incredibox.addClass("show"),document.body.classList.remove("darkback"),$homeBtPlay.removeSpinner(),renderRAF.start(),modeWatch?(prepareReplayMode(),afficherAllPolo(!0)):(showDiv($boxBtBonus),showDiv($boxPicto),showDiv($boxLoaderPolo),baisserAllPolo()),removeTransition($fadeAll,"fadeIn","opacity",lancerApp)}function backToHome(e){deleteFocus(),lock(),isBackToHome=!0,pictoForceOnDrop(),addTransition($fadeAll,"fadeIn","opacity",(function(){hideGame(),e&&e()}))}function hideGame(){document.body.classList.add("darkback"),onGame=!1,stopAllStage(),renderRAF.stop(),closeTool(),checkIfPopupOpen(),$home.show(),$incredibox.removeClass("show"),removeTransition($fadeAll,"fadeIn","opacity",showHome),modeWatch?(reinitModeWatch(),createFocusFromHistory()):(focusHistory=[],createFocus("home"))}function lancerApp(){$fadeAll.removeClass("fadeIn"),modeWatch?startReplayMode():(unlock(),afficherAllPolo(),createFocus("toolbar"),isnull(storage.getItem("popupDragViewed"))&&setTimeout(popupDrag,600)),saveGA("game","launch")}var listBonus=[],listPoloDrop=[],listPoloToRemove=[],listPoloToSolo=[],poloAllVisible=!1,modeRandom=!1,modeRecord=!1,modeReplay=!1,waitForRecording=!1,mouseX=0,mouseY=0;function createGame(){appLoaded=!0,loopDuration=app.looptime,nbPoloMax=app.nbpolo,stepAnimation=frameHalf/loopDuration,stepPercent=100/loopDuration,tabBuffer.metro[0].snd=audioCtx.createBuffer(2,globalSampleRate*(app.looptime/1e3),globalSampleRate),(sndMetronome=new SoundObject("metronome")).setSilence(),(clock=new ClockObject("cnv-clock")).init(76,76,1,68,16),renderRAF=new RenderRAF(renderLoop),mainCanvas=new CanvasObj("cnv-stage"),miniPlayer?((recordMix=function(){}).xmlAction=function(){},randomMix=function(){}):(randomMix=new RandomMix,recordMix=new RecordMix),replayMix=new ReplayMix,readingBar=new ReadingBar("#reading-bar",app.recminloop,app.recmaxloop),listPolo=window.polos=createBoxPolo(),majListPoloDrop(),listPicto=createBoxPicto(),createBtBonus(),listBonus=createBoxBonus(),document.getElementById("box-stage-bck").style.backgroundImage="url("+listImages.gameBck.src+")",miniPlayer||document.querySelectorAll(".picto .bck").forEach((e=>{e.style.backgroundImage="url("+listImages.gamePicto.src+")"})),enableBtGame(),resizeApp()}function createBoxPicto(){const e="number"!=typeof app.pictoRowMax||isNaN(app.pictoRowMax)?10:app.pictoRowMax;let o=[],t="",n="";for(let o=0;o<nbSound;o++){const i=`<div class="picto" id="picto${o}" data-picto-num="${o}">\n                 <div class="bck"></div>\n                 <div class="hitzone"></div>\n               </div>`;o<e?t+=i:n+=i}$boxPicto.find(".pictoline.top").html(t),$boxPicto.find(".pictoline.bot").html(n);for(let e=0;e<nbSound;e++)o.push(new PictoObject(e,$boxPicto));return o}function createBoxPolo(){var e=[],o="",t="",n=0;for(n=0;n<nbPoloMax;n++)o+='\n\t\t\t<div class="polo" data-polo-id="'+n+'">\n\t\t\t\t<div class="ctrl">\n\t\t\t\t\t<div class="cbt icon-game-bt-mute"><svg class="icn-svg"><use xlink:href="#ic-mute"></use></svg></div>\n\t\t\t\t\t<div class="cbt icon-game-bt-solo"><svg class="icn-svg"><use xlink:href="#ic-solo"></use></svg></div>\n\t\t\t\t\t<div class="cbt icon-game-bt-delete"><svg class="icn-svg"><use xlink:href="#ic-close"></use></svg></div>\n\t\t\t\t</div>\n\t\t\t</div>',t+='\n\t\t\t<div class="zone" data-polo-id="'+n+'">\n\t\t\t\t<div class="loader">\n\t\t\t\t\t<div class="bar"></div>\n\t\t\t\t</div>\n\t\t\t</div>';for(document.querySelector("#box-polo").innerHTML=o,document.querySelector("#box-loader-polo").innerHTML=t,n=0;n<nbPoloMax;n++)e.push(new PoloObject(n,contextCanvas));return e}function createBoxBonus(){for(var e=[],o=0;o<nbBonus;o++){for(var t=app.bonusarray[o],n=t.code.split(","),i=$("#bt-bonus-"+(o+1)),a=0,s=n.length;a<s;a++){var r=app.animearray[n[a]-1].color;$(".svg.q"+(a+1)+" svg",i).css({fill:"#"+r})}tabBuffer.bonus[o].aspire||(tabBuffer.bonus[o].aspire=audioCtx.createBuffer(2,globalSampleRate*(app.looptime/1e3),globalSampleRate)),t=new BonusObject(o,t,tabBuffer.bonus[o]),e.push(t)}return e}function createBtBonus(){for(var e="",o=1;o<=nbBonus;o++)e+='\n\t\t\t<div class="bt-bonus" id="bt-bonus-'+o+'">\n\t\t\t\t<div class="circle"></div>\n\t\t\t\t<div class="quarter">\n\t\t\t\t\t<div class="svg q0"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M83.88,29.72A42.83,42.83,0,1,0,86,43,43,43,0,0,0,83.88,29.72ZM43,58.64A15.69,15.69,0,0,1,27.36,43,15.64,15.64,0,1,1,52.18,55.64,15.52,15.52,0,0,1,43,58.64Z"/></svg></div>\n\t\t\t\t\t<div class="svg q1"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M57.87,38.17l26-8.45A43,43,0,0,0,43,0V27.36A15.65,15.65,0,0,1,57.87,38.17Z"/></svg></div>\n\t\t\t\t\t<div class="svg q2"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M83.88,29.72l-26,8.45a15.58,15.58,0,0,1-5.69,17.47L68.25,77.75a42.83,42.83,0,0,0,15.63-48Z"/></svg></div>\n\t\t\t\t\t<div class="svg q3"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M52.18,55.64a15.55,15.55,0,0,1-18.36,0L17.75,77.75a42.77,42.77,0,0,0,50.5,0Z"/></svg></div>\n\t\t\t\t\t<div class="svg q4"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M27.36,43a15.71,15.71,0,0,1,.77-4.83l-26-8.45a42.88,42.88,0,0,0,15.64,48L33.82,55.64A15.61,15.61,0,0,1,27.36,43Z"/></svg></div>\n\t\t\t\t\t<div class="svg q5"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M43,27.36V0A43,43,0,0,0,2.11,29.72l26,8.45A15.65,15.65,0,0,1,43,27.36Z"/></svg></div>\n\t\t\t\t</div>\n\t\t\t\t<canvas id="canvas-bt-bonus-'+o+'" width="86" height="86"></canvas>\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<div class="icn-bck"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="hitzone"></div>\n\t\t\t\t<div class="box-loader">\n\t\t\t\t\t<div class="zone"><div class="loader"><div class="bar"></div></div></div>\n\t\t\t\t</div>\n\t\t\t</div>';$boxBtBonus.append(e)}var isToolbarOpen=!1,isToolbarMove=!1;function enableBtGame(){$btBack.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickTool)})),$btStop.on(pointerEventType.down,(function(e){e.preventDefault(),!isToolbarMove&&loopOn&&preventAction(clickBtStop)})),$btRandom.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickBtRandom)})),$btRecord.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickBtRecord)})),$btHome.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickBtHome)})),$btHelp.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickBtHelp)})),$btSwitch.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickBtSwitch)})),enableBtTool(),enablePictoDraggable()}function enableBtTool(){$btTool.on(pointerEventType.down,(function(e){e.preventDefault(),isToolbarMove||preventAction(clickTool)}))}function clickTool(){isToolbarMove=!0,(isToolbarOpen?closeTool:openTool)()}function openTool(){deleteFocus(),document.body.addEventListener(pointerEventType.down,clickStage),addTransition($boxBt,"open","transform",endToolMove,!0),isToolbarOpen=!0}function closeTool(){deleteFocus(),document.body.removeEventListener(pointerEventType.down,clickStage),removeTransition($boxBt,"open","transform",endToolMove),isToolbarOpen=!1}function endToolMove(){isToolbarMove=!1,onGame&&createFocus(isToolbarOpen?"toolbar-open":"toolbar")}function clickStage(e){$boxBt[0].contains(e.target)||clickTool()}function clickBtStop(){stopAllStage()}function clickBtHome(){backToHome()}function clickBtRandom(){startRandomMode()}function clickBtRecord(){startRecordMode()}function clickBtHelp(){backToHome(popupInfo)}function clickBtSwitch(){backToHome(popupSwitch)}function baisserAllPolo(){if(poloAllVisible){poloAllVisible=!1;for(var e=0;e<nbPoloMax;e++)listPolo[e].baisser()}}function afficherAllPolo(e){if(!poloAllVisible){poloAllVisible=!0;for(var o=0;o<nbPoloMax;o++)listPolo[o].remonte(.03*o,!1,e)}}function habillerPolo(e,o,t,n){t=isnull(t)?0:t;var i=o.id;i=tabAnime[i];e.habiller(o,cntBoucle,i,t,n),loopOn?(e.showLoader(),e.activerClick()):waitingFirstLoop||(waitingFirstLoop=!0,checkAudioCanRun().then((()=>{setTimeout((()=>{startFirstLoop()}),app.firstLoopDelay||0)})).catch((e=>{rebuildAudioContext().then((()=>{startFirstLoop()})).catch((()=>{stopAllStage(),popupGeneralError({error:"Audio",action:"reload"})}))})))}function startFirstLoop(){let e=`onV${appVersion}Mix`;window[e]?.(),console.info(`First loop started with ${e}()`),waitingFirstLoop=!1,globalVolumeFadeIn(),enableClickFirstPolos(),startLoop(),waitForRecording&&startRecording(),enableBtClock()}function enableClickFirstPolos(){for(var e=0;e<nbPoloMax;e++){var o=listPolo[e];o.getBusy()&&o.activerClick()}}function clickPolo(e){bonusPlaying||modeRandom||(e.desactiverClick(),getRemainingTime()<delayassist?listPoloToRemove.push(e):removePolo(e),0!==(e=getListPoloBusy().length)&&e!=listPoloToRemove.length)||stopLoop()}function mutePolo(e){e.mute()}function unmutePolo(e){e.unmute()}function soloPolo(){for(var e=getListPoloBusy(),o=e.length,t=0;t<o;t++){var n=e[t];n.getSolo()?n.unmute():n.mute()}}function muteAll(e){for(var o=getListPoloBusy(),t=o.length,n=0;n<t;n++){var i=o[n];i.id!=e.id?(i.setSolo(!1),i.mute()):(i.setSolo(!0),i.unmute())}}function unmuteAll(){for(var e=getListPoloBusy(),o=e.length,t=0;t<o;t++){var n=e[t];n.setSolo(!1),listPoloToSolo.push(n)}getRemainingTime()>delayassist&&checkPoloToSolo()}function checkPoloToSolo(){for(var e=0,o=listPoloToSolo.length;e<o;e++)listPoloToSolo[e].unmute();listPoloToSolo=[]}function getTotalSolo(){for(var e=getListPoloBusy(),o=e.length,t=0,n=0;n<o;n++)e[n].getSolo()&&t++;return t}function stopSoloPolo(){for(var e=getListPoloBusy(),o=e.length,t=0;t<o;t++){var n=e[t];listPoloToSolo.push(n)}getRemainingTime()>delayassist&&checkPoloToSolo()}function stopOtherSolo(){for(var e=getListPoloBusy(),o=e.length,t=0;t<o;t++)e[t].setSolo(!1)}function removePolo(e,o,t){checkerCodeBonus(e.getPicto(),!1),1==getTotalSolo()&&e.getSolo()&&(e.setSolo(!1),stopSoloPolo()),e.deshabiller(o,bonusPlaying),e.desactiverClick(),e.stopSound(t),1==(o=getListPoloBusy()).length&&(e=o[0]).getSolo()&&isMouseDevice&&!isTouchDevice&&e.setSolo(!1)}function checkPoloToRemove(e){for(var o=listPoloToRemove.length,t=bonusPlaying?.01:.03,n=0,i=o-1;n<o;n++,i--)removePolo(listPoloToRemove[n],i*t,e);listPoloToRemove=[]}function poloStartWatchPicto(){for(var e=0,o=listPoloDrop.length;e<o;e++)"hover"!=listPoloDrop[e].state&&listPoloDrop[e].mode("regarde")}function poloStopWatchPicto(){for(var e=0,o=listPoloDrop.length;e<o;e++)listPoloDrop[e].mode("normal")}function checkPictoHoverPolo(e){for(var o=0,t=listPoloDrop.length;o<t;o++){var n=listPoloDrop[o];n.hitTestPicto(e)?(n.rollover(),n.pictoHoverId=e.id):n.pictoHoverId==e.id&&(n.rollout(),n.pictoHoverId=null)}}function pictoOnDrop(e,o){var t,n=0,i=(o=!!notnull(o)&&o,listPoloDrop.length),a=!1;if(!o&&!isBackToHome)for(n=0;n<i;n++)a||(t=listPoloDrop[n]).hitTestPicto(e)&&(a=!0,pictoTouchePolo(t,e));a?(majListPoloDrop(),listPoloDrop.length):e.replacer()}function pictoTouchePolo(e,o,t,n){o.absorber(e),checkerCodeBonus(o,!0),habillerPolo(e,o,t,n),getTotalSolo()>0&&e.mute()}function majListPoloDrop(){listPoloDrop=[];for(var e=0;e<nbPoloMax;e++){var o=listPolo[e];o.getBusy()||listPoloDrop.push(o)}}var btClockClickedAt=0;function clickBtClock(){getTime()-btClockClickedAt>350&&(pauseGame(),btClockClickedAt=getTime())}function enableBtClock(){$btClock.off().on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(clickBtClock)})).addClass("enable")}function disableBtClock(){$btClock.off().removeClass("enable")}var timenow,timespent,renderRAF,sndMetronome,curBonus=null;function clickBtBonus(e){bonusWaiting=!0,curBonus=listBonus[(bonusQueue=e)-1],checkSndAspiration(!0),e=decimal(getRemainingTimeBeforeBonus()/1e3,2),e=(e-=.5)<.5?0:e,TweenMax.delayedCall(e,showBlackFadeAtStart)}function cancelClickBtBonus(){bonusWaiting&&stopBonusVideo()}function showBlackFadeAtStart(){$boxVideo.addClass("visible"),$fadeVideo[0].offsetHeight,$fadeVideo.addClass("animateFadeIn"),modeReplay||modeRandom||miniPlayer||(hideDiv($boxPicto,!0),hideDiv($boxLoaderPolo,!0))}function blackFadeRemoved(){$boxVideo.removeClass(),$fadeVideo.removeClass(),modeReplay||modeRandom||miniPlayer||($boxStage.removeClass("pointerlock"),showDiv($boxPicto,!0),showDiv($boxLoaderPolo,!0))}function videoSlideDown(){bottomNeedSlide&&!miniPlayer&&$body.addClass("bottomSlide")}function launchBonusVideo(){$boxVideo.addClass("visible"),$boxStage.addClass("pointerlock"),$fadeVideo.removeClass(),pictoForceOnDrop(),videoSlideDown(),curBonus.play(),bonusPlaying=!(bonusWaiting=!1)}function stopBonusVideo(){killTransitionBonus(),curBonus&&curBonus.stop(),videoFadeOut(),bonusPlaying=bonusWaiting=!1,cntBoucleBonus=bonusQueue=0,curBonus=null}function videoFadeOut(){$boxVideo.hasClass("visible")?($fadeVideo.removeClass().addClass("show"),$fadeVideo[0].offsetHeight,$body.hasClass("bottomSlide")?($body.removeClass("bottomSlide"),$boxVideo.one(transitionEnd,(function(){$fadeVideo.addClass("animateFadeOut").one(animationEnd,blackFadeRemoved)}))):$fadeVideo.addClass("animateFadeOut").one(animationEnd,blackFadeRemoved)):blackFadeRemoved()}function killTransitionBonus(){TweenMax.killTweensOf(showBlackFadeAtStart)}function checkerCodeBonus(e,o){for(var t=e.id+1,n=0;n<nbBonus;n++)listBonus[n].checkCode(t,o)}function checkUnlockNextBonus(){var e,o;modeReplay||modeRandom||(e=curBonus.getId(),o="v"+appVersion+"-bonus-complete",(storage.getItem(o)||0)<=e&&e<nbBonus-1&&(storage.setItem(o,o=e+1),listBonus[o].unlockme(),popupBonusFindNext()))}function showDiv(e,o,t){o?addTransition(e,"fade","opacity",t):e.removeClass("fade"),e.removeClass("hide")}function hideDiv(e,o,t){o?addTransition(e,"fade","opacity",t):e.removeClass("fade"),e.addClass("hide")}var waitingFirstLoop=!1,bonusPlaying=!1,bonusWaiting=!1,shouldImmediatePlayBonus=!1,bonusQueue=0,leaveApp=!1,boucleA=!0,cntBoucle=0,cntBoucleBonus=0,timeremain=0,pctMetronome=0,pctMetronomeBoucleA=0,frame=0,frameTotal=0,frameHalf=0,framePart2=0,stepAnimation=0,stepPercent=0,currentSndPart=0,startboucle=0,pausedAt=0;function loopFinished(){checkPoloToRemove(),checkPoloToSolo(),modeRandom&&randomMix.loop(),modeReplay&&(replayMix.waitForReloop&&cntBoucleBonus==curBonus.nbLoop&&(replayMix.waitForReloop=!1,replayMix.reloop=!0),readingBar.loop()),loopOn&&startLoop(),modeRecord&&readingBar.loop()}function startLoop(){bonusPlaying&&cntBoucleBonus==curBonus.nbLoop&&app.bonusendloopA&&!boucleA&&(boucleA=!0),0==cntBoucle&&keepAppAwake(),startboucle=getTime(),loopOn=!0,frame=0,currentSndPart=boucleA?framePart2=0:(framePart2=frameHalf,1),clock.start(loopDuration,boucleA),sndMetronome.prepare(tabBuffer.metro[0].snd),modeReplay&&readingBar.isLastLoop()?sndMetronome.onComplete(readingBar.loop):sndMetronome.onComplete(loopFinished),(bonusWaiting||bonusPlaying)&&playBonus(),bonusPlaying||playSounds(),checkSndAspiration(),sndMetronome.play(),cntBoucle++,boucleA=!boucleA}function checkSndAspiration(e){bonusWaiting&&(e?(boucleA||!app.bonusloopA)&&getRemainingTime()>600&&curBonus.playAspiration(decimal(getTimeSpent()/1e3,2)):boucleA||curBonus.playAspiration(0))}function stopLoop(){let e=`offV${appVersion}Mix`;window[e]?.(),console.info(`Loop stopped with ${e}()`),boucleA=!(loopOn=!1),currentSndPart=cntBoucle=0,clock.stop(),stopBonusVideo(),checkPoloToRemove(bonusPlaying),sndMetronome.stop(),disableBtClock(),modeRecord&&stopRecordMode(),modeReplay&&stopReplayMode(),stopKeepingAppAwake()}function playBonus(){var e=!app.bonusloopA||boucleA;(e=modeReplay&&!!replayMix.waitForReloop||e)&&!bonusPlaying&&(launchBonusVideo(),hidePoloLoader()),bonusPlaying&&++cntBoucleBonus>curBonus.nbLoop&&(checkUnlockNextBonus(),stopBonusVideo())}function playSounds(){for(var e=0;e<nbPoloMax;e++){var o=listPolo[e];o.getBusy()&&(o.waitOneLoop?(o.showLoader(),o.waitOneLoop=!1):playSoundPolo(o))}}function playSoundPolo(e){var o=0==currentSndPart?"sndA":"sndB";e.sound.prepare(tabBuffer.sound[e.getAssetId()][o]),e.hideLoader(),e.getMute()||e.getHide()||e.mode("anime"),e.playSound()}function renderLoop(){if(timenow=getTime(),timespent=getTimeSpent(),timeremain=getTimeRemain(),pctMetronome=timespent*stepPercent,pctMetronomeBoucleA=app.bonusloopA?decimal(100-(pctMetronomeBoucleA=getRemainingTime(!boucleA)*stepPercent)/2,2):pctMetronome,frame=Math.floor(timespent*stepAnimation),clock.render(),readingBar.render(),isnull(curBonus)||bonusPlaying&&curBonus.render(),!bonusPlaying){mainCanvas.clear();for(var e=0;e<nbPoloMax;e++)listPolo[e].draw()}}function stopAllStage(){modeRandom&&stopRandomMode(),pictoForceOnDrop();for(var e=getListPoloBusy(),o=0,t=e.length;o<t;o++){var n=e[o];listPoloToRemove.push(n)}for(o=0,t=listBonus.length;o<t;o++)listBonus[o].reinit();globalVolumeFadeOut(stopLoop),cancelAllDelays()}function hidePoloLoader(){for(var e=getListPoloBusy(),o=0,t=e.length;o<t;o++)e[o].hideLoader()}var audioCtx,gamePausedByUser=!1;function pauseGame(){(pause?(gamePausedByUser=!1,pauseOff):(gamePausedByUser=!0,pauseOn))()}function pauseOn(){pause||(pause=!0,pausedAt=getTime(),$body.addClass("pause"),pauseAudioContext(),onGame&&(isToolbarOpen&&closeTool(),loopOn&&!froze&&(clock.pause(),TweenMax.pauseAll(),curBonus)&&curBonus.pause(),froze&&clearTimeout(controlTimeout),renderRAF.stop(),pauseAllDelays(),pictoForceOnDrop(),createFocus("game-paused")))}function pauseOff(){pause&&(pause=!1,startboucle+=getTime()-pausedAt,$body.removeClass("pause"),resumeAudioContext(),onGame)&&(loopOn&&!froze&&(clock.resume(),TweenMax.resumeAll(),curBonus)&&curBonus.resume(),froze&&controlTimeoutComplete(),renderRAF.start(),resumeAllDelays(),removeInFocusHistory("game-paused"),createFocusFromHistory())}function appOnPause(){pauseOn(),leaveApp=!0,lock(),TweenMax.killTweensOf(appOnResumeComplete)}function appOnResume(){needToforceUserGesture=!(leaveApp=!1),TweenMax.killTweensOf(appOnResumeComplete),TweenMax.delayedCall(.25,appOnResumeComplete)}function appOnResumeComplete(){unlock(),popupStillHere()}function clickPopupStillHere(){lock(),forceUserGesture((function(){gamePausedByUser||pauseOff(),unlock()}))}function pauseAudioContext(){globalVolumeFadeOut((()=>{audioCtx.suspend().then((()=>{})).catch((e=>{}))}))}function resumeAudioContext(){audioCtx.resume().then((()=>{checkAudioCanRun().then((()=>{globalVolumeFadeIn()})).catch((e=>{stopAllStage()}))})).catch((e=>{stopAllStage()}))}var globalGain,globalFilter,froze=!1;function frozeScene(){pause||froze||(loopOn=!(froze=!0),sndMetronome.stop(),immediateKillAllPolo(),replayMix.stop(),readingBar.froze(),renderRAF.stop(),clock.stop(!0),mainCanvas.saveImage(),mainCanvas.showImage(),notnull(curBonus)&&(bonusWaiting?stopBonusVideo():bonusPlaying&&(killTransitionBonus(),curBonus.sound.stop(),curBonus.pause(),bonusPlaying=!1)))}function unfrozeScene(e){var o,t;!pause&&froze&&(o=curBonus,t=froze=!1,replayMix.loop(e),renderRAF.start(),readingBar.unfroze(),o&&(shouldImmediatePlayBonus?curBonus.getId()!=o.getId()?o.stop():t=!0:stopBonusVideo()),shouldImmediatePlayBonus?(shouldImmediatePlayBonus=!1,replayMix.waitForReloop=!0,startLoop(),t||($fadeVideo[0].offsetHeight,$fadeVideo.removeClass().addClass("show animateFadeOut"))):mainCanvas.showImage())}function immediateKillAllPolo(){for(var e=getListPoloBusy(),o=0,t=e.length;o<t;o++)checkerCodeBonus(e[o].getPicto(),!1),e[o].stopSound(),e[o].deshabiller(0,!0),e[o].desactiverClick()}function immediatePlayBonus(e,o){bonusWaiting=shouldImmediatePlayBonus=!0,(curBonus=listBonus[bonusQueue=e]).prepareVideo(o),cntBoucleBonus=o-1}function showPoloAndPictoInCombo(e){for(var o=getListPoloBusy(),t=listBonus[e-1],n=[],i=0,a=o.length;i<a;i++){var s=o[i].getPicto().id;t.hasCode(s+1)&&n.push(o[i].id)}showPoloInArray(n),showPictoInCombo(e)}function showPoloInArray(e){TweenMax.killTweensOf(stopShowPoloInArray);var o=getListPoloBusy();if(o.length>1)for(var t=0,n=o.length;t<n;t++){var i=o[t];existInArray(e,i.id)?i.getHide()&&i.stopHidingYourself():i.hideYourself()}}function stopShowingPoloInArray(e){var o=getListPoloHidden();e=e||0,e=decimal((getTime()-e)/1e3,2);TweenMax.delayedCall(e<1?1:.1,stopShowPoloInArray,[o])}function stopShowPoloInArray(e){for(var o=0,t=e.length;o<t;o++)e[o].stopHidingYourself();stopShowPictoInCombo()}function showPictoInCombo(e){stopShowPictoInCombo();for(var o=listBonus[e-1].getCode(),t=o.length,n=0,i=listPicto.length;n<i;n++)for(var a=listPicto[n],s=0;s<t;s++)existInArray(o,a.id+1)||a.hideYourself()}function stopShowPictoInCombo(){for(var e=0,o=listPicto.length;e<o;e++)listPicto[e].stopHiddingYourself()}function getStringDate(e,o){var t,n;e=-1==e.indexOf("/")?e.split("-").join("/"):e;e=new Date(e);return o?(o=e.getHours(),t=e.getMinutes(),n=e.getSeconds(),o=String(o<10?"0"+o:o),t=String(t<10?"0"+t:t),n=String(n<10?"0"+n:n),String(o+":"+t+":"+n)):(o=e.getDate(),t=e.getMonth(),n=e.getFullYear(),e=o+" "+STR("txt.months")[t]+" "+n,"zh-cn"!=currentLanguage.toLowerCase()&&"zh-tw"!=currentLanguage.toLowerCase()?e:n+" 年 "+(t+1)+" 月 "+o+" 日")}function getTimeSpent(e){return loopOn||e?timenow-startboucle:0}function getTimeRemain(){return loopDuration-getTimeSpent()}function getRemainingTime(e){return(e=void 0!==e&&e)?2*loopDuration-(getTime()-startboucle):loopDuration-(getTime()-startboucle)}function getRemainingTimeBeforeBonus(){return getRemainingTime(!!app.bonusloopA&&!boucleA)}function getRandomObject(e){var o=Math.floor(Math.random()*e.length);return e.splice(o,1)[0]}function getListPoloBusy(){for(var e=[],o=0;o<nbPoloMax;o++){var t=listPolo[o];t.getBusy()&&e.push(t)}return e}function getListPoloUnmute(){for(var e=[],o=getListPoloBusy(),t=0,n=o.length;t<n;t++){var i=o[t];i.getMute()||e.push(i)}return e}function getListPoloFree(){for(var e=[],o=0;o<nbPoloMax;o++){var t=listPolo[o];t.getBusy()||e.push(t)}return e}function getListPictoBusy(){for(var e=[],o=0;o<nbSound;o++){var t=listPicto[o];t.used&&e.push(t)}return e}function getListPictoFree(){for(var e=[],o=0;o<nbSound;o++){var t=listPicto[o];t.used||t.ignored||e.push(t)}return e}function getListPoloHidden(){for(var e=[],o=getListPoloBusy(),t=0,n=o.length;t<n;t++){var i=o[t];i.getHide()&&e.push(i)}return e}function lock(){$lockAll.addClass("show"),pictoForceOnDrop()}function unlock(){$lockAll.removeClass("show")}var audioPort="",globalSampleRate=44100,globalVolumeMax=1,globalVolumeMin=0,globalFadeSpeed=.015;function rebuildAudioContext(){return new Promise((function(e,o){killAudioContext(),initAudioContext(),audioCtx.resume().then((()=>{e()})).catch((e=>{o(e)}))}))}function initAudioContext(){(audioCtx=new AudioContext).onstatechange=checkStateAudioCtx,audioCtx.hasOwnProperty("sampleRate"),audioCtx.hasOwnProperty("baseLatency"),(globalGain=audioCtx.createGain()).connect(audioCtx.destination),globalGain.gain.value=globalVolumeMin}function killAudioContext(){var e,o;audioCtx&&(e=audioCtx.createBuffer(2,globalSampleRate/2,globalSampleRate),(o=audioCtx.createBufferSource()).buffer=e,o.connect(audioCtx.destination),o.start(0),o.disconnect(),audioCtx.close(),audioCtx=null)}function globalVolumeFadeOut(e){globalGain.gain.cancelScheduledValues(audioCtx.currentTime),globalGain.gain.setTargetAtTime(globalVolumeMin,audioCtx.currentTime,globalFadeSpeed),setTimeout((()=>{globalGain.gain.value=globalVolumeMin,e&&e()}),6e3*globalFadeSpeed)}function globalVolumeFadeIn(e){globalGain.gain.cancelScheduledValues(audioCtx.currentTime),globalGain.gain.setTargetAtTime(globalVolumeMax,audioCtx.currentTime,globalFadeSpeed),setTimeout((()=>{globalGain.gain.value=globalVolumeMax,e&&e()}),6e3*globalFadeSpeed)}function checkStateAudioCtx(){audioCtx&&"running"!=audioCtx.state&&onGame&&loopOn&&!pause&&!leaveApp&&(appOnPause(),appOnResume())}function checkAudioCanRun(){return new Promise((function(e,o){var t;audioCtx&&audioCtx.currentTime?(t=audioCtx.currentTime,setTimeout((()=>{t==audioCtx.currentTime?o(new Error("audioCtx.currentTime is stuck")):e()}),150)):o(new Error("audioCtx or audioCtx.currentTime is null"))}))}var needToforceUserGesture=!0;function forceUserGesture(e){if(!needToforceUserGesture)return e&&e(),!1;var o;needToforceUserGesture=!1;var t=new SoundObject;t.setSilence(),t.prepare(tabBuffer.sound[0].sndA),t.play(),t.stop(),listBonus.length?(o=0,listBonus.forEach((function(t){var n=t.video.currentTime;t.video.play().then((function(){t.video.pause(),t.video.currentTime=n,++o==listBonus.length&&e&&e()})).catch((function(e){throw popupGeneralError({error:"force video play"}),new Error(e)}))}))):e&&e()}function initAudioRoute(){}function initSilentMode(){}function detectSilentMode(){}function bugBluetoothLatency(){return!1}function SoundObject(e){if("object"!=typeof audioCtx||!audioCtx)throw new Error("Aucun AudioContxt n'a été déclaré");var o=this,t=null,n=null,i=null,a=0,s=!1,r=!1,l=!1;this.getMute=function(){return s},this.getDuration=function(){return null!=n?n.duration:0},this.getCurrentTime=function(){return null!=t&&null!=t.context?t.context.currentTime:0},this.setSilence=function(){l=!0},this.setVolume=function(e){i.gain.setValueAtTime(e,audioCtx.currentTime)},this.onComplete=function(e){t.onended=e},this.prepare=function(e,a){n=e,i=audioCtx.createGain(),(t=audioCtx.createBufferSource()).buffer=n,e=0==a||s||l?globalVolumeMin:globalVolumeMax,o.setVolume(e),t.connect(i),i.connect(globalGain),globalGain.connect(audioCtx.destination)},this.play=function(e,n){r=!0,a=(a=(a=decimal(e,3)||0)>o.getDuration()?decimal(o.getDuration(),2)-.01:a)<0?0:a,t.start(0,a),!0!==n||s||l||o.fadeIn()},this.stop=function(e){e||null==t||!r||l||s?o.stopSource():o.fadeOut(!0)},this.stopSource=function(){null!=t&&r&&(t.stop(0),t.onended=null),a=0,i=t=null,r=s=!1},this.fadeOut=function(e){i.gain.setTargetAtTime(globalVolumeMin,audioCtx.currentTime,globalFadeSpeed),e&&(t.stop(audioCtx.currentTime+6*globalFadeSpeed),t.onended=o.stopSource)},this.fadeIn=function(){i.gain.setTargetAtTime(globalVolumeMax,audioCtx.currentTime,globalFadeSpeed)},this.mute=function(){t&&!l&&o.fadeOut(),s=!0},this.unmute=function(){t&&!l&&o.fadeIn(),s=!1}}var $activeTab,$activeFilter,$activePage,$scrollbox,$boxline,$boxinfo,pointerList=[];function enablePictoDraggable(){document.body.addEventListener(pointerEventType.down,pictoPointerDown),document.body.addEventListener(pointerEventType.up,pictoPointerUp),document.body.addEventListener(pointerEventType.cancel,pictoPointerUp),document.body.addEventListener(pointerEventType.leave,pictoPointerUp),document.body.addEventListener(pointerEventType.move,pictoPointerMove)}function pictoPointerDown(e){var o,t,n;isPictoDiv(e)&&(t=(o="targetTouches"in e?e.targetTouches[0]:e).target.parentNode.dataset.pictoNum,(n=listPicto[t]).locked||(mouseX=o.pageX,mouseY=o.pageY,n.onDrag)||-1!=getIndexFromPointerList("pictoNum",t)||(e={event:e,uniqueId:"identifier"in o?o.identifier:o.pointerId,picto:n,pictoNum:t,dropForced:!1},n.used?n.usedTouchStart():(n.startDrag(),n.moveDrag(o.pageX,o.pageY),poloStartWatchPicto()),pointerList.push(e)))}function pictoPointerUp(e){var o;pointerList.length&&(e=getIndexFromPointerList("uniqueId",(e="changedTouches"in e?e.changedTouches[0]:e)["identifier"in e?"identifier":"pointerId"]))>=0&&((o=pointerList[e].picto).used?o.usedTouchEnd():(o.stopDrag(),pictoOnDrop(o,pointerList[e].dropForced)),1==pointerList.length&&poloStopWatchPicto(),pointerList.splice(e,1))}function pictoForceOnDrop(){for(;pointerList.length;){var e=pointerList[0];e.dropForced=!0,pictoPointerUp(e.event)}}function pictoPointerMove(e){var o;pointerList.length&&(o=getIndexFromPointerList("uniqueId",(e="targetTouches"in e?e.targetTouches[0]:e)["identifier"in e?"identifier":"pointerId"]))>=0&&(o=pointerList[o].picto).onDrag&&(o.moveDrag(e.pageX,e.pageY),checkPictoHoverPolo(o),mouseX=pointerList[pointerList.length-1].picto.pointerAxis.px,mouseY=pointerList[pointerList.length-1].picto.pointerAxis.py)}function isPictoDiv(e){return e.target.classList.contains("hitzone")&&e.target.parentNode.classList.contains("picto")}function getIndexFromPointerList(e,o){return pointerList.findIndex((t=>t[e]==o))}function PictoObject(e,o){var t,n=this,i=o.find("#picto"+e),a=0,s=isMobile?1.1:1.2;this.id=e,this.ignored=app.animearray[n.id].ignored||!1,this.used=!1,this.locked=!1,this.onDrag=!1,this.polo=null,this.pointerAxis={px:0,py:0},this.ignored?i.addClass("ignored"):(this.startDrag=function(){t=i[0].getBoundingClientRect(),n.onDrag=!0,i.removeClass("flashme"),i.addClass("drag")},this.moveDrag=function(e,o){n.setTranslation(e,o)},this.stopDrag=function(){n.onDrag=!1,i.removeClass("drag")},this.replacer=function(){n.locked=!0,i.addClass("replacer").one(animationEnd,n.replacerFini)},this.absorber=function(e){i.css({transform:"translate3d(0px, 0px, 0px)"}),i.removeClass("replacer"),i.addClass("griser"),addToHistory("totalPolosUsed"),n.used=!0,n.polo=e},this.reactiver=function(e){n.locked=!0,e=!!notnull(e)&&e,i.removeClass("griser"),n.polo=null,!e||modeRandom||modeReplay?n.replacerFini():i.addClass("flashme").one(animationEnd,(function(e){$(e.target).removeClass("flashme"),n.replacerFini()}))},this.replacerFini=function(){i.removeClass("replacer"),i.css({transform:"translate3d(0px, 0px, 0px)"}),n.used=!1,n.locked=!1,n.pointerAxis={px:0,py:0}},this.usedTouchStart=function(){a=getTime(),showPoloInArray([n.polo.id])},this.usedTouchEnd=function(){stopShowingPoloInArray(a),a=0},this.checkusedTouchStart=function(){0!=a&&n.usedTouchEnd()},this.hideYourself=function(){i.addClass("hideYourself")},this.stopHiddingYourself=function(){i.removeClass("hideYourself")},this.setTranslation=function(e,o){n.pointerAxis={px:e,py:o},e-=t.x,o-=t.y,e-=t.width/2,o-=t.width/s,i.css({transform:"translate3d("+e+"px, "+o+"px, 0px)"})})}window.getPoloWearing={},window.getPoloRemoving={};let lastShake=0,targetShake=0,shakeTimer=0;function getRealisticShake(e=app.scaredPolos,o=5){return app.scaredPolos=app.scaredPolos||0,0===app.scaredPolos?0:(shakeTimer+=o,shakeTimer>=1&&(shakeTimer=0,lastShake=targetShake,targetShake=Math.random()*e*2-e),lastShake+(targetShake-lastShake)*shakeTimer)}let snowEffectStarted=!1;function getSpecialEventDetails(){if(expEventsOn)return fetch("https://raw.githubusercontent.com/RemmieUwU/Incredimods/refs/heads/main/RMB-events/todayEvent.json").then((e=>e.json())).then((e=>{specialEventNow=e.isEventOn||!1,specialEventName=e.eventName||"No Event Now",console.log(`About event: Is happening?: [${specialEventNow}] name of the event: [${specialEventName}].`),checkForEventEffects()})).catch((e=>console.error("Fetch failed:",e))),specialEventNow}function checkForEventEffects(){if("Winter"===specialEventName||"Christmas"===specialEventName){let e=document.getElementById("snowCanvas");e&&!snowEffectStarted?(e.style.display="block",drawSnow(),snowEffectStarted=!0):e||console.error("[SNOW EVENT] Can't find snow canvas!")}else console.log(`[SNOW EVENT] Snow effect won't play because: (event name: ${specialEventName})`)}getSpecialEventDetails();let eventHatTesterMode=!1;var eventHatSrc;function updateEventHatSprite(){eventHatSrc=eventHatTesterMode?"./js/event-hat-preview.png":"https://raw.githubusercontent.com/RemmieUwU/Incredimods/refs/heads/main/RMB-events/event-hat-sprite.png"}function PoloObject(e,o){var t;this.sound=new SoundObject("polo"+e),this.lastShakeTime=0;var n,i=!1;n=1==animSize?2:1,this.shakeTimer=0,this.lastShake=0,this.targetShake=0,this.shakeAnimPolo=0;var a,s,r,l,c,u,p,d,m,f,v,h,b,g,x,w,y,k,T,C,D,S,P,A,B,E,F,M,L,R,I,O,H,W,z,N=0,j=0,V=this,X=!1,Y=328,U=426,G=0,_=0,q=0,Q=0,K=null,Z=$("#box-polo").find(".polo[data-polo-id='"+e+"']"),J=$("#box-loader-polo").find(".zone[data-polo-id='"+e+"']"),ee=J.find(".loader"),oe=J.find(".bar"),te=!1,ne=o,ie="",ae=!1,se=listImages.spritePolo;if(this.sprite=se,eft=2,this.setSprite=function(e){let o=renameFile(e);e=`./img/${o}`;const t=new Image;t.onload=()=>{this.sprite=t,se=t},t.onerror=()=>{console.error(`Failed to load sprite image: ${e}`),boxDialog?.open?.(`Failed to load polo sprite image: [${e}]`,"😢")},t.src=e},modPoloMaps[`v${appVersion}`]&&modPoloMaps["v"+appVersion].length>0){const o=modPoloMaps["v"+appVersion].find((o=>parseInt(o.id)===e));o&&this.setSprite(o.normal)}this.getPoloShakeAnim=function(e=5){return 0===V.shakeAnimPolo?0:(V.shakeTimer+=e,V.shakeTimer>=1&&(V.shakeTimer=0,V.lastShake=V.targetShake,V.targetShake=Math.random()*V.shakeAnimPolo*2-V.shakeAnimPolo),V.lastShake+(V.targetShake-V.lastShake)*V.shakeTimer)};var re=be,le=.5,ce=0,ue=!1;this.id=e,this.state="normal";var pe,de=Z.find(".ctrl"),me=100;function fe(){ne.globalAlpha=1,ne.drawImage(se,0,0,cropPoloW,cropPoloH,V.drawPoloX+me,V.drawPoloY+pe,drawPoloW,drawPoloH)}function ve(e,o){ne.drawImage(se,e,o,cropEyeW,cropEyeH,V.drawPoloX+me,V.drawPoloY+drawEyeY+pe,drawEyeW,drawEyeH)}function he(){ne.globalAlpha=1-le,ne.drawImage(se,cropPoloW,0,cropPoloW,cropPoloH,V.drawPoloX+me,V.drawPoloY+pe,drawPoloW,drawPoloH)}function be(){fe(),ve(cropEyeX,cropEyeY),he()}function ge(){if("anime"===V.state&&B&&W&&z){const e=V.drawPoloX+me+O*poloRatio*cnvPXD,o=V.drawPoloY+pe+H*poloRatio*cnvPXD,n=t||p;ne.drawImage(n,R,I,E,F,e+getRealisticShake()+V.getPoloShakeAnim(),o+getRealisticShake()+V.getPoloShakeAnim(),W,z)}}function xe(){if(!expEventsOn)return;if(!(eventHatTesterMode||K&&X&&specialEventNow))return;V&&void 0!==V.hatAnimOffset&&V.hatAnimOffset,V&&void 0!==V.poloHeadImpactOffset&&V.poloHeadImpactOffset;if(X){let e=q||0,o=Q||0;"anime"!==V.state&&(e=0,o=0),o+=N;const t=V.drawPoloX+me+e,n=V.drawPoloY+pe+o,i=Y,a=U,s=G,r=_,l=i*poloRatio*cnvPXD/animSize,c=a*poloRatio*cnvPXD/animSize;if(!K||"string"==typeof K){console.log("Loading hat sprite...");const e=new Image;return e.src=renameFile(eventHatSrc),e.onload=function(){K=e,console.log("Hat sprite loaded successfully"),X&&K&&!V.hatAnimationActive&&setTimeout((function(){V.hatAnimationActive||V.startHatAnimation()}),100)},void(e.onerror=function(){console.error("Failed to load hat sprite")})}const u=ne.globalAlpha;ne.globalAlpha=1,"mute"===V.state||"unhide"===V.state||"waiting"===V.state?ne.drawImage(K,s,r,i,a,t,n,l,c):ne.drawImage(K,s,r,i,a,t+getRealisticShake()+V.getPoloShakeAnim(),n+getRealisticShake()+V.getPoloShakeAnim(),l,c),"mute"===V.state||"unhide"===V.state?(ne.globalAlpha=.7,ne.drawImage(K,164*animSize,r,i,a,t,n,l,c)):"hide"===V.state&&(ne.globalAlpha=1,ne.drawImage(K,164*animSize,r,i,a,t,n,l,c)),ne.globalAlpha=u}}function we(){ne.globalAlpha=1,M&&ge(),ne.drawImage(p,0,0,cropAnimW+V.waitingWidth,cropAnimH+V.waitingHeight,V.drawPoloX+me-V.waitingWidth*poloRatio*n/2,V.drawPoloY+pe-V.waitingHeight*poloRatio*n,drawAnimW+V.waitingWidth*poloRatio*n,drawAnimH+V.waitingHeight*poloRatio*n),M||ge(),V.hatAnimationPlayed&&xe()}function ye(){M&&ge(),we(),ne.globalAlpha=.7,ne.drawImage(p,2*cropAnimW+2*V.waitingWidth,0,cropAnimW+V.waitingWidth,cropAnimH+V.waitingHeight,V.drawPoloX+me-V.waitingWidth*poloRatio*n/2,V.drawPoloY+pe-V.waitingHeight*poloRatio*n,drawAnimW+V.waitingWidth*poloRatio*n,drawAnimH+V.waitingHeight*poloRatio*n),M||ge(),xe()}function $e(){xe(),M&&ge(),we(),ce=1,ne.globalAlpha=ce,ne.drawImage(p,2*cropAnimW+2*V.waitingWidth,0,cropAnimW+V.waitingWidth,cropAnimH+V.waitingHeight,V.drawPoloX+me-V.waitingWidth*poloRatio*n/2,V.drawPoloY+pe-V.waitingHeight*poloRatio*n,drawAnimW+V.waitingWidth*poloRatio*n,drawAnimH+V.waitingHeight*poloRatio*n),M||ge()}function ke(){xe(),M&&ge(),we();var e=b?.7:0;ce=ce<=e?e:decimal(ce-.1,2),ne.globalAlpha=ce,ne.drawImage(p,2*cropAnimW+2*V.waitingWidth,0,cropAnimW+V.waitingWidth,cropAnimH+V.waitingHeight,V.drawPoloX+me-V.waitingWidth*poloRatio*n/2,V.drawPoloY+pe-V.waitingHeight*poloRatio*n,drawAnimW+V.waitingWidth*poloRatio*n,drawAnimH+V.waitingHeight*poloRatio*n),M||ge(),ce<=e&&V.stopHidingYourselfComplete()}function Te(){d?be():(V.anime(),ne.globalAlpha=1,M&&ge(),"true"==L&&ne.drawImage(p,cropAnimW+V.waitingWidth,0,cropAnimW+V.waitingWidth,cropAnimH+V.waitingHeight,V.drawPoloX+getRealisticShake()+me+V.getPoloShakeAnim()-V.waitingWidth*poloRatio*n/2,V.drawPoloY+getRealisticShake()+pe+V.getPoloShakeAnim()-V.waitingHeight*poloRatio*n,drawAnimW+V.waitingWidth*poloRatio*n,drawAnimH+V.waitingHeight*poloRatio*n),ne.drawImage(p,D,S+1+V.waitingHeight,cropAnimW+V.waitingWidth,C-1,V.drawPoloX+k+getRealisticShake()+me+V.getPoloShakeAnim()-V.waitingWidth*poloRatio*n/2,V.drawPoloY+T+1+getRealisticShake()+pe+V.getPoloShakeAnim(),drawAnimW+V.waitingWidth*poloRatio*n,y-1),M||ge(),V.hatAnimationPlayed&&xe())}function Ce(){var e=timenow-P;e=Math.floor(e*Ae),e=A-1<e?A-1:e;fe(),ve(cropEyeX,Be[e]*cropEyeH),he(),A-1<=e&&V.mode("normal")}function De(){var e,o;h?Te():(fe(),o=V.getPupPos(drawPup1X,drawPup1Y),e=V.getPupPos(drawPup2X,drawPup2Y),ne.drawImage(se,0,cropPupY,cropPupW,cropPupW,o[0],o[1],drawPupW,drawPupW),ne.drawImage(se,0,cropPupY,cropPupW,cropPupW,e[0],e[1],drawPupW,drawPupW),(o=(mouseY-canvasBound.top)*cnvPXD)<V.drawPoloY+90*poloRatio*cnvPXD?ve(cropEyelidX,cropEyelid4Y):o>=V.drawPoloY+90*poloRatio*cnvPXD&&o<V.drawPoloY+130*poloRatio*cnvPXD?ve(cropEyelidX,cropEyelid3Y):o>=V.drawPoloY+170*poloRatio*cnvPXD?ve(cropEyelidX,cropEyelid2Y):ve(cropEyelidX,cropEyelid1Y))}function Se(){De(),he()}function Pe(){De()}function ge(){if("anime"===V.state&&B&&W&&z){const e=V.drawPoloX+me+O,o=V.drawPoloY+pe+H,n=t||p;ne.drawImage(n,R,I,E,F,e+getRealisticShake()+V.getPoloShakeAnim(),o+getRealisticShake()+V.getPoloShakeAnim(),W,z)}}pe=window.innerHeight<500?20:window.innerHeight<700?15:10,V.hatAnimationActive=!1,V.hatAnimOffset=0,V.poloHeadImpactOffset=0,this.startHatAnimation=function(){if((V.hatAnimationActive||V.hatAnimationPlayed||!eventHatTesterMode)&&!specialEventNow)return;V.hatAnimationActive=!0;const e={hatOffset:randomRangeInt(-620,-600),headOffset:0};TweenMax.to(e,.5,{hatOffset:0,ease:Quint.easeIn,onUpdate:function(){V.hatAnimationPlayed=!0,V.hatAnimOffset=e.hatOffset,N=e.hatOffset},onComplete:function(){TweenMax.to(e,0,{hatOffset:20,headOffset:14,ease:Quint.easeOut,onUpdate:function(){V.hatAnimOffset=e.hatOffset,V.poloHeadImpactOffset=e.headOffset,N=e.hatOffset,j=e.headOffset},onComplete:function(){TweenMax.to(e,.6,{hatOffset:0,headOffset:0,ease:Quint.easeOut,onUpdate:function(){V.hatAnimOffset=e.hatOffset,V.poloHeadImpactOffset=e.headOffset,N=e.hatOffset,j=e.headOffset},onComplete:function(){V.hatAnimationActive=!1}})}})}})},this.$btcMute=Z.find(".icon-game-bt-mute"),this.$btcSolo=Z.find(".icon-game-bt-solo"),this.$btcStop=Z.find(".icon-game-bt-delete"),this.pictoHoverId=null,this.reinit=function(){Fe(),V.draw(),ue=!1,V.pictoHoverId=null,a=s=r=0,ie=l=c=u=p=null,d=m=f=v=h=b=g=x=!1,i=!1,B=null,E=F=0,M=!1,R=I=O=H=0,W=z=0,V.originalAnimHeight=void 0,V.originalAnimWidth=void 0,V.waitingHeight=0,V.waitingWidth=0,X=!1,null,Y=328,U=426,!1,G=_=0,q=Q=0,0,K=null,TweenMax.killTweensOf(V),V.hatAnimationActive=!1,V.hatAnimOffset=0,V.poloHeadImpactOffset=0,V.hatAnimationPlayed=!1,void 0!==N&&(N=0),void 0!==j&&(j=0),V.shakeTimer=0,V.lastShake=0,V.targetShake=0,V.shakeAnimPolo=0},this.getPicto=function(){return l},this.getAssetId=function(){return c},this.getMoment=function(){return a},this.getLoop=function(){return s},this.getEnabled=function(){return m},this.getBusy=function(){return f},this.getHover=function(){return ue},this.getDeleting=function(){return h},this.getPlaying=function(){return v},this.getDiv=function(){return Z},this.getMute=function(){return b},this.getHide=function(){return x},this.getSolo=function(){return g},this.setSolo=function(e){(g=e)?V.$btcSolo.addClass("light"):V.$btcSolo.removeClass("light")},this.setLoop=function(e){s=e},this.setMoment=function(e){a=e},this.setPlaying=function(e){v=e},this.habiller=function(e,o,n,s,m){V.checkState(),c=(l=e).id,a=o,u=n.imgData,p=n.imgSprite,w=n.headHeight,C=n.headHeight*animSize,ie=n.color,r=u.length,getPoloWearing[c]=V.id;let v=`onV${appVersion}Polo${c}`;if(window[v]?.(),console.log(`Polo ${c} used by ${V.id} | ${v}()`),V.waitingHeight=n.height*animSize-cropAnimH||0,V.waitingWidth=n.width*animSize-cropAnimW||0,V.originalAnimHeight=n.height||0,V.originalAnimWidth=n.width||0,i=n.upsideDown||!1,shakeAnimPolo=n.shakeAnim||0,V.shakeAnimPolo=n.shakeAnim||0,L=n.animRenderBody||n.renderBody||"true",console.log(`as.waitingHeight: ${V.waitingHeight} | as.waitingWidth: ${V.waitingWidth}`),X&&K&&!V.hatAnimationActive&&!V.hatAnimationPlayed&&TweenMax.delayedCall(0,V.startHatAnimation),X=n.dontWearHat||!1,f=!0,X&&n.hatSprite){const e=new Image;e.src=`./js/${n.hatSprite}`,e.onload=function(){K=e,console.log("Hat sprite loaded for polo "+V.id)},n.hatBack||!1,Y=n.hatWidth||164,U=n.hatHeight||213,G=n.hatCropX||0,_=n.hatCropY||0,q=n.hatOffsetX||0,Q=n.hatOffsetY||0}else if(X){const e=new Image;e.src=renameFile(eventHatSrc),e.onload=function(){K=e},!1,Y=328,U=426,G=0,_=0,q=0,Q=0,2==animSize?(Y=328,U=426):(Y=164,U=213)}X&&(Y*poloRatio*cnvPXD*animSize,U*poloRatio*cnvPXD*animSize),i&&(window.window.innerHeight>=400?V.drawPoloY=V.drawPoloY/12:V.drawPoloY=V.drawPoloY),n.bodyData&&(B=n.bodyData,E=n.bodyWidth||n.objectWidth||164,F=n.bodyHeight||n.objectHeight||380,M=n.bodyBack||n.objectBack||!1,t=n.imgSprite,W=E*poloRatio*cnvPXD/2,z=F*poloRatio*cnvPXD/2,console.log(`Body habiller - animRenderBody: ${L}, bodyHeight: ${F}, drawBodyW: ${W}, drawBodyH: ${z}, poloRatio: ${poloRatio}, cnvPXD: ${cnvPXD}`)),V.resize(),oe.css({"background-color":"#"+ie}),ae?V.mode("waiting"):(d=!0,TweenMax.delayedCall(s,(function(){V.rebond(m)}))),recordMix.xmlAction("append",V)},this.checkState=function(){h&&!ae&&(TweenMax.killTweensOf(V),V.remonte(0,!0,!1))},this.deshabiller=function(o,n){let a=`offV${appVersion}Polo${V.id}`;if(console.log(`${a}()`),window[a]?.(),getPoloWearing[c]=void 0,d&&(d=!1,TweenMax.killTweensOf(V.rebond),TweenMax.killTweensOf(V.rebond2)),app.poloHoverEffect){const o=modPoloMaps["v"+appVersion].find((o=>parseInt(o.id)===e));o?polos[e].setSprite(o.normal):polos[e].setSprite(app.poloSprite)}f=!(h=!0),t=null,i?TweenMax.to(V,n?0:.3,{drawPoloY:-drawMaxTopY,ease:Quint.easeIn,onComplete:V.remonteFromUp,onCompleteParams:[0,!0,n],delay:o,overwrite:!0}):TweenMax.to(V,n?0:.3,{drawPoloY:drawMaxTopY,ease:Quint.easeIn,onComplete:V.remonte,onCompleteParams:[0,!0,n],delay:o,overwrite:!0}),this.hideLoader(),recordMix.xmlAction("remove",V)},this.baisser=function(){V.drawPoloY=drawMaxTopY},this.remonteFromUp=function(e,o,t){V.drawPoloY=-V.drawPoloY,(ae=!0)===o&&(o=!modeReplay&&!modeRandom&&!modeWatch,l.reactiver(o),getPoloRemoving[l.id]=V.id,V.reinit(),majListPoloDrop()),V.mode("normal"),o=randomRangeInt(drawMinTopY,drawMinTopY+drawMaxRandPosY),TweenMax.to(V,t?0:.4,{drawPoloY:o,ease:Back.easeOut,delay:t?0:e,overwrite:!0,onComplete:function(){ae=!1}})},this.remonte=function(e,o,t){var n=i;(ae=!0)===o&&(o=!modeReplay&&!modeRandom&&!modeWatch,l.reactiver(o),getPoloRemoving[l.id]=V.id,V.reinit(),majListPoloDrop()),V.mode("normal"),o=randomRangeInt(drawMinTopY,drawMinTopY+drawMaxRandPosY),n?TweenMax.to(V,t?0:.4,{drawPoloY:-o,ease:Back.easeOut,delay:t?0:e,overwrite:!0,onComplete:function(){ae=!1}}):TweenMax.to(V,t?0:.4,{drawPoloY:o,ease:Back.easeOut,delay:t?0:e,overwrite:!0,onComplete:function(){ae=!1}})},this.rebond=function(e){var o=V.drawPoloY-drawMaxBounceY,t=v?"anime":"waiting",n=e?0:.1;t=V.getMute()?"mute":t;V.mode(t),TweenMax.to(V,n,{drawPoloY:o,ease:Quint.easeOut,onComplete:V.rebond2,onCompleteParams:[e],overwrite:!0}),d=!1},this.rebond2=function(e){var o=V.drawPoloY+drawMaxBounceY;TweenMax.to(V,e?0:.2,{drawPoloY:o,ease:Back.easeOut,overwrite:!0})},this.showLoader=function(){te=!0,ee.addClass("show"),oe.css({"animation-duration":decimal(getRemainingTime()/1e3,2)+"s"}),oe.addClass("progress")},this.hideLoader=function(){te&&(te=!1,ee.removeClass("show"),oe.removeClass("progress"))},this.hideYourself=function(){(v||f)&&(x=!0,ce=b?.7:ce,V.mode("hide"))},this.stopHidingYourself=function(){(v||f)&&V.mode("unhide")},this.stopHidingYourselfComplete=function(){x=!1,b?V.mode("mute"):v?V.mode("anime"):V.mode("waiting")},this.drawPoloX=0+me,this.drawPoloY=drawMaxTopY,this.resize=function(){cropAnimW=sizes.polo.sprAnimW*animSize,cropAnimH=sizes.polo.sprAnimH*animSize,drawAnimW=sizes.polo.sprAnimW*poloRatio*cnvPXD,drawAnimH=sizes.polo.sprAnimH*poloRatio*cnvPXD,V.waitingHeight=V.originalAnimHeight*animSize-cropAnimH,V.waitingWidth=V.originalAnimWidth*animSize-cropAnimW,y=w*poloRatio*cnvPXD,V.drawPoloX=poloBlocX*V.id*cnvPXD,Z[0].style.left=poloBlocX*V.id+(sizes.polo.overlapW*poloRatio+me)/2+"px",Z[0].style.width=poloBlocW-sizes.polo.overlapW*poloRatio+"px",J[0].style.left=poloBlocX*V.id+sizes.polo.overlapW*poloRatio/2+"px",J[0].style.width=poloBlocW-sizes.polo.overlapW*poloRatio+"px",B&&(W=E*poloRatio*cnvPXD/animSize,z=F*poloRatio*cnvPXD/animSize),X&&(Y*poloRatio*cnvPXD/animSize,U*poloRatio*cnvPXD/animSize)},this.draw=function(){re()},this.mode=function(o){if(o!=V.state)switch(TweenMax.killTweensOf(Me),V.state=o,V.state){case"normal":if(app.poloHoverEffect){const o=modPoloMaps["v"+appVersion].find((o=>parseInt(o.id)===e));o?polos[e].setSprite(o.normal):polos[e].setSprite(app.poloSprite)}re=be,Fe();break;case"cligne":re=Ce;break;case"regarde":if(app.poloHoverEffect){const o=modPoloMaps["v"+appVersion].find((o=>parseInt(o.id)===e));o?polos[e].setSprite(o.normal):polos[e].setSprite(app.poloSprite)}re=Se;break;case"hover":if(app.poloHoverEffect){const o=modPoloMaps["v"+appVersion].find((o=>parseInt(o.id)===e));o?polos[e].setSprite(o.hover):polos[e].setSprite(app.poloSprite.replace(/\.png$/,"-hover.png"))}re=Pe;break;case"waiting":re=we;break;case"anime":re=Te,X&&K&&!V.hatAnimationActive&&!V.hatAnimationPlayed&&TweenMax.delayedCall(0,V.startHatAnimation);break;case"mute":re=ye;break;case"hide":re=$e;break;case"unhide":re=ke}},this.anime=function(){var e=frame;boucleA&&r==frameTotal&&(e+=frameHalf),enableFaceAnim?(D=u[e=r-1<=e?r-1:e][0]*animSize,S=u[e][1]*animSize):(D=0,S=380*animSize),enableHeadAnim?(k=u[e][2]*poloRatio*cnvPXD,T=u[e][3]*poloRatio*cnvPXD):(D=u[e=r-1<=e?r-1:e][0]*animSize,S=u[e][1]*animSize,k=0*poloRatio*cnvPXD,T=0*poloRatio*cnvPXD),T+=j;const o=u[e][4],t=o?o.trim().replace(/^\[|\]$/g,""):"",n=Date.now();t&&(this.lastEffectTime||(this.lastEffectTime=0),n-this.lastEffectTime>150&&("function"==typeof window[t]&&0==h?window[t]():console.warn(`No function named "${t}" found.`),this.lastEffectTime=n)),B&&B[e]&&(R=B[e][0]*animSize,I=B[e][1]*animSize,O=B[e][2]*poloRatio*cnvPXD,H=B[e][3]*poloRatio*cnvPXD),enableHeadAnim?X&&(q=u[e][2]*poloRatio*cnvPXD,Q=u[e][3]*poloRatio*cnvPXD):X&&(q=0,Q=0)},this.getPupPos=function(e,o){var t=(mouseX-canvasBound.left)*cnvPXD,n=(mouseY-canvasBound.top)*cnvPXD,i=V.drawPoloX+me+e+drawPupW/2,a=V.drawPoloY+pe+o+drawPupW/2,s=t-i,r=n-a,l=Math.atan2(r,s);return[drawMaxPupMove*Math.cos(l)+i-drawPupW/2+getRealisticShake(1),drawMaxPupMove*Math.sin(l)+a-drawPupW/2+getRealisticShake(1)]};var Ae=0,Be=[],Ee=[[0,1,2,2,1,0],[0,3,4,5,6,7,8,0],[0,3,4,4,3,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,1,2,2,2,2,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1,2,2,9,9,9,9,2,2,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0],[0,1,2,2,9,9,9,9,9,9,9,9,9,9,2,2,2,10,10,10,10,10,10,10,10,10,10,1,2,2,10,10,10,10,10,2,2,0],[2,2,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,2,2,11,11,11,11,11,11,11,11,11,11,2,2,1,1]];function Fe(){var e=random(7)+2;TweenMax.delayedCall(e,Me)}function Me(){P=getTime();var e=random(Ee.length-1);Be=Ee[e],A=Be.length,Ae=A/(36*A),V.mode("cligne")}var Le=0,Re=0,Ie=0,Oe=0;function He(e){notnull(e)&&e.preventDefault(),g?(1==getTotalSolo()?stopSoloPolo():V.mute(),g=!1):V.switchMute(),b||g||stopOtherSolo()}function We(e){notnull(e)&&e.preventDefault(),clickPolo(V)}function ze(e){notnull(e)&&e.preventDefault(),(g?(g=!1,unmuteAll):(g=!0,muteAll))(V)}this.activerClick=function(){m||(m=!0,Z[0].addEventListener(pointerEventType.down,V.touchStart),V.activerCtrl())},this.desactiverClick=function(){m&&(m=!1,TweenMax.killTweensOf(V.touchLong),Z[0].removeEventListener(pointerEventType.down,V.touchStart),Z[0].removeEventListener(pointerEventType.move,V.touchMove),Z[0].removeEventListener(pointerEventType.up,V.touchEnd),V.desactiverCtrl())},this.touchStart=function(e){e.preventDefault();var o="targetTouches"in e?e.targetTouches[0]:e;Le=Re=o.pageX,Ie=Oe=o.pageY,TweenMax.delayedCall(.25,V.touchLong,[e]),Z[0].removeEventListener(pointerEventType.down,V.touchStart),Z[0].addEventListener(pointerEventType.move,V.touchMove),Z[0].addEventListener(pointerEventType.up,V.touchEnd)},this.touchMove=function(e){e.preventDefault();var o="targetTouches"in e,t=(e=o?e.targetTouches[0]:e,o?60:20);Re=e.pageX,Oe=e.pageY,Ie+(o?60:20)<Oe&&Math.abs(Re-Le)<t&&(TweenMax.killTweensOf(V.touchLong),clickPolo(V))},this.touchLong=function(e){e.preventDefault(),TweenMax.killTweensOf(V.touchLong),g=!0,soloPolo(),V.$btcSolo.addClass("light")},this.touchEnd=function(e){e.preventDefault(),TweenMax.killTweensOf(V.touchLong),Z[0].removeEventListener(pointerEventType.move,V.touchMove),Z[0].removeEventListener(pointerEventType.up,V.touchEnd),Z[0].addEventListener(pointerEventType.down,V.touchStart),g?(1==getTotalSolo()?stopSoloPolo():V.mute(),g=!1,V.$btcSolo.removeClass("light")):V.switchMute()},this.activerCtrl=function(){de.addClass("visible").on(pointerEventType.down,stopProp),V.$btcMute.on(pointerEventType.down,He),V.$btcSolo.on(pointerEventType.down,ze),V.$btcStop.on(pointerEventType.down,We)},this.desactiverCtrl=function(){de.removeClass("visible").off(),V.$btcMute.off().removeClass("light"),V.$btcSolo.off().removeClass("light"),V.$btcStop.off().removeClass("light")},this.playSound=function(){v=!0,this.sound.play(),s++},this.stopSound=function(e){v=!1,this.sound.stop(e)},this.mute=function(){b=!0,x||(V.mode("mute"),V.$btcMute.addClass("light")),V.sound.mute(),recordMix.xmlAction("mute",V)},this.unmute=function(){b=!1,x||(v?this.mode("anime"):this.mode("waiting"),V.$btcMute.removeClass("light")),this.sound.unmute(),recordMix.xmlAction("unmute",V)},this.switchMute=function(){b?V.unmute():V.mute()},this.hitTest=function(e,o){e=(e-canvasBound.left)*cnvPXD,o=(o-canvasBound.top)*cnvPXD;var t=poloOverlapW*cnvPXD/2;return e>V.drawPoloX+me+t&&e<V.drawPoloX+me+drawPoloW-t&&o>V.drawPoloY&&o<canvasBound.height*cnvPXD},this.hitTestPicto=function(e){return!f&&!h&&V.hitTest(Math.round(e.pointerAxis.px),Math.round(e.pointerAxis.py))},this.rollover=function(){ue||(ue=!0,V.mode("hover"))},this.rollout=function(e){notnull(e)&&e?(ue=!1,V.mode("normal")):ue&&(ue=!1,V.mode("regarde"))},this.resize(),this.reinit()}updateEventHatSprite();var mixToWatch=null,mixToShare=null,XHRmemotime={},$lineOpened=null,scrollPosY=0,lineClicked=null,showLastMix=!1,mixDB={latest:[],search:[],top50:{day:[],week:[],month:[],year:[]},totalNbMix:0};function initMixlist(){$poplist=$mixlist.find("#poplist"),$mixlist.$bck=$mixlist.find(".bac"),$mixlist.$bck.fadeIn=function(){this.addClass("animateFadeIn")},$mixlist.$bck.fadeOut=function(){this.addClass("animateFadeOut").one(animationEnd,(function(e){$(e.target).removeClass("animateFadeIn animateFadeOut")}))},$scrollbox=$poplist.find("#scrollbox"),$boxinfo=$scrollbox.find(".boxinfo"),$boxline=$scrollbox.find(".boxline"),$tabLatest=$("#tab-latest"),$tabTop50=$("#tab-top50"),$tabSearch=$("#tab-search"),$tabMixlist=$("#tab-mixlist"),$mixlist.find(".tabbox .tab").on(pointerEventType.down,clickBtTab),$mixlist.find(".pagebox .tab-filter .bt").on(pointerEventType.down,clickBtFilter),$mixlist.find(".pagebox#box-search .bt.search").on(pointerEventType.down,clickBtSearch)}function openPlaylist(e,o,t){lock(),showLastMix=!0===t,$mixlist.addClass("show"),$mixlist.$bck.fadeIn(),o?enableMixlist():$poplist.addClass("open").one(animationEnd,enableMixlist),"mixlist"==e||!hasNetwork||isSafeMode()?(delete XHRmemotime.mymix,activeBtTab("mixlist")):activeBtTab("mixlist")}function enableMixlist(){unlock(),$homeBtList.removeSpinner(),$poplist.addClass("opened"),$mixlist.$bck.on(pointerEventType.down,closePlaylist),$mixlist.find(".pagebox#box-search input#input-search").on(pointerEventType.down,(function(e){$mixlist.find(".pagebox#box-search .formline .input-loader").addClass("spin").show()})),$mixlist.find(".pagebox#box-search input#input-search").on("focus",(function(){$mixlist.find(".pagebox#box-search .formline .input-loader").removeClass("spin").hide()}))}function closePlaylist(){focusHistory=[],deleteFocus(),lock(),$mixlist.$bck.off(),$mixlist.$bck.fadeOut(),$mixlist.find(".pagebox#box-search input#input-search").off(),$poplist.removeClass("opened").addClass("close").one(animationEnd,hideMixlist)}function hideMixlist(){closeActionLine($lineOpened),$poplist.removeClass("open close"),$mixlist.removeClass("show"),$(".tab",$poplist).removeClass("active"),$activeFilter=$activePage=$activeTab=null,blurAll(),unlock(),createFocus("home")}function cleanScrollbox(){$boxline&&($scrollbox.scrollTop(0),closeActionLine($lineOpened),unbindAllLine(),$boxline.empty(),$boxinfo.empty())}function bindAllLine(){$boxline.find(".line").on(pointerEventType.down,clickLineStart),$boxline.find(".line").on(pointerEventType.up,clickLineEnd),$boxline.find(".box-action").on(pointerEventType.down,stopProp),$boxline.find(".box-action").on(pointerEventType.up,stopProp),$boxline.find(".bt.watch").on(pointerEventType.down,clickBtWatch),$boxline.find(".bt.share").on(pointerEventType.down,clickBtShare),$boxline.find(".bt.link").on(pointerEventType.down,clickBtLink),$boxline.find(".bt.fav").on(pointerEventType.down,clickBtFav),$boxline.find(".bt.delete").on(pointerEventType.down,clickBtDelete),$boxline.find(".bt.download").on(pointerEventType.down,clickBtDownload)}function unbindAllLine(){$boxline.find(".line").off(),$boxline.find(".line .box-action").off(),$boxline.find(".line .box-action .bt").off()}function unbindLine(e){e.off(),e.find(".box-action").off(),e.find(".box-action .bt").off()}function clickLineStart(e){var o=$(e.currentTarget).parent().parent();scrollPosY=o.scrollTop(),lineClicked=$(e.currentTarget)}function clickLineEnd(e){lineClicked&&$(e.currentTarget).parent().parent().scrollTop()==scrollPosY&&lineClicked.attr("data-key")==$(e.currentTarget).attr("data-key")&&openActionLine(e.currentTarget),lineClicked=null}function clickBtTab(){blurAll(),$(this).hasClass("active")?$scrollbox.scrollTop(0):activeBtTab($(this).attr("id").replace("tab-",""))}function activeBtTab(e){blurAll(),$scrollbox.find(".spinner-box").removeClass("spin"),$scrollbox.find(".spinner-box").hide(),$boxinfo.empty(),$poplist.find(".tabbox .tab").removeClass("active"),($activeTab=$poplist.find(".tabbox .tab#tab-"+e)).addClass("active"),cleanScrollbox(),$poplist.find(".pagebox").removeClass("show"),($activePage=$poplist.find(".pagebox#box-"+e)).addClass("show"),"latest"==e?loadLatest():"top50"==e?activeFilter("day"):"search"==e?(cleanSearchInput(),activeFilter("name")):"mixlist"==e&&activeFilter("mymix")}function clickBtFilter(){blurAll(),$(this).hasClass("active")?$scrollbox.scrollTop(0):activeFilter($(this).attr("id").replace("bt-",""))}function activeFilter(e){blurAll(),$poplist.find(".tab-filter .bt").removeClass("active"),($activeFilter=$poplist.find(".tab-filter .bt#bt-"+e)).addClass("active"),["day","week","month","year"].includes(e)?(cleanScrollbox(),loadTop50()):["name","title","dedi"].includes(e)?(cleanScrollbox(),clickBtSearch()):["mymix","myfav"].includes(e)&&(cleanScrollbox(),loadMixlist())}function getActiveTabString(){return $activeTab&&$activeTab.length?$activeTab.attr("id").replace("tab-",""):""}function getActiveFilterString(){return $activePage.find(".tab-filter").length&&$activeFilter&&$activeFilter.length?$activeFilter.attr("id").replace("bt-",""):""}function openActionLine(e){e=$(e);var o=null!==$lineOpened?$lineOpened.index():-1;toggleAcionLine($lineOpened),o!=e.index()&&toggleAcionLine(e)}function toggleAcionLine(e){null!==e&&(e.hasClass("animateOpen")?(e.removeClass("animateOpen").addClass("animateClose").one(animationEnd,(function(){e.removeClass("animateClose")})),$lineOpened=null,removeInFocusHistory("playlist-line-open"),createFocus("playlist-all",e)):(e.removeClass("animateClose").addClass("animateOpen"),$lineOpened=e,createFocus("playlist-line-open")))}function closeActionLine(e){null!==e&&(e.removeClass("animateOpen").removeClass("animateClose"),$lineOpened=null)}function showSpin(e){e.addClass("spin"),e.find("svg use").attr("xlink:href","#ic-loader-mini"),$scrollbox.find(".spinner-box").addClass("spin"),$scrollbox.find(".spinner-box").show()}function hideSpin(e,o){e.removeClass("spin"),e.find("svg use").attr("xlink:href",o),$scrollbox.find(".spinner-box").removeClass("spin"),$scrollbox.find(".spinner-box").hide()}function clickBtShare(e){e.stopPropagation();var o=(e=$(this)).parent().parent().attr("data-key").replace("mix-","");notnull(mixToShare=searchMixInCurrentList(o))?checkIfMixSavedThenShare("global",e):boxDialog.open(STR("pop.notFoundText"),STR("pop.notFoundTitle"),[STR("bt.ok")],[function(){Spinner.reset()}])}function clickBtLink(e){e.stopPropagation();var o=(e=$(this)).parent().parent().attr("data-key").replace("mix-","");notnull(mixToShare=searchMixInCurrentList(o))?checkIfMixSavedThenShare("clipboard",e):boxDialog.open(STR("pop.notFoundText"),STR("pop.notFoundTitle"),[STR("bt.ok")],[function(){Spinner.reset()}])}function clickBtFav(e){e.stopPropagation();var o=(t=(e=$(this).parent().parent()).attr("data-key")).replace("mix-",""),t=t.replace("mix-","fav-");notnull(o=searchMixInCurrentList(o))?isMixInFav(o)?(e.removeClass("isfavoris"),localMixObject.deleteMix(t),"myfav"==getActiveFilterString()&&(unbindLine(e),closeActionLine(e),e.remove(),createFocus("playlist-all"))):(e.addClass("isfavoris"),localMixObject.saveMix(o,!0),$tabMixlist.find("svg use").attr("xlink:href","#ic-rate-mini"),$tabMixlist.removeClass("animateFavIcon").addClass("animateFavIcon").one(animationEnd,(function(){$tabMixlist.find("svg use").attr("xlink:href","#ic-mixlist-mini"),$tabMixlist.removeClass("animateFavIcon")}))):popupGeneralError({error:STR("pop.notFoundTitle")})}function clickBtDelete(e){e.stopPropagation();var o=$(this),t=o.parent().parent(),n=searchMixInCurrentList(t.attr("data-key").replace("mix-",""));Spinner.add(o),!n.online||hasNetwork?boxDialog.open(STR("pop.deleteText"),STR("pop.deleteTitle"),[STR("bt.yes"),STR("bt.no")],[function(){deleteMixConfirm(o,t,n)},function(){unlock(),Spinner.reset()}]):boxDialog.open(STR("pop.noNetworkText"),STR("pop.noNetworkTitle"),[STR("bt.ok")],[function(){unlock(),Spinner.reset()}])}function deleteMixConfirm(e,o,t){localMixObject.deleteMix("mix-"+t.link)?(localMixObject.deleteMix("fav-"+t.link),unbindLine(o),closeActionLine(o),o.remove(),(o=localMixObject.getMixlist().length)<=5&&$scrollbox.scrollTop(0),0==o&&$boxinfo.html(STR("txt.mixlistEmpty")),unlock(),createFocus("playlist-all")):boxDialog.open(STR("pop.deleteBugText"),STR("pop.notFoundTitle"),[STR("bt.ok")],[function(){unlock()}]),Spinner.reset(),t.online&&$.ajax({type:"POST",url:domainOnline+"ph3/delete-mix-db.php",data:{uuid:getListUUID(),mix:t},dataType:"json",crossdomain:!0,success:function(e){"success"==e.state?saveGA("mix","delete_db",t.link):saveGA("mix","delete_db_failed",t.link)},error:function(e){saveGA("mix","delete_db_error",t.link)}})}function clickBtDownload(e){e.stopPropagation();var o=(e=$(this)).parent().parent().attr("data-key").replace("mix-","");notnull(mixToShare=searchMixInCurrentList(o))?converterCanRun()?popupConvertMix():checkIfMixSavedThenShare("download",e):boxDialog.open(STR("pop.notFoundText"),STR("pop.notFoundTitle"),[STR("bt.ok")],[function(){Spinner.reset()}])}var ajaxLatestRunning=!1;function loadLatest(){if(ajaxLatestRunning)return!1;if(!hasNetwork)return $boxinfo.html(STR("pop.noNetworkText")),!1;if(!minuteMoreThan(1,!1,"latest"))return fillLatest(),!1;ajaxLatestRunning=!0,showSpin($tabLatest);var e={v:app.version};$.ajax({type:"GET",url:domainOnline+"ph3/get-live.php?v="+app.version,data:e,dataType:"json",crossdomain:!0,success:function(e){ajaxLatestComplete(),("success"==e.state?(XHRmemotime.latest=new Date,mixDB.totalNbMix=e.total,mixDB.latest=e.mixlist,mixDB.latest.map((function(o){o.mymix=!1,o.dateQuery=e.created})),fillLatest):ajaxLatestError)()},error:function(e){ajaxLatestError()}})}function ajaxLatestComplete(){ajaxLatestRunning=!1,hideSpin($tabLatest,"#ic-live-mini")}function ajaxLatestError(){ajaxLatestComplete(),$mixlist.isOpen()&&$tabLatest.hasClass("active")&&boxDialog.open(STR("pop.noCoServerText"),STR("pop.noCoServerTitle"),[STR("bt.ok")])}function fillLatest(){var e;$mixlist.isOpen()&&$tabLatest.hasClass("active")&&(e=generateHtml(mixDB.latest,generateLineMix,"latest"),$boxline.html(e[0]),mixDB.totalNbMix>0?$boxinfo.html(STR("txt.latestMixInfo").replace("%{mix_total}",numberSpaced(mixDB.totalNbMix)).replace("%{version_name}",app.name)):$boxinfo.html(STR("txt.latestMixInfo").split("<br>")[0]),bindAllLine(),createFocus("playlist-all"))}var ajaxTop50Running=!1;function loadTop50(){return!ajaxTop50Running&&(hasNetwork?mixDB.top50.day.length&&!minuteMoreThan(10,!1,"top50")?(fillTop50(),!1):(ajaxTop50Running=!0,showSpin($tabTop50),void $.ajax({type:"GET",url:domainOnline+"ph3/get-top-50.php",data:{v:app.version},dataType:"json",crossdomain:!0,success:function(e){"success"==e.state?(console.log(midDB.top50),ajaxTop50Complete(),mixDB.top50={day:e.listDay,week:e.listWeek,month:e.listMonth,year:e.listYear},mixDB.top50.day.map((e=>e.mymix=!1)),mixDB.top50.week.map((e=>e.mymix=!1)),mixDB.top50.month.map((e=>e.mymix=!1)),mixDB.top50.year.map((e=>e.mymix=!1)),fillTop50(),hideSpin($tabTop50,"#ic-trophy-mini")):ajaxTop50Error()},error:function(e){ajaxTop50Error()}})):($boxinfo.html(STR("pop.noNetworkText")),!1))}function ajaxTop50Complete(){ajaxTop50Running=!1,hideSpin($tabTop50,"#ic-trophy-mini"),XHRmemotime.top50=new Date}function ajaxTop50Error(){ajaxTop50Complete(),$mixlist.isOpen()&&$tabTop50.hasClass("active")&&$boxinfo.html(STR("pop.noCoServerText"))}function fillTop50(){var e,o;$mixlist.isOpen()&&$tabTop50.hasClass("active")&&(o=[],"day"==(e=getActiveFilterString())?(o=generateHtml(mixDB.top50.day,generateLineTop50),$boxline.html(o[0]),mixDB.top50.day=o[1]):"week"==e?(o=generateHtml(mixDB.top50.week,generateLineTop50),$boxline.html(o[0]),mixDB.top50.week=o[1]):"month"==e?(o=generateHtml(mixDB.top50.month,generateLineTop50),$boxline.html(o[0]),mixDB.top50.month=o[1]):"year"==e&&(o=generateHtml(mixDB.top50.year,generateLineTop50),$boxline.html(o[0]),mixDB.top50.year=o[1]),$boxinfo.html(STR("txt.top50Info")),bindAllLine(),createFocus("playlist-all"))}var controlTimeout,ajaxSearchRunning=!1,lastFilterSearch="",lastSearch="";function clickBtSearch(){var e,o,t,n,i;return!ajaxSearchRunning&&(hasNetwork?(e=$poplist.find("form #input-search"),o=getActiveFilterString(),n=(t=cleanInputText(t=e.val().substr(0,26))).split(" ").join(""),i=regexList.search,blurAll(),""==n?(lastSearch="",cleanListSearch()):lastSearch==t.toLowerCase()&&lastFilterSearch==o||(i.test(n)?invalidField(e):(lastSearch=t.toLowerCase(),lastFilterSearch=o,showSpin($tabSearch),Spinner.add($poplist.find("#bt-search")),loadSearch(t,o))),void createFocus("playlist-all")):(boxDialog.open(STR("pop.noNetworkText"),STR("pop.noNetworkTitle"),[STR("bt.ok")]),!1))}function fillSearch(){var e;$tabSearch.hasClass("active")&&(e=generateHtml(mixDB.search,generateLineMix,"search"),$boxline.html(e[0]),bindAllLine(),createFocus("playlist-all"))}function loadSearch(e,o){var t={v:app.version};t.uuid=getListUUID(),t.str=encodeURIComponent(e),t.f=encodeURIComponent(o),$("#list-search .spinner-box",$poplist).show(),ajaxSearchRunning=!0,cleanListSearch(),$.ajax({type:"GET",url:domainOnline+"ph3/search-mix.php",data:t,dataType:"json",crossdomain:!0,success:function(e){var o;"success"==e.state?(ajaxSearchComplete(),o=e.mixlist.length<=1&&notnull(STR("txt.result.one"))?STR("txt.result.one"):STR("txt.result.other"),$boxinfo.html(o.replace("%{count}",e.mixlist.length)),e.mixlist.length&&(e.mixlist.forEach((function(o,t){o.dateQuery=e.now})),mixDB.search=e.mixlist,fillSearch())):ajaxSearchError()},error:function(e){ajaxSearchError()}})}function ajaxSearchComplete(){ajaxSearchRunning=!1,hideSpin($tabSearch,"#ic-search-mini"),Spinner.reset()}function ajaxSearchError(){ajaxSearchComplete(),$mixlist.isOpen()&&$tabSearch.hasClass("active")&&boxDialog.open(STR("pop.noCoServerText"),STR("pop.noCoServerTitle"),[STR("bt.ok")])}function cleanSearchInput(){lastSearch=lastFilterSearch="",$("#box-search #input-search").val("")}function cleanListSearch(){cleanScrollbox(),mixDB.search=[]}function loadMixlist(){localMixObject.getMixlist().length||localMixObject.getFavlist().length?fillMixlist():$boxinfo.html(STR("txt.mixlistEmpty"))}function fillMixlist(){var e,o,t,n;$mixlist.isOpen()&&$tabMixlist.hasClass("active")&&(t=[],"mymix"==(e=getActiveFilterString())?(n=localMixObject.getMixlist()).length&&(t=generateHtml(n,generateLineMix,"mymix"),$boxline.html(t[0]),hasNetwork?$boxinfo.html(STR("txt.mixlistInfo").replace("%{date_time}",2)):$boxinfo.html(STR("txt.mixlistNoCo")),minuteMoreThan(2,!1,"mymix")&&localMixObject.getStatMixOnline(),showLastMix)&&(showLastMix=!1,(o=$boxline.find(".line").first()).addClass("bckFlash").one(animationEnd,(function(){o.removeClass("bckFlash")}))):"myfav"==e&&(n=localMixObject.getFavlist()).length&&(t=generateHtml(n,generateLineMix,"myfav"),$boxline.html(t[0]),$boxinfo.empty(),minuteMoreThan(2,!1,"myfav"))&&localMixObject.getStatFavOnline(),bindAllLine(),createFocus("playlist-all"))}function generateHtml(e,o,t){for(var n="",i=[],a=0,s=e.length;a<s;a++){var r=e[a];i.push(r),n+=o(r,a,t)}return[n,i]}function generateLineTop50(e,o){return generateLineMix(e,o,"top50")}function generateLineMix(e,o,t){e=e||{},o=o+1||0;var n="top50"===(t=t||""),i="top50"===t||"latest"===t||"search"===t,a="latest"===t||"search"===t,s="mymix"===t&&!e.online,r="1"==e.private,l="mymix"===t,c="mymix"===t,u=trustAppMobile,p=("mymix"===t||"search"===t)&&isMixInTop50(e),d=("mymix"===t||"search"===t)&&isMixInLatest(e),m=(t="myfav"===t||isMixInFav(e),sameMixInLocal(e)),f=notnull(e.datedb)?e.datedb:getDateNow(),v="line";v="<div data-key='mix-"+e.link+"' class='"+v+(s?" isoffline":"")+(r?" isprivate":"")+(t?" isfavoris":"")+(m?" ismymix":"")+(p?" istop50":"")+(d?" islatest":"")+"'>";return(v+="<div class='mixbanner box-info"+(n?" rating":"")+"'>")+(n?"<div class='rating'>"+o+"</div>":"")+"<div class='info'><span class='title'>"+e.title+"</span><div class='dj'>"+(i?"<div class='box-flag'><div class='fflag fflag-"+e.country.toUpperCase()+"'></div></div>":"")+"<span class='name'>"+e.name+"</span></div></div><div class='data'><div class='stat'><div class='boxstat mymix'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-user-mini'></use></svg></div></div><div class='boxstat private'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-lock-mini'></use></svg></div></div><div class='boxstat myfav'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-rate-mini'></use></svg></div></div><div class='boxstat top50'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-trophy-mini'></use></svg></div></div><div class='boxstat latest'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-live-mini'></use></svg></div></div><div class='boxstat offline'><div class='txt'>"+STR("txt.offline")+"</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-nocloud-mini'></use></svg></div></div><div class='boxstat liked'><div class='txt'>"+numberSpaced(e.nblike)+"</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div></div><div class='boxstat viewed'><div class='txt'>"+numberSpaced(e.nbview)+"</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div></div></div><span class='date' data-date='"+f+"'>"+(a?getTimeAgo(f,e.dateQuery):getStringDate(f))+"</span></div></div><div class='box-action'><div class='bt bt-round bt-big watch color-green'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='hitzone'></div></div>"+(u?"<div class='bt bt-round bt-big link color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='hitzone'></div></div>":"")+"<div class='bt bt-round bt-big fav'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-rate'></use></svg></div><div class='hitzone'></div></div>"+(c?"<div class='bt bt-round bt-big download'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='hitzone'></div></div>":"")+(l?"<div class='bt bt-round bt-big delete'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-trash'></use></svg></div><div class='hitzone'></div></div>":"")+"</div></div>"}function sameMixInLocal(e){return checkMixInArray(e.id,localMixObject.getMixlist())}function isMixInFav(e){return existInArrayFromProp(e.link,"link",localMixObject.getFavlist())}function isMixInTop50(e){return!(e.mymix&&!e.online||!(checkMixInArray(e.id,mixDB.top50.day)||checkMixInArray(e.id,mixDB.top50.week)||checkMixInArray(e.id,mixDB.top50.month)||checkMixInArray(e.id,mixDB.top50.year)))}function isMixInLatest(e){return!(e.mymix&&!e.online)&&checkMixInArray(e.id,mixDB.latest)}function checkMixInArray(e,o,t){for(var n in t=t||"id",o)if(e==o[n][t])return!0;return!1}function getMixInArray(e,o,t){for(var n in t=t||"id",o)if(e==o[n][t])return o[n]}function searchMixInCurrentList(e){var o,t=getActiveTabString(),n=getActiveFilterString(),i=e.replace("mix-","");switch(t){case"latest":o=getMixInArray(i,mixDB.latest,"link");break;case"top50":switch(n){case"day":o=getMixInArray(i,mixDB.top50.day,"link");break;case"week":o=getMixInArray(i,mixDB.top50.week,"link");break;case"month":o=getMixInArray(i,mixDB.top50.month,"link");break;case"year":o=getMixInArray(i,mixDB.top50.year,"link")}break;case"mixlist":switch(n){case"mymix":o=getMixInArray(i,localMixObject.getMixlist(),"link");break;case"myfav":o=getMixInArray(i,localMixObject.getFavlist(),"link")}break;case"search":o=getMixInArray(i,mixDB.search,"link")}return o}function minuteMoreThan(e,o,t){var n;return isnull(XHRmemotime[t])?!o||e:(e*=60,n=new Date,t=XHRmemotime[t].getTime()-n.getTime(),n=Math.round(Math.abs(t/1e3)),!0===o?secToText(1e3*(e-n)):e<=n)}function startRandomMode(){modeRandom=!0,$body.addClass("mode-random"),lock(),closeTool(),hideDiv($boxBtBonus),hideDiv($boxPicto,!0),hideDiv($boxLoaderPolo,!0),$btTool.off().on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(stopRandomMode)})),$btTool.bounce(),$btTool.$svg.attr("xlink:href","#ic-random"),$bckGlobal.addClass("fadeIn"),$boxStage.addClass("pointerlock"),TweenMax.delayedCall(.4,lancerRandomMode)}function showTextRandom(){$watchInfo.$title.html(STR("txt.randomTitle")),$watchInfo.$name.html(STR("txt.randomText")),$watchInfo.addClass("fadeIn")}function lancerRandomMode(){showTextRandom(),randomMix.start(loopOn),unlock(),saveGA("game","random")}function stopRandomMode(){modeRandom=!1,$body.removeClass("mode-random"),randomMix.stop(),$btTool.off(),$btTool.bounce(),enableBtTool(),$bckGlobal.removeClass("fadeIn"),$btTool.$svg.attr("xlink:href","#ic-burger"),$watchInfo.removeClass("fadeIn"),TweenMax.delayedCall(.4,afterStopRandom)}function afterStopRandom(){showDiv($boxBtBonus,!0),bonusPlaying||(showDiv($boxPicto,!0),showDiv($boxLoaderPolo,!0)),$boxStage.removeClass("pointerlock")}function RandomMix(e){var o=this;this.start=function(){o.loop(),o.checkIfPoloMuted()},this.stop=function(){},this.checkIfPoloMuted=function(){for(var e=getListPoloBusy(),o=0,t=e.length;o<t;o++){var n=e[o];n.getMute()&&n.unmute()}},this.loop=function(){var o=getListPoloFree(),t=getListPoloBusy(),n=getListPictoFree(),i=o.length,a=t.length,s=0,r=random(6),l=random(5),c=random(2),u=random(5)<4?2:1,p=!1,d=0,m="ajouter";m=r<c?"rien":m;if(m=r<l||0===i?"enlever":m,m=!loopOn||a<=1?"ajouter":m,u=!loopOn||a<=1?1:u,m=e?"ajouter":m,m=e&&0===i?"rien":m,bonusPlaying||bonusWaiting)m="bonus",cntBoucleBonus==curBonus.nbLoop&&(p=!0,m="enlever");else for(s=0;s<nbBonus;s++){var f=listBonus[s];if(f.found){m="bonus",f.launchVideo();break}}if("ajouter"==m){d=Math.round((random(i-1)+1)/u);var v,h=[];for(s=0;s<d;s++)v=getRandomObject(o),h.push(v.id);for(h.sort(),s=0;s<d;s++)pictoTouchePolo(v=listPolo[h[s]],getRandomObject(n),.03*s),majListPoloDrop()}else if("enlever"==m)for(d=Math.round((random(a-2)+1)/u),d=p&&a-d>4?a-4:d,s=0;s<d;s++)((v=getRandomObject(t)).getLoop()>2||p)&&removePolo(v,0);if("bonus"!=m){a=(t=getListPoloBusy()).length;var b=0;for(s=0;s<a;s++){var g=t[s];g.getLoop()>7&&++b<a&&removePolo(g,0)}}}}function startRecordMode(){bonusPlaying?popupBonusPlaying():(lock(),modeRecord=!0,$body.addClass("mode-record"),waitForRecording=!1,recordMix.init(),readingBar.maxLoop=app.recmaxloop,readingBar.open("record"),closeTool(),$btTool.off().on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(stopRecordMode)})),$btTool.bounce(),$btTool.$svg.attr("xlink:href","#ic-live"),loopOn?lancerRecordMode():TweenMax.delayedCall(.4,lancerRecordMode))}function lancerRecordMode(){(loopOn?startRecording:(waitForRecording=!0,popupDrag))(),unlock()}function startRecording(){waitForRecording=!1,readingBar.start(),readingBar.onLoopsFinished=()=>{stopRecordMode()},readingBar.onLooping=()=>{recordMix.loop()},recordMix.start(),saveGA("mix","start_recording")}function stopRecordMode(){modeRecord=!1,$body.removeClass("mode-record"),readingBar.stop(),readingBar.close(),recordMix.stop(),$btTool.$svg.attr("xlink:href","#ic-burger"),$btTool.off(),$btTool.bounce(),enableBtTool(),readingBar.cntLoop<readingBar.minLoop&&!waitForRecording&&TweenMax.delayedCall(.25,popupShort),readingBar.cntLoop>=readingBar.minLoop&&!waitForRecording&&(lock(),pictoForceOnDrop(),stopAllStage(),popupRecok())}function RecordMix(){var e,o,t,n,i,a=this,s=decimal(loopDuration/1e3,2);this.init=function(){o=e="",t=!1,n=0,i={}},this.setData=function(e){i=e},this.getData=function(){return i},this.getXML=function(){return e},this.start=function(){a.init(),t=!0,a.xmlOpen()},this.loop=function(){a.xmlCloseAction(),a.xmlCloseLoop(),n++,a.xmlOpenLoop(),a.xmlOpenAction()},this.stop=function(){t=!1,a.xmlClose()},this.xmlOpen=function(){e="<mix version='"+build.version+"' control='true'>\n",a.xmlOpenLoop(),a.xmlOpenAction()},this.xmlClose=function(){a.xmlCloseAction(),a.xmlCloseLoop(),e+="</mix>\n"},this.xmlOpenLoop=function(){if(o="\t<loop boucleA='"+!boucleA+"' count='"+n+"'>\n",o+="\t\t<stage>\n",bonusPlaying)o+="\t\t\t<bonus id='"+(bonusQueue-1)+"' playing='true' cntBoucle='"+cntBoucleBonus+"' />\n";else{bonusWaiting&&n>0&&(o+="\t\t\t<bonus id='"+(bonusQueue-1)+"' waiting='true'/>\n");for(var e=0;e<nbPoloMax;e++){var t,i=listPolo[e];i.getBusy()&&("",t=i.getPlaying()||0!==i.getMoment()||0!==i.getLoop()?"\t\t\t<polo id='"+i.id+"' picto='"+i.getPicto().id+"' mute='"+i.getMute()+"' playing='"+i.getPlaying()+"'/>\n":"\t\t\t<polo id='"+i.id+"' picto='"+i.getPicto().id+"' mute='"+i.getMute()+"' playing='true'/>\n",o+=t)}}o+="\t\t</stage>\n"},this.xmlCloseLoop=function(){e+=o+="\t</loop>\n"},this.xmlOpenAction=function(){o+="\t\t<action>\n",0===n&&bonusWaiting&&recordMix.xmlAction("bonus",listBonus[bonusQueue-1],!0)},this.xmlCloseAction=function(){o+="\t\t</action>\n"},this.xmlAction=function(e,n,i){var a,r;t&&(i=void 0!==i&&i,a=decimal(getTimeSpent(!0)/1e3,2),r="","bonus"==e?r+=i?"\t\t\t<user type='"+e+"' bonus='"+n.getId()+"' when='0.1'/>\n":"\t\t\t<user type='"+e+"' bonus='"+n.getId()+"' when='"+a+"'/>\n":(a=s-delayassist/1e3<a?s:a,r+="\t\t\t<user type='"+e+"' polo='"+n.id+"' picto='"+n.getPicto().id+"' when='"+a+"'/>\n"),o+=r)}}function prepareReplayMode(){modeReplay=!0,$body.addClass("mode-replay"),lock(),closeTool(),$btTool.off().on(pointerEventType.down,(function(e){e.preventDefault(),preventAction(stopReplayMode)})),$btTool.bounce(),hideDiv($boxBtBonus,!modeWatch),hideDiv($boxPicto,!modeWatch),hideDiv($boxLoaderPolo,!modeWatch),$btTool.$svg.attr("xlink:href","#ic-close"),$btSave.on(pointerEventType.down,(function(e){e.preventDefault(),preventAction((function(){Spinner.add($btSave),stopReplayMode(!0)}))})),$boxStage.addClass("pointerlock"),modeWatch?($body.addClass("mode-watch"),$mixlist.hide(),$watchInfo.addClass("fadeIn")):($watchInfo.addClass("fadeIn"),$watchInfo.$title.html(STR("txt.replayTitle")),$watchInfo.$name.html(STR("txt.replayText")),$watchInfo.$dedi.empty(),$btSave.find(".txt").html(STR("bt.save")))}function startReplayMode(){var e=modeWatch?null!=mixToWatch.xml?mixToWatch.xml:mixToWatch.mix:recordMix.getXML();replayMix=new ReplayMix(e),readingBar.maxLoop=replayMix.getTotalLoop(),readingBar.bonusList=replayMix.getBonusList(),TweenMax.delayedCall(.4,(function(){readingBar.open("play",replayMix.control),readingBar.onLoopsFinished=()=>{stopReplayMode()},readingBar.onLooping=()=>{replayMix.loop()},readingBar.start(),replayMix.start()})),TweenMax.delayedCall(.6,(function(){createFocus("mode-replay"),unlock()}))}function stopReplayMode(e){removeInFocusHistory("mode-replay"),deleteFocus(),froze||(desactivateControl(),$btTool.off(),modeReplay=!1,readingBar.stop(),readingBar.close(),replayMix.stop(),modeWatch?(miniPlayer&&stopAllStage(),backToHome()):(stopAllStage(),$btTool.bounce(),$btTool.$svg.attr("xlink:href","#ic-burger"),$watchInfo.removeClass("fadeIn"),!0===e?(Spinner.reset(),appBrowserDemo?popupGetApp(!0):popupForm()):popupRecok(),TweenMax.delayedCall(.4,afterStopReplay)),enableBtTool())}function afterStopReplay(){showDiv($boxBtBonus,!modeWatch),showDiv($boxPicto,!modeWatch),showDiv($boxLoaderPolo,!modeWatch),$body.removeClass("mode-replay"),$boxStage.removeClass("pointerlock")}function reinitModeWatch(){afterStopReplay(),modeWatch=!1,$body.removeClass("mode-watch"),$btTool.$svg.attr("xlink:href","#ic-burger"),$watchInfo.removeClass(),$mixlist.show()}function clickBtWatch(e){var o;void 0!==e.type&&e.stopPropagation();var t=isnull(e=void 0===e.type?e:null);isnull(e=t?searchMixInCurrentList((o=$(this).parent().parent()).attr("data-key").replace("mix-","")):e)?boxDialog.open(STR("pop.notFoundText"),STR("pop.notFoundTitle"),[STR("bt.ok")]):(modeWatch=!0,mixToWatch=e,$watchInfo.$title.html(e.title),$watchInfo.$name.html(STR("txt.createdBy").split("%{name}").join(e.name)),$watchInfo.$dedi.html(""==e.dedi?"":STR("txt.dedicatedTo").split("%{name}").join(e.dedi)),$watchInfo.$date.html(getStringDate(e.datedb)),$watchInfo.$date.attr("data-date",e.datedb),$watchInfo.find(".mixbanner").attr("class","mixbanner"),$watchInfo.find(".stat").empty(),t?(t=o.find(".stat").html(),$watchInfo.find(".stat").html(t),t=$watchInfo.find(".dj .box-flag"),e.country?t.find(".fflag").removeClass().addClass("fflag fflag-"+e.country.toUpperCase()):t.hide(),t="",t=(t=(t=(t=(t+=o.hasClass("ismymix")?" ismymix":"")+(o.hasClass("isfavoris")?" isfavoris":""))+(o.hasClass("istop50")?" istop50":""))+(o.hasClass("islatest")?" islatest":""))+(o.hasClass("isprivate")?" isprivate":""),$watchInfo.find(".mixbanner").addClass(t)):$watchInfo.find(".stat").html("\n\t\t\t\t<div class='boxstat liked'><div class='txt'>"+numberSpaced(e.nblike)+"</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div></div>\n\t\t\t\t<div class='boxstat viewed'><div class='txt'>"+numberSpaced(e.nbview)+"</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div></div>\n\t\t\t"),mixToWatch.mymix||($btLike.removeClass("liked already disabled"),$btLike.off().on(pointerEventType.down,clickBtLikeMix),e.liked&&$btLike.addClass("liked"),miniPlayer)||countView(),clickHomeBtPlay())}function clickBtLikeMix(e){if(e.preventDefault(),$btLike.hasClass("disabled"))return!1;hasNetwork?($btLike.addClass("disabled"),Spinner.add($btLike),TweenMax.delayedCall(.5,(function(){!0===mixToWatch.liked?($btLike.removeClass("liked"),TweenMax.delayedCall(.5,(function(){$btLike.removeClass("disabled")})),countLike("nbunlike")):($btLike.addClass("liked"),TweenMax.delayedCall(.5,(function(){$btLike.removeClass("disabled")})),countLike("nblike"))}))):boxDialog.open(STR("pop.noNetworkVotedText"),STR("pop.noNetworkTitle"),[STR("bt.ok")])}function countLike(e){var o={uuid:trustAppMobile?device.uuid:"unknown",id:mixToWatch.id,link:mixToWatch.link,row:e};xhr("POST",domainOnline+"ph3/save-stat-mix.php",o,(function(e){if("success"==e.state)switch(e.info){case"like ok":mixToWatch.liked=!0,mixToWatch.nblike++;break;case"unlike ok":delete mixToWatch.liked,mixToWatch.nblike--,mixToWatch.nblike=mixToWatch.nblike<0?0:mixToWatch.nblike;break;case"already liked":boxDialog.open(STR("pop.alreadyVotedText"),STR("pop.alreadyVotedTitle"),[STR("bt.ok")]),$btLike.addClass("already liked"),mixToWatch.liked=!0}Spinner.reset(),$watchInfo.$like=$watchInfo.find(".stat .liked"),$watchInfo.$like.find(".bck").addClass("popIn").one(animationEnd,(function(e){$(e.target).removeClass(_classname)})),$watchInfo.$like.find(".txt").text(numberSpaced(mixToWatch.nblike)),miniPlayer||$lineOpened.find(".stat .liked .txt").text(numberSpaced(mixToWatch.nblike))}),(function(e){}))}function countView(){var e={uuid:trustAppMobile?device.uuid:"unknown",link:mixToWatch.link,row:"nbview"};hasNetwork&&xhr("POST",domainOnline+"ph3/save-stat-mix.php",e,(function(e){"success"==e.state&&(mixToWatch.viewed=!0)}))}var adBreak,adConfig,controlBoucle=0,controlIsBuzy=!1;function activateControl(){$boxStage[0].addEventListener(pointerEventType.down,listenControlPress)}function listenControlPress(e){e.preventDefault(),controlIsBuzy||(clearTimeout(controlTimeout),$boxStage[0].removeEventListener(pointerEventType.move,moveControlHead),$boxStage[0].addEventListener(pointerEventType.move,moveControlHead),document.body.removeEventListener(pointerEventType.up,listenControlRelease),document.body.addEventListener(pointerEventType.up,listenControlRelease),readingBar.openBig(),moveControlHead(e),frozeScene())}function listenControlRelease(e){e.preventDefault(),clearTimeout(controlTimeout),$boxStage[0].removeEventListener(pointerEventType.move,moveControlHead),document.body.removeEventListener(pointerEventType.up,listenControlRelease),readingBar.openNormal(),controlTimeout=setTimeout(controlTimeoutComplete,400)}function controlTimeoutComplete(){controlIsBuzy=!0,unfrozeScene(controlBoucle=readingBar.cntLoop),setTimeout((function(){controlIsBuzy=!1}),200)}function moveControlHead(e){e="targetTouches"in e?e.targetTouches[0]:e;var o=$incredibox[0].offsetLeft;e=e.pageX-o;e=(e=(e=Math.floor(readingBar.maxLoop*e/(document.body.clientWidth-2*o)))<0?0:e)>readingBar.maxLoop-1?readingBar.maxLoop-1:e,readingBar.seek(e)}function desactivateControl(){$boxStage[0].removeEventListener(pointerEventType.down,listenControlPress),$boxStage[0].removeEventListener(pointerEventType.move,moveControlHead),document.body.removeEventListener(pointerEventType.up,listenControlRelease),controlBoucle=0,clearTimeout(controlTimeout)}function ReplayMix(e){var o,t,n,i,a,s,r,l=this;function c(){var e,o=getListPoloBusy(),t=getListPoloUnmute();if(t.length>1)for(e in o)o[e].setSolo(!1);else if(1==o.length)o[0].setSolo(!1);else if(o.length>1&&1==t.length){for(e in o)o[e].setSolo(!1);t[0].setSolo(!0)}}this.control=!1,this.reloop=!1,this.waitForReloop=!1,this.init=function(){var l,c;t=$.parseXML(e),(o=$(t)).find("compo").length>0&&(n=!0,l=convertFlashXml(e),t=$.parseXML(l),o=$(t)),t=o.find("mix"),i=appBrowserDemo||appBrowserSchool||"true"===t.attr("control")&&!appBrowser,a=t.children().length,s=decimal(loopDuration/1e3,2),r=0,i&&(c=[],o.find("user[type=bonus]").each((function(){c.push(parseInt($(this).attr("bonus")))})),(c=removeDupInArray(c)).length<=app.bonusarray.length?activateControl():i=!1),this.control=i,this.reloop=!1,this.waitForReloop=!1},this.getTotalLoop=function(){return a},this.start=function(){l.loop()},this.stop=function(){TweenMax.killTweensOf(l.appendPolo),TweenMax.killTweensOf(l.removePolo),TweenMax.killTweensOf(l.mutePolo),TweenMax.killTweensOf(l.unmutePolo),TweenMax.killTweensOf(l.launchBonus),TweenMax.killTweensOf(l.soloPolo),this.control=!1,l.reloop=!1,l.waitForReloop=!1},this.loop=function(e){var t,i;notnull(e)&&(r=e,l.reloop=!0),r==a?stopReplayMode():(e=o.find('loop[count="'+r+'"]'),(0===r||l.reloop)&&(boucleA="true"==e.attr("boucleA"),i=e.find("stage"),t=0,$(i).children().each((function(e){var o,n,i,a,s=this.tagName;"polo"==s&&(o=Number($(this).attr("id")),n=Number($(this).attr("picto")),a="true"==$(this).attr("mute"),e=-1==o?listPolo[e]:listPolo[o],o=listPicto[n],n=l.reloop?0:.03,i=!!l.reloop,l.appendPolo(e,o,t*n,i),"false"==$(this).attr("playing")&&(e.waitOneLoop=!0),a&&l.mutePolo(e),t++),r>0&&"bonus"==s&&(o=Number($(this).attr("id")),n="true"===$(this).attr("playing"),i="true"===$(this).attr("waiting"),a=Number($(this).attr("cntBoucle")),i?TweenMax.delayedCall(.1,l.launchBonus,[o]):n&&l.launchBonus(o,a,!0))})),n&&1==(i=getListPoloUnmute()).length&&getListPoloBusy().length>1&&i[0].setSolo(!0),l.reloop=!1),i=e.find("action"),$(i).children().each((function(){var e,o,t,i;"user"==this.tagName&&(e=$(this).attr("type"),o=decimal(Number($(this).attr("when")),2),o=s<o?s:o,"bonus"==e?(t=Number($(this).attr("bonus")),t=n?t-1:t,o=0===o?.1:o,o=waitingFirstLoop&&o<delayassist/1e3?o+delayassist/1e3:o,TweenMax.delayedCall(o,l.launchBonus,[t])):(t=Number($(this).attr("polo")),i=Number($(this).attr("picto")),t=-1==t?{fromFlash:!0}:listPolo[t],i=listPicto[i],"append"==e?TweenMax.delayedCall(o,l.appendPolo,[t,i]):"remove"==e?TweenMax.delayedCall(o,l.removePolo,[t,i]):"mute"==e?TweenMax.delayedCall(o,l.mutePolo,[t,i]):"unmute"==e&&TweenMax.delayedCall(o,l.unmutePolo,[t,i]),n&&"solo"==e&&TweenMax.delayedCall(o,l.soloPolo,[i])))})),r++)},this.getBonusList=function(){var e=[];return $(o).find("bonus[playing='true']").each((function(){e.push({id:parseInt($(this).attr("id")),loopIndex:parseInt($(this).parent().parent().attr("count"))})})),e},this.appendPolo=function(e,o,t,n){pictoTouchePolo(e=!0===e.fromFlash?getListPoloFree()[0]:e,o,t,n),majListPoloDrop()},this.removePolo=function(e,o){(e=!0===e.fromFlash?o.polo:e).getBusy()&&clickPolo(e)},this.mutePolo=function(e,o){(e=!0===e.fromFlash?o.polo:e).getBusy()&&(mutePolo(e),n)&&c()},this.unmutePolo=function(e,o){(e=!0===e.fromFlash?o.polo:e).getBusy()&&(unmutePolo(e),n)&&c()},this.launchBonus=function(e,o,t){notnull(listBonus[e])&&(t?immediatePlayBonus(e,o):listBonus[e].launchVideo())},this.soloPolo=function(e){if(n&&(e=e.polo).getBusy())if(e.getSolo())e.setSolo(!1),stopSoloPolo();else{for(var o=getListPoloBusy(),t=0,i=o.length;t<i;t++)o[t].setSolo(!1);e.setSolo(!0),soloPolo()}},notnull(e)&&this.init()}function convertFlashXml(e){e=$.parseXML(e);var o="true"===(e=$(e).find("compo")).attr("boucle"),t='<mix version="flash">\n';return e.children().each((function(e){var n='\t<loop boucleA="'+o+'" count="'+e+'">\n',i="\t\t<stage>\n",a="\t\t<action>\n";$(this).children().each((function(o){var t,n=(c=$(this)).find("polo"),s=c.attr("type"),r=n.attr("picto"),l="0"===n.attr("vol"),c=(n=n.attr("nbBoucle")>0,c.find("moment").attr("seconde"));c=decimal(Number(c),2).toString();if(s=""!=(t=(s="mute"===(s="mute"!==(s="supprimer"===(s="ajouter"===s?"append":s)?"remove":s)||l?s:"mute")&&l?"unmute":s).indexOf("bonus")>-1?s.split("bonus").join(""):"")?"bonus":s,r=Number(r.split("picto").join("")),2==Number(appVersion))switch(r){case 0:r=5;break;case 1:r=6;break;case 2:r=7;break;case 3:r=8;break;case 4:r=9;break;case 5:r=0;break;case 6:r=1;break;case 7:r=2;break;case 8:r=3;break;case 9:r=4}0==e&&"0"===c?i+='\t\t\t<polo id="-1" picto="'+r+'" mute="'+l+'" playing="'+n+'" />\n':(l='\t\t\t<user type="'+s+'" polo="-1" picto="'+r+'" when="'+c+'" />\n',a+=l="bonus"===s?'\t\t\t<user type="'+s+'" bonus="'+t+'" when="'+c+'" />\n':l)})),t+=n+(i+="\t\t</stage>\n")+(a+="\t\t</action>\n")+"\t</loop>\n",o=!o})),trim(t+="</mix>")}function parseXmlAndCheckAssets(){var e=mixToWatch.xml||mixToWatch.mix,o=$.parseXML(e),t=$(o),n=t.find("mix"),i=!1;t.find("compo").length>0&&(i=!0,e=convertFlashXml(mixToWatch.xml),mixToWatch.xml=e,o=$.parseXML(e),n=(t=$(o)).find("mix"));var a=[],s=[],r=[];function l(e){var o;"bonus"===e.attr("type")?(o=Number(e.attr("bonus")),existInArray(s,o=i?o-1:o)||s.push(o)):(o=Number(e.attr("picto")),existInArray(a,o)||a.push(o))}n.children().each((function(e){0===e&&$(this).find("stage").each((function(e){$(this).children().each((function(e){l($(this))}))})),$(this).find("action").each((function(e){$(this).children().each((function(e){l($(this))}))}))}));a=a.sort((function(e,o){return e-o})),s=s.sort((function(e,o){return e-o}));for(var c=app.animearray[a[0]],u=0,p=app.animearray.length;u<p;u++)existInArray(a,u)||(app.animearray[u]=c);for(u=0,p=s.length;u<p;u++)r.push(app.bonusarray[s[u]])}var convertForceStop=!1,convertWorker=null;function stopConvert(){notnull(convertWorker)?convertWorker.terminate():convertForceStop=!0}function startConvert(e,o){var t,n=new AudioContext,i=(convertForceStop=!1,convertWorker=null,$($.parseXML(e.xml)).find("mix")),a=o.find("#convert-loader-box"),s=a.find(".progress-bar"),r=o.find("#bt-save-file"),l=(o=o.find(".spinner-box"),"mp3"),c=[],u=[],p="incredibox-v"+app.version+"-"+slugify(e.title)+"-320kbps"+(e.online?"-"+e.link:"")+"."+l,d=0;for(d=0;d<nbSound;d++)c.push([tabBuffer.sound[d].sndA,tabBuffer.sound[d].sndB]);for(d=0;d<nbSoundBonus;d++)u.push([tabBuffer.bonus[d].snd,tabBuffer.bonus[d].aspire]);var m,f,v=[],h=0,b=!1,g=!1;if($(i).children().length,$(i).children().each((function(e){var o="true"==$(this).attr("boucleA"),t=$(this).find("stage"),i=$(this).find("action"),a=[],s=o?0:1,r=!app.bonusloopA||o;b&&r&&(g=!(b=!1),v.push(u[m][0])),g&&++h>app.bonusarray[m].loop&&(g=!1,f=m=void(h=0)),g||(t.children().each((function(e){var o,t,r,l;"polo"==this.tagName&&(o=Number($(this).attr("picto")),l="true"==$(this).attr("playing"),t="true"==$(this).attr("mute"),r=[],l)&&(l=c[o][s],t&&r.push({when:0,type:"mute"}),i.find("user[picto='"+o+"']").each((function(e){var o=$(this).attr("type"),t=Number($(this).attr("when"));"append"!=o&&r.push({when:t,type:o})})),r.length>0&&(l=function(e,o,t){for(var i=e.numberOfChannels,a=e.duration,s=n.createBuffer(i,n.sampleRate*a,n.sampleRate),r=0;r<i;r++){for(var l=s.getChannelData(r),c=e.getChannelData(r),u=c.length,p=0,d=o,m=d,f=[],v=0;v<t.length;v++){var h=t[v].when;h=Math.round(h*u/a);f.push([h,t[v].type])}for(var b=f.length>0,g=0;g<u;g++)b&&g>=f[p][0]&&(d="mute"==f[p][1]||"remove"==f[p][1],f.length<=++p&&(b=!1,Math.round(100*g/u)>95)&&(d=m),m=d),d?l[g]=0:l[g]+=c[g]}return s}(l,t,r)),a.push(l))})),i.find("user[type='bonus']").each((function(e){b=!0,m=Number($(this).attr("bonus")),f=Number($(this).attr("when"))})),b&&(i.find("user[type='remove']").each((function(e){var o=Number($(this).attr("picto")),t=Number($(this).attr("when"));f<t&&function(e,o){for(var t=0;t<o.length;t++)if(e==o[t])return 1}(o+1,app.bonusarray[m].code.split(","))&&(b=!1,f=void 0)})),f=0),!b||app.bonusloopA&&o||a.push(u[m][1]),v.push(function(e){for(var o=e.length,t=0,i=0,a=0;a<o;a++)e[a].numberOfChannels>t&&(t=e[a].numberOfChannels),e[a].duration>i&&(i=e[a].duration);for(var s=n.createBuffer(t,n.sampleRate*(i-0),n.sampleRate),r=0;r<o;r++)for(var l=0;l<e[r].numberOfChannels;l++)for(var c=s.getChannelData(l),u=e[r].getChannelData(l),p=0;p<u.length;p++)c[p]+=u[p];return s}(a)))})),!convertForceStop){for(var x=e=function(e){for(var o=e.length,t=[],i=0,a=0;a<o;a++)t.push(e[a].numberOfChannels),i+=e[a].duration;i=Math.ceil(i);for(var s=t.reduce((function(e,o){return Math.min(e,o)})),r=n.createBuffer(s,n.sampleRate*i,n.sampleRate),l=0;l<s;l++)for(var c=r.getChannelData(l),u=0,p=0;p<o;p++){var d=e[p].getChannelData(l);c.set(d,u),u+=d.length}return r}(v),w=.9,y=x.numberOfChannels,k=0;k<y;k++)for(var T=x.getChannelData(k),C=0,D=0,S=0,P=T.length;S<P;S++)T[S]>C&&(C=T[S]),T[S]<D&&(D=T[S]),T[S]>w&&(T[S]=w),T[S]<-w&&(T[S]=-w);i=e;var A=0;convertWorker=new Worker("js/libs/convert-worker.js");i={sampleR:i.sampleRate,numberC:i.numberOfChannels,leftData:i.getChannelData(0),rightData:i.getChannelData(1),lng:i.length,kbps:320,typeToExport:l};convertWorker.postMessage([i]),convertWorker.onmessage=function(e){var o;"msg"==(e=e.data).type?(A++,o=Math.floor(100*A/40),s.css({width:0+(o=(o=o<5?5:o)>100?100:o)+"%"})):(convertWorker.terminate(),o=e.val,t=new Blob(o,{type:"audio/mp3"}),window.cordova&&cordova.plugins&&cordova.plugins.saveDialog?(boxPopup.$icon.trigger(pointerEventType.down),cordova.plugins.saveDialog.saveFile(t,p).then((e=>{})).catch((e=>{"The dialog has been cancelled"!=e&&popupGeneralError({error:"file plugin failed"})}))):(t=window.URL.createObjectURL(t),a.addClass("hide"),r.attr("href",t).attr("download",p).addClass("enabled"),createFocus("popup-convert-mix-ready")),convertWorker=null,n.close(),n=null)},o.addClass("hide"),a.addClass("show")}}var adConfigReady=!1,withAdBreak=!1;function initAd(){}function callAd(e,o,t){t&&t()}var gaShouldTrack=!1,gaAlreadySet=!1;function initAnalytics(){}function saveGA(e,o,t){}